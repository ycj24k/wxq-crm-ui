(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[2502],{75690:function(Ie,se,s){"use strict";s.r(se),s.d(se,{default:function(){return Ae}});var Ge=s(49111),ce=s(19650),ae=s(11849),Ve=s(54029),fe=s(79166),Me=s(57663),re=s(71577),Z=s(2824),me=s(51042),d=s(67294),he=s(85642),pe=s(86582),l=s(39428),v=s(3182),ke=s(34792),J=s(48086),m=s(952),Ze=s(37476),g=s(5966),ve=s(8214),B=s(64317),H=s(31199),ge=s(45510),ne=s(22452),be=s(52688),Ce=s(59962),w=s(90672),j=s(37490),Fe=s(30202),je=s(6821),x=s(63863),ie=s(21010),xe=s(54493),De=s(93839),Be=s(21874),ye=s(19278),e=s(85893),Ee=(0,d.forwardRef)(function(y,Y){var u=y.renderData,P=y.ModalsVisible,A=y.setModalsVisible,T=y.callbackRef,E=(0,d.useRef)(),N=(0,d.useState)(!1),I=(0,Z.Z)(N,2),G=I[0],V=I[1],D=(0,d.useState)(!1),R=(0,Z.Z)(D,2),Q=R[0],M=R[1],W=(0,d.useState)(!1),k=(0,Z.Z)(W,2),X=k[0],S=k[1],q=(0,d.useState)(!1),z=(0,Z.Z)(q,2),U=z[0],O=z[1],_=(0,d.useState)(),$=(0,Z.Z)(_,2),p=$[0],o=$[1],ee=(0,d.useState)(),ue=(0,Z.Z)(ee,2),L=ue[0],le=ue[1],de=(0,d.useRef)(null);(0,d.useEffect)(function(){if(u.eidtType=="add"){var a;(a=E.current)===null||a===void 0||a.setFieldsValue({type:u.type})}if(u.eidtType=="eidt"){var t;Object.keys(u).forEach(function(i){typeof u[i]=="number"&&(u[i]=u[i]+"")});var r=[];u.files&&(u.files.split(",").forEach(function(i,f){r.push({uid:f+1,name:i,response:{data:i}})}),u.files=r);var h=[];u.invoiceTitle?(h.push({title:u.invoiceTitle,productType:u.invoiceProductType+"",taxCode:u.invoiceTaxCode,amount:u.invoiceAmount,email:u.invoiceEmail,remark:u.invoiceRemark,cautions:u.invoiceCautions,type:u.invoiceType+"",bank:u.invoiceBank,account:u.invoiceAccount,mobile:u.invoiceMobile,address:u.invoiceAddress}),u.fapiao=h,u.fFalg="\u662F",S(!0)):u.fFalg="\u5426",u.oldProject=j.Z.getCascaderValue("dict_reg_job",u.oldProject),(t=E.current)===null||t===void 0||t.setFieldsValue(u),de.current.setDepartment({id:u.userId,name:u.userName,departmentId:j.Z.getDepartmentName(Number(u.departmentId))[0]}),le(u.departmentId),o({name:u.userName,id:u.userId})}},[]);var Te=function(){J.default.success("\u64CD\u4F5C\u6210\u529F"),A(),T()},oe=function(t,r){var h={};if(Q&&J.default.error("\u8BF7\u586B\u5199\u6B63\u786E\u7684\u59D3\u540D/\u90E8\u95E8"),u.eidtType=="eidt"&&(t.id=u.id),t.files){var i=[];t.files.forEach(function(f){i.push(f.response.data)}),t.files=i.join(",")}return t.fapiao&&(h=t.fapiao[0],delete t.fapiao),t.chargeTime=(0,De.Z)(t.chargeTime),t.userId=p.id,t.userName=p.name,t.departmentId=L,t.type=u.type,t.oldProject=t.oldProject[t.oldProject.length-1],delete t.isCalculation,new Promise(function(){var f=(0,v.Z)((0,l.Z)().mark(function K(F){var b,C,c;return(0,l.Z)().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(u.eidtType!="eidt"){n.next=22;break}return n.next=3,x.Z.postAll("/sms/business/bizCharge/edit",[t]);case 3:if(b=n.sent,b.status=="success"){n.next=6;break}return n.abrupt("return");case 6:if(JSON.stringify(h)=="{}"){n.next=12;break}return n.next=9,x.Z.post("/sms/business/bizInvoice",(0,ae.Z)({id:u.invoiceId},h));case 9:if(C=n.sent,C.status=="success"){n.next=12;break}return n.abrupt("return");case 12:if(r!="audit"){n.next=18;break}return n.next=15,x.Z.post("/sms/business/bizAudit/audit/0",{confirm:!0,entityId:u.id});case 15:if(c=n.sent,c.status=="success"){n.next=18;break}return n.abrupt("return");case 18:Te(),F(!0),n.next=23;break;case 22:x.Z.post2("/sms/business/bizCharge/complex",t,JSON.stringify(h)!="{}"?h:"").then(function(te){te.status=="success"&&(J.default.success("\u64CD\u4F5C\u6210\u529F"),A(),T(),F(te))}).catch(function(te){F(!0)});case 23:case"end":return n.stop()}},K)}));return function(K){return f.apply(this,arguments)}}())},Re=function(){ie.m8.push("/business/companymanagetrue")},we=function(){ie.m8.push("/business/studentmanage")};return(0,e.jsxs)(Ze.Y,{title:"\u6DFB\u52A0\u7F34\u8D39",visible:P,formRef:E,width:1200,modalProps:{onCancel:function(){return A(!1)},okText:u.eidtType=="eidt"?"\u4FEE\u6539":"\u63D0\u4EA4",maskClosable:!1},submitter:{render:function(t,r){return[].concat((0,pe.Z)(r),[(0,e.jsx)(re.Z,{htmlType:"button",type:"primary",hidden:u.eidtType=="add",onClick:(0,v.Z)((0,l.Z)().mark(function h(){var i,f;return(0,l.Z)().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:(i=E.current)===null||i===void 0||(f=i.validateFieldsReturnFormatValue)===null||f===void 0||f.call(i).then(function(){var b=(0,v.Z)((0,l.Z)().mark(function C(c){return(0,l.Z)().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return console.log("\u6821\u9A8C\u8868\u5355\u5E76\u8FD4\u56DE\u683C\u5F0F\u5316\u540E\u7684\u6240\u6709\u6570\u636E\uFF1A",c),n.next=3,oe(c,"audit");case 3:case"end":return n.stop()}},C)}));return function(C){return b.apply(this,arguments)}}());case 1:case"end":return F.stop()}},h)})),children:"\u4FEE\u6539\u5E76\u5BA1\u6838"},"edit")])}},onFinish:function(){var a=(0,v.Z)((0,l.Z)().mark(function t(r){return(0,l.Z)().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,oe(r);case 2:case"end":return i.stop()}},t)}));return function(t){return a.apply(this,arguments)}}(),children:[(0,e.jsx)(m.ZP.Group,{children:(0,e.jsx)(Be.Z,{ref:de,userLabel:"\u62DB\u751F\u8001\u5E08(\u5728\u804C\u8001\u5E08\u53EF\u4EE5\u8F93\u5165\u540D\u5B57\u641C\u7D22)",userNames:"userName",userPlaceholder:"\u8BF7\u8F93\u5165\u62DB\u751F\u8001\u5E08\u7684\u540D\u5B57",setUserNameId:function(t){return o(t)},setDepartId:function(t){return le(t)},setFalgUser:function(t){return M(t)}})}),(0,e.jsxs)(m.ZP.Group,{children:[(0,e.jsxs)("div",{style:{width:"1100px",backgroundColor:"#d9edf7",border:"1px solid #bce8f1",padding:"20px",marginBottom:"20px"},children:[(0,e.jsx)("text",{style:{color:"red"},children:"\u6CE8\u610F:"})," \u5982\u679C\u662F\u5B66\u5458\u9700\u8981\u4E0B\u5355\uFF0C\u8BF7\u53BB",(0,e.jsxs)("text",{style:{color:"blue",textDecoration:"underline",cursor:"pointer"},children:[(0,e.jsx)("text",{onClick:function(){return Re()},children:"\u6B63\u5F0F\u5B66\u5458"}),(0,e.jsx)("text",{onClick:function(){return we()},children:"/\u6F5C\u5728\u5B66\u5458"})]}),"\u641C\u7D22\u5B66\u5458\u540D\u5B57\u67E5\u8BE2\u5230\u5B66\u5458(\u6F5C\u5728\u5C31\u65B0\u589E\u5B66\u5458)\u8FDB\u884C\u4E0B\u5355\u3002\u8FD9\u91CC\u662F\u7ED9\u8001\u7CFB\u7EDF\u6587\u661F\u68CB\u6709\u8FC7\u8BA2\u5355\u7684\u5B66\u5458\u7F34\u7EB3\u5C3E\u6B3E\u7684"]}),(0,e.jsx)(g.Z,{name:"oldStudentName",width:"md",label:"\u5BA2\u6237\u59D3\u540D",placeholder:"\u8BF7\u8F93\u5165\u5BA2\u6237\u59D3\u540D",rules:[{required:!0,pattern:new RegExp(/^\S*$/),message:"\u4E0D\u80FD\u5305\u542B\u7A7A\u683C/\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u5BA2\u6237\u59D3\u540D"}]}),(0,e.jsx)(ve.Z,{width:"sm",name:"oldProject",placeholder:"\u54A8\u8BE2\u62A5\u8003\u5C97\u4F4D",label:"\u62A5\u8003\u5C97\u4F4D",rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u62A5\u8003\u5C97\u4F4D"}],fieldProps:{options:j.Z.getCascader("dict_reg_job"),showSearch:{filter:xe.Z},onSearch:function(t){return console.log(t)}}}),(0,e.jsx)(B.Z,{label:"\u5BA2\u6237\u6765\u6E90",name:"oldSource",width:200,rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u5BA2\u6237\u6765\u6E90"}],request:(0,v.Z)((0,l.Z)().mark(function a(){return(0,l.Z)().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",j.Z.getList("dict_source"));case 1:case"end":return r.stop()}},a)}))})]}),(0,e.jsxs)(m.ZP.Group,{children:[(0,e.jsx)(H.Z,{label:"\u672C\u6B21\u7F34\u8D39\u91D1\u989D",name:"amount",width:"md",fieldProps:{precision:2},rules:[{required:!0}]}),(0,e.jsx)(B.Z,{label:"\u4ED8\u6B3E\u65B9\u5F0F",name:"method",width:"md",request:(0,v.Z)((0,l.Z)().mark(function a(){return(0,l.Z)().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",j.Z.getList("dict_stu_refund_type"));case 1:case"end":return r.stop()}},a)})),rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u4ED8\u6B3E\u65B9\u5F0F"}]}),(0,e.jsx)(B.Z,{label:"\u7F34\u8D39\u7C7B\u578B",name:"type",width:"md",valueEnum:{0:"\u8BA2\u5355\u7F34\u8D39",1:"\u8BA2\u5355\u9000\u8D39",2:"\u5386\u53F2\u9057\u7559\u7F34\u8D39",3:"\u5386\u53F2\u9057\u7559\u9000\u8D39\u6216\u672A\u4E0B\u5355\u76F4\u63A5\u9000\u6B3E"},required:!0,disabled:!0})]}),(0,e.jsxs)(m.ZP.Group,{children:[(0,e.jsx)(H.Z,{name:"discount",label:"\u672C\u6B21\u4F18\u60E0\u91D1\u989D",disabled:u.type=="orders",hidden:u.type=="orders",min:-999999,width:"md",fieldProps:{onChange:function(t){V(!!t)}}}),(0,e.jsx)(g.Z,{name:"discountRemark",label:"\u672C\u6B21\u4F18\u60E0\u539F\u56E0",width:"lg",disabled:u.type=="orders",hidden:u.type=="orders",rules:[{required:G,message:"\u8BF7\u586B\u5199\u672C\u6B21\u6298\u6263\u539F\u56E0"}]})]}),(0,e.jsxs)(m.ZP.Group,{children:[(0,e.jsx)(ge.Z,{name:"chargeTime",fieldProps:{showTime:!1},width:"md",label:"\u7F34\u8D39\u65E5\u671F",rules:[{required:!0,message:"\u8BF7\u586B\u5199\u7F34\u8D39\u65E5\u671F"}]}),(0,e.jsx)(ne.Z,{name:"paymentTime",width:"md",label:"\u5B9E\u9645\u5230\u8D26\u65E5\u671F",rules:[{required:!0,message:"\u8BF7\u586B\u5199\u5B9E\u9645\u5230\u8D26\u65E5\u671F"}]}),(0,e.jsx)(ne.Z,{name:"nextPaymentTime",width:"md",label:"\u4E0B\u6B21\u7F34\u8D39\u65F6\u95F4"})]}),(0,e.jsxs)(m.ZP.Group,{children:[(0,e.jsx)(B.Z,{name:"fFalg",label:"\u662F\u5426\u5F00\u5177\u53D1\u7968",valueEnum:{false:"\u5426",true:"\u662F"},width:"xs",fieldProps:{onChange:function(t){t=="false"?S(!1):S(!0)},placeholder:"\u8BF7\u9009\u62E9"},rules:[{required:!0}]}),(0,e.jsx)(be.Z,{label:"\u662F\u5426\u7EDF\u8BA1\u4E1A\u7EE9",name:"isCalculation",hidden:u.eidtType!=="eidt",fieldProps:{checkedChildren:"\u8BA1\u7B97",unCheckedChildren:"\u4E0D\u8BA1\u7B97",defaultChecked:u.isCalculation,onChange:function(){var a=(0,v.Z)((0,l.Z)().mark(function r(){var h;return(0,l.Z)().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,x.Z.post("/sms/business/bizCharge/reports/setIsCalculation",{ids:u.id,isCalculation:!u.isCalculation});case 2:h=f.sent;case 3:case"end":return f.stop()}},r)}));function t(){return a.apply(this,arguments)}return t}()}}),X&&(0,e.jsx)("div",{children:(0,e.jsx)(Ce.u,{name:"fapiao",creatorButtonProps:!1,initialValue:[{title:""}],max:1,itemRender:function(t,r){var h=t.listDom,i=t.action,f=r.record,K=r.index,F=r.name;return(0,e.jsxs)(Fe.ZP,{title:"\u53D1\u7968\u4FE1\u606F",style:{width:"1050px",border:"1px solid #bce8f1",padding:"20px"},children:[(0,e.jsxs)(m.ZP.Group,{children:[(0,e.jsx)(g.Z,{name:"title",label:"\u53D1\u7968\u62AC\u5934",width:"lg",required:!0}),(0,e.jsx)(B.Z,{label:"\u5546\u54C1\u79CD\u7C7B",name:"productType",width:"md",initialValue:"0",request:(0,v.Z)((0,l.Z)().mark(function b(){return(0,l.Z)().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",j.Z.getList("invoiceProductType"));case 1:case"end":return c.stop()}},b)}))})]}),(0,e.jsxs)(m.ZP.Group,{children:[(0,e.jsx)(g.Z,{name:"taxCode",label:"\u7A0E\u53F7",width:"md",required:!0}),(0,e.jsx)(H.Z,{name:"amount",label:"\u91D1\u989D",width:"md",required:!0,fieldProps:{precision:2}}),(0,e.jsx)(g.Z,{name:"email",label:"\u5B66\u5458\u90AE\u7BB1",width:"md",required:!0})]}),(0,e.jsxs)(m.ZP.Group,{children:[(0,e.jsx)(w.Z,{width:1100,label:"\u53D1\u7968\u5907\u6CE8",name:"remark"}),(0,e.jsx)(w.Z,{width:1100,label:"\u6CE8\u610F\u4E8B\u9879",name:"cautions"})]}),(0,e.jsx)(m.ZP.Group,{children:(0,e.jsx)(B.Z,{label:"\u53D1\u7968\u79CD\u7C7B",name:"type",width:"md",fieldProps:{onChange:function(C){var c=C!=0;O(c)}},initialValue:"0",request:(0,v.Z)((0,l.Z)().mark(function b(){return(0,l.Z)().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",j.Z.getList("invoiceType"));case 1:case"end":return c.stop()}},b)}))})}),(0,e.jsxs)("div",{hidden:!U,children:[(0,e.jsxs)(m.ZP.Group,{children:[(0,e.jsx)(g.Z,{name:"bank",label:"\u5F00\u6237\u884C",width:"md",required:!0}),(0,e.jsx)(g.Z,{name:"account",label:"\u8D26\u53F7",width:"md",required:!0})]}),(0,e.jsxs)(m.ZP.Group,{children:[(0,e.jsx)(g.Z,{name:"mobile",label:"\u7535\u8BDD",width:"md",required:!0}),(0,e.jsx)(g.Z,{name:"address",label:"\u5730\u5740",width:"md",required:!0})]})]})]})}})})]}),(0,e.jsx)(m.ZP.Group,{title:"\u7A0E\u7968\u4FE1\u606F",children:(0,e.jsx)(ye.Z,{})}),(0,e.jsxs)(m.ZP.Group,{children:[(0,e.jsx)(w.Z,{width:1100,label:"\u5907\u6CE8",name:"description",rules:[{required:!0}]}),(0,e.jsx)(w.Z,{width:1100,label:"\u8D22\u52A1\u5907\u6CE8",name:"description2",hidden:u.eidtType!="eidt"}),(0,e.jsx)(je.Z,{width:1100,label:"\u4E0A\u4F20\u9644\u4EF6",name:"files",action:"/sms/business/bizCharge/upload",renderData:u,fileUrl:"/sms/business/bizCharge/download"})]})]})}),Se=s(79046),Pe=s(7339),Ae=function(){var y=(0,d.useState)(!1),Y=(0,Z.Z)(y,2),u=Y[0],P=Y[1],A=(0,d.useState)(null),T=(0,Z.Z)(A,2),E=T[0],N=T[1],I=(0,d.useState)({"auditNum-isNull":!0,enable:!0}),G=(0,Z.Z)(I,2),V=G[0],D=G[1],R=(0,d.useRef)(null),Q=(0,d.useState)([0,0]),M=(0,Z.Z)(Q,2),W=M[0],k=M[1],X=(0,d.useState)("list"),S=(0,Z.Z)(X,2),q=S[0],z=S[1];(0,d.useEffect)(function(){O()},[]);var U=function(){R.current.callbackRef()},O=function(){x.Z.get("/sms/business/bizCharge/statistics",{array:JSON.stringify([{type:2,"auditNum-isNull":!0}])}).then(function(o){k(o.data)})},_=[(0,e.jsx)(re.Z,{type:"primary",icon:(0,e.jsx)(me.Z,{}),onClick:function(){N({eidtType:"add",type:"2"}),P(!0)},children:"\u65B0\u589E\u7F34\u8D39\u4FE1\u606F"})],$={menu:{type:"tab",items:[{key:"shenhe",label:(0,e.jsx)(fe.Z,{count:W[0],size:"small",offset:[5,3],children:(0,e.jsx)("span",{children:"\u8D22\u52A1\u5BA1\u6838"})})},{key:"true",label:(0,e.jsx)("span",{children:"\u5BA1\u6838\u901A\u8FC7"})},{key:"false",label:(0,e.jsx)("span",{children:"\u5BA1\u6838\u672A\u901A\u8FC7"})},{key:"list",label:(0,e.jsx)("span",{children:"\u7F34\u8D39\u5217\u8868"})},{key:"enable",label:(0,e.jsx)("span",{children:"\u5DF2\u5E9F\u9664"})}],onChange:function(o){z(o),o=="shenhe"?D({"auditNum-isNull":!0,enable:!0}):o=="true"?D({confirm:!0,enable:!0}):o=="false"?D({confirm:!1,enable:!0}):o==="enable"?D({enable:!1}):o==="list"&&D({enable:!0,confirm:!0}),U()}}};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(he.Z,{params:(0,ae.Z)({type:2},V),ref:R,toolbar:$,toolBarRender:_,setModalsVisible:function(o){return P(o)},setRenderData:function(o){return N(o)},BadgesNumbers:function(){return O()},ChangeKey:q,tableAlertOptionRender:function(o){var ee=o.selectedRowKeys;return(0,e.jsx)(ce.Z,{size:24,children:(0,e.jsx)("a",{onClick:function(){x.Z.get("/sms/business/bizCharge/getListOfFinance",{idList:ee.join(",")}).then(function(L){L.status=="success"&&(0,Se.Z)(L.data,Pe.Z.PayHeader,"\u7F34\u8D39\u4FE1\u606F","charge")})},children:"\u5BFC\u51FA\u6570\u636E"})})}}),u&&(0,e.jsx)(Ee,{renderData:E,ModalsVisible:u,setModalsVisible:function(){return P(!1)},callbackRef:function(){return U()}})]})}}}]);
