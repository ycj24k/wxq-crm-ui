(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[6],{94849:function(zu,k,n){"use strict";n.r(k),n.d(k,{default:function(){return pu}});var Mu=n(57338),su=n(273),Nu=n(63185),iu=n(9676),ku=n(57663),O=n(71577),Ou=n(88983),$=n(55742),Uu=n(71194),U=n(50146),Wu=n(34792),lu=n(48086),o=n(39428),g=n(11849),E=n(3182),D=n(2824),ou=n(71906),W=n(30202),b=n(63863),h=n(952),cu=n(59962),du=n(24739),Z=n(5966),R=n(31199),V=n(64317),H=n(90672),m=n(67294),Hu=n(13062),Fu=n(71230),Ju=n(89032),J=n(15746),e=n(85893),fu=function(){return(0,e.jsxs)(Fu.Z,{style:{width:"1100px",backgroundColor:"#d9edf7",border:"1px solid #bce8f1",padding:"20px",marginBottom:"20px"},children:[(0,e.jsx)(J.Z,{span:2,style:{color:"red"},children:"\u6CE8\u610F\uFF1A"}),(0,e.jsxs)(J.Z,{span:22,children:["\uFF081\uFF09\u5B66\u5386\u9879\u76EE\u4E0D\u5F00\u53D1\u7968",(0,e.jsx)("br",{}),"\uFF082\uFF09\u62DB\u751F\u8001\u5E08\u5728\u4E0B\u5355\u65F6\u586B\u5199\u53D1\u7968\u7533\u8BF7\u4FE1\u606F\u2192\u51FA\u7EB3\u5BA1\u6838\u2192\u51FA\u7EB3\u5F00\u5177\u53D1\u7968\u2192\u62DB\u751F\u8001\u5E08\u9886\u53D6\u53D1\u7968\u6216\u51FA\u7EB3\u53D1\u9001\u7535\u5B50\u53D1\u7968\u7ED9\u5B66\u5458\uFF1B",(0,e.jsx)("br",{}),"\uFF083\uFF09\u9009\u62E9\u4E0D\u5F00\u7968\u7684\u4E1A\u52A1\u6536\u6B3E\uFF0C\u540E\u671F\u4E0D\u518D\u5F00\u5177\u53D1\u7968\uFF0C\u5426\u5219\u4F1A\u5BFC\u81F4\u91CD\u590D\u7F34\u7A0E\u3002",(0,e.jsx)("br",{}),"\uFF084\uFF09\u52A1\u5FC5\u8BE2\u95EE\u5B66\u5458\u662F\u5426\u5F00\u54A8\u8BE2\u8D39\uFF0C\u53EF\u964D\u4F4E\u98CE\u9669\u3002",(0,e.jsx)("br",{}),"\uFF085\uFF09\u804C\u79F0\u8BC4\u5BA1\u53EA\u53EF\u4EE5\u5F00\u54A8\u8BE2\u8D39\u3002",(0,e.jsx)("br",{}),"\uFF086\uFF09\u5982\u679C\u5B66\u5458\u5F00\u4E13\u7968\uFF0C\u9700\u52A0\u6536\u7968\u9762\u7A0E\u7387\u7684\u7A0E\u8D39\uFF082023\u5E74\u4E3A1%\uFF09\uFF0C\u539F\u56E0\u662F\u5C0F\u89C4\u6A21\u7EB3\u7A0E\u4EBA\u5F00\u666E\u7968\u514D\u7A0E\uFF0C\u800C\u5F00\u4E13\u7968\u4E0D\u51CF\u514D\u4EFB\u4F55\u7A0E\u8D39\u3002",(0,e.jsx)("br",{}),"\uFF087\uFF09\u8BF7\u8DDF\u5B66\u5458\u786E\u5B9A\u597D\u5F00\u7968\u4FE1\u606F\uFF0C\u5982\u679C\u9519\u8BEF\u4E0D\u91CD\u5F00\uFF0C\u56E0\u4E3A\u53D1\u7968\u5F20\u6570\u6709\u9650\u3002",(0,e.jsx)("br",{}),"\uFF088\uFF09\u82E5\u5B66\u5458\u5F00\u4E2A\u4EBA\u53D1\u7968\uFF0C\u62DB\u751F\u8001\u5E08\u8BF7\u63D0\u524D\u544A\u77E5\u5B66\u5458\u4E2A\u4EBA\u53D1\u7968\u4E00\u822C\u516C\u53F8\u4E0D\u7ED9\u62A5\u9500\uFF0C\u5982\u56E0\u5F00\u5177\u4E2A\u4EBA\u53D1\u7968\u5B66\u5458\u4E0D\u80FD\u62A5\u9500\u9700\u8981\u9000\u56DE\u91CD\u5F00\uFF0C\u8D22\u52A1\u4E0D\u4E88\u5F00\u5177\u3002",(0,e.jsx)("br",{})]})]})},C=n(37490),vu=n(51042),hu=n(68855),mu=n(98580),pu=function(){var gu=(0,m.useState)(0),K=(0,D.Z)(gu,2),L=K[0],Eu=K[1],Zu=(0,m.useState)(!1),Q=(0,D.Z)(Zu,2),X=Q[0],w=Q[1],Cu=(0,m.useState)([]),Y=(0,D.Z)(Cu,2),x=Y[0],Du=Y[1],yu=(0,m.useState)(!1),q=(0,D.Z)(yu,2),Au=q[0],G=q[1],xu=(0,m.useState)(!0),_=(0,D.Z)(xu,2),I=_[0],T=_[1],ju=(0,m.useState)([]),uu=(0,D.Z)(ju,2),Ku=uu[0],eu=uu[1],Bu=(0,m.useState)([]),ru=(0,D.Z)(Bu,2),Qu=ru[0],bu=ru[1],Iu=(0,m.useState)(!1),nu=(0,D.Z)(Iu,2),Pu=nu[0],S=nu[1],y=(0,m.useRef)(),c=(0,m.useRef)(),Tu=function(r){Eu(r.target.value)},Su=function(r){r.target.checked==!0?(T(!1),S(!0)):(T(!0),S(!1))},Ru=function(r){var u,a=r.map(function(s){return{num:s.num,id:s.id,uamount:s.amount,usedAmount:s.thisUsedAmount,surplusAmount:s.amount-s.usedAmount}});bu(a),(u=y.current)===null||u===void 0||u.setFieldsValue({chargeList:a})},tu=function(r){var u,a,s,i=((u=c.current)===null||u===void 0?void 0:u.getFieldValue("price"))||0,l=((a=c.current)===null||a===void 0?void 0:a.getFieldValue("quantity"))||0;c==null||(s=c.current)===null||s===void 0||s.setFieldValue("amount",i*l)},Vu=function(r){var u,a=r.title,s=r.productType,i=r.taxCode,l=r.amount,v=r.email,F=r.remark,p=r.cautions,P=r.type,j=r.bank,z=r.account,d=r.mobile,f=r.address,A=r.chargeAccount,B=r.price,au=r.quantity;(u=y.current)===null||u===void 0||u.setFieldsValue({title:a,productType:s,taxCode:i,amount:l,email:v,remark:F,cautions:p,type:P,bank:j,account:z,mobile:d,address:f,chargeAccount:A,price:B,quantity:au})};(0,m.useEffect)(function(){$u()},[]);var $u=function(){var t=(0,E.Z)((0,o.Z)().mark(function r(){var u,a;return(0,o.Z)().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,b.Z.get("/sms/business/bizInvoice",{enable:!0,_orderBy:"createTime"});case 2:u=i.sent,a=u.data.content.map(function(l){return(0,g.Z)((0,g.Z)({},l),{},{label:l.title,value:l.id})}),console.log(a),eu(a);case 6:case"end":return i.stop()}},r)}));return function(){return t.apply(this,arguments)}}(),Lu=function(){var t=(0,E.Z)((0,o.Z)().mark(function r(u){var a;return(0,o.Z)().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,b.Z.get("/sms/business/bizInvoice/getInvoiceTempByChargeId?idList=".concat(u));case 2:a=i.sent,eu(a.data);case 4:case"end":return i.stop()}},r)}));return function(u){return t.apply(this,arguments)}}();(0,m.useEffect)(function(){if(x.length>0){Vu({chargeAccount:x[0].method+""}),wu(x[0].studentUserId),Ru(x);var t=x.map(function(r){return r.id}).join(",");Lu(t)}},[x]);var wu=function(){var t=(0,E.Z)((0,o.Z)().mark(function r(u){var a,s;return(0,o.Z)().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,b.Z.get("/sms/business/bizInvoice",{studentUserId:u});case 2:a=l.sent.data.content,a.length>0&&(s=a[0],Object.keys(s).forEach(function(v){typeof s[v]=="number"&&(s[v]=s[v]+"")}));case 4:case"end":return l.stop()}},r)}));return function(u){return t.apply(this,arguments)}}(),Xu=function(){var t=(0,E.Z)((0,o.Z)().mark(function r(u){var a;return(0,o.Z)().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,b.Z.get("/sms/business/bizInvoice/searchTemplate?word=".concat(u));case 2:return a=i.sent,i.abrupt("return",a.data.content.map(function(l){return(0,g.Z)((0,g.Z)({},l),{},{label:l.title,value:l.id})}));case 4:case"end":return i.stop()}},r)}));return function(u){return t.apply(this,arguments)}}(),Gu=function(){var t=(0,E.Z)((0,o.Z)().mark(function r(){var u,a,s,i,l,v,F,p,P,j;return(0,o.Z)().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.prev=0,d.next=3,(u=y.current)===null||u===void 0?void 0:u.validateFields();case 3:return d.next=5,(a=c.current)===null||a===void 0?void 0:a.validateFields();case 5:return l=(s=y.current)===null||s===void 0?void 0:s.getFieldsValue(),v=(i=c.current)===null||i===void 0?void 0:i.getFieldsValue(),I&&(delete v.bank,delete v.account,delete v.mobile,delete v.address),F=(0,g.Z)((0,g.Z)({},l),v),F!=null&&F.chargeList?F.chargeList.forEach(function(f){f.amount=f.usedAmount,delete f.uamount,delete f.num,delete f.usedAmount,delete f.surplusAmount}):F.chargeList=[],p=0,F.type=="\u666E\u7968"&&(p=0),F.type=="\u4E13\u7968"&&(p=1),P=(0,g.Z)((0,g.Z)({},F),{},{type:p,chargeAccount:C.Z.getValue("dict_stu_refund_type",F.chargeAccount),productType:C.Z.getValue("invoiceProductType",F.productType)}),j="/sms/business/bizInvoice",d.abrupt("return",new Promise(function(){var f=(0,E.Z)((0,o.Z)().mark(function A(B){return(0,o.Z)().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:b.Z.postAll(j,P).then(function(N){N.status=="success"&&(lu.default.success("\u64CD\u4F5C\u6210\u529F"),B(N))}).catch(function(N){B(!0)});case 1:case"end":return M.stop()}},A)}));return function(A){return f.apply(this,arguments)}}()));case 18:d.prev=18,d.t0=d.catch(0),U.Z.error({title:"\u8868\u5355\u9A8C\u8BC1\u5931\u8D25",content:"\u8BF7\u68C0\u67E5\u8868\u5355\u586B\u5199\u662F\u5426\u5B8C\u6574\u4E14\u7B26\u5408\u8981\u6C42\u3002"});case 21:case"end":return d.stop()}},r,null,[[0,18]])}));return function(){return t.apply(this,arguments)}}();return(0,e.jsxs)(ou.ZP,{children:[(0,e.jsxs)(W.ZP,{hoverable:!0,style:{minHeight:"900px"},children:[(0,e.jsxs)("div",{children:[(0,e.jsx)(h.ZP.Group,{title:"\u9996\u5148\u8BF7\u9009\u62E9\u5F00\u7968\u7C7B\u578B"}),(0,e.jsxs)($.ZP.Group,{name:"radiogroup",onChange:function(r){return Tu(r)},children:[(0,e.jsx)($.ZP,{value:1,children:"\u5DF2\u6709\u7F34\u8D39\u5F00\u5177\u53D1\u7968"}),(0,e.jsx)($.ZP,{value:2,children:"\u5148\u5F00\u7968\u540E\u7F34\u8D39"})]})]}),(0,e.jsxs)("div",{hidden:L==0,children:[(0,e.jsxs)("div",{hidden:L==2,style:{marginTop:"30px"},children:[(0,e.jsx)(O.Z,{type:"primary",icon:(0,e.jsx)(vu.Z,{}),onClick:function(){return w(!0)},children:" \u9009\u62E9\u7F34\u8D39\u4FE1\u606F "}),(0,e.jsx)("span",{children:"\u70B9\u51FB\u9009\u62E9\u7F34\u8D39\u4FE1\u606F,\u9009\u62E9\u4F60\u9700\u8981\u5F00\u7968\u7684\u7F34\u8D39"}),(0,e.jsx)(h.ZP.Group,{title:"\u5F00\u7968\u7F34\u8D39\u4FE1\u606F",children:(0,e.jsx)(h.ZP,{formRef:y,submitter:!1,children:(0,e.jsx)(cu.u,{name:"chargeList",creatorButtonProps:!1,deleteIconProps:!1,copyIconProps:!1,itemRender:function(r,u){var a=r.listDom,s=r.action,i=u.record,l=u.index,v=u.name;return(0,e.jsxs)(W.ZP,{title:"\u7F34\u8D39\u4FE1\u606F",bordered:!0,style:{marginBottom:8},children:[(0,e.jsxs)(du.UW,{children:[(0,e.jsx)(Z.Z,{label:"\u7F34\u8D39\u7F16\u53F7",name:"num",readonly:!0}),(0,e.jsx)(Z.Z,{label:"\u7F34\u8D39\u91D1\u989D",name:"uamount",readonly:!0}),(0,e.jsx)(Z.Z,{label:"\u5F53\u524D\u7F34\u8D39\u5269\u4F59\u53EF\u5F00\u7968\u91D1\u989D",name:"surplusAmount",readonly:!0}),(0,e.jsx)(R.Z,{name:"usedAmount",label:"\u6B64\u7F34\u8D39\u9700\u8981\u5F00\u7968\u91D1\u989D",width:"md",rules:[{required:!0}],fieldProps:{precision:2,onChange:function(p){},onBlur:function(){var p,P=(p=y.current)===null||p===void 0?void 0:p.getFieldValue("chargeList"),j=P[l];j.surplusAmount<j.usedAmount&&U.Z.info({title:"\u6CE8\u610F\uFF01\u5F53\u524D\u5F00\u7968\u91D1\u989D\u5927\u4E8E\u5269\u4F59\u53EF\u5F00\u7968\u91D1\u989D\uFF01",icon:(0,e.jsx)(hu.Z,{}),onOk:function(){var d,f,A=(d=y.current)===null||d===void 0?void 0:d.getFieldValue("chargeList"),B=A[l];delete B.usedAmount,A[l]=B,(f=y.current)===null||f===void 0||f.setFieldValue("chargeList",A)}})}}})]},"invoice-list-form-".concat(l)),(0,e.jsx)("p",{style:{color:"red"},children:"2024\u5E7410\u670825\u53F7\u540E\uFF08\u542B25\u53F7\uFF09\u5E94\u6025\u9879\u76EE\u586B\u5199\u5F00\u7968\u91D1\u989D\u8981\u51CF\u53BB\u8003\u8BD5\u8D39\uFF08\u6709\u5408\u540C\u7684\u4EE5\u5408\u540C\u7B7E\u8BA2\u65E5\u671F\u4E3A\u51C6\uFF0C\u65E0\u5408\u540C\u7684\u4EE5\u6536\u6B3E\u65E5\u671F\u4E3A\u51C6\uFF09"})]},"invoice-list-".concat(l))}})})})]}),(0,e.jsxs)("div",{hidden:L==1&&x.length==0,children:[(0,e.jsx)(h.ZP.Group,{title:"\u7A0E\u7968\u4FE1\u606F",children:(0,e.jsx)(fu,{})}),(0,e.jsx)("div",{children:(0,e.jsxs)(h.ZP,{formRef:c,submitter:!1,children:[(0,e.jsxs)(h.ZP.Group,{children:[(0,e.jsx)(V.Z,{placeholder:"\u8BF7\u8F93\u5165\u53D1\u7968\u62AC\u5934\u641C\u7D22",width:"md",name:"title",label:"\u53D1\u7968\u62AC\u5934",showSearch:!0,debounceTime:500,fieldProps:{onChange:function(r){return r},onSelect:function(r,u){console.log(u);var a="";u.type=="0"&&(a="\u666E\u7968"),u.type==null&&(a="\u666E\u7968"),u.type=="1"&&(a="\u4E13\u7968",S(!0),T(!1),G(!0)),setTimeout(function(){var s;c==null||(s=c.current)===null||s===void 0||s.setFieldsValue({title:u.label,productType:u.type===null||u.type===0?void 0:C.Z.getName("invoiceProductType",u.type),chargeAccount:u.chargeAccount===null||u.chargeAccount===0?void 0:C.Z.getName("dict_stu_refund_type",u.chargeAccount),price:u.price,quantity:u.quantity,taxCode:u.taxCode,email:u.email,remark:u.remark,cautions:u.cautions,type:a,bank:u.bank,account:u.account,mobile:u.mobile,address:u.address})},100)}},request:function(r){return new Promise(function(u,a){r.keyWords?b.Z.get("/sms/business/bizInvoice/searchTemplate?word=".concat(r.keyWords)).then(function(s){if(s.data&&s.data.length>0){var i=s.data.map(function(l){return(0,g.Z)((0,g.Z)({},l),{},{label:l.title,value:l.title})});u(i)}else u([])}).catch(a):u([])})}},"title"),(0,e.jsx)(V.Z,{label:"\u5546\u54C1\u79CD\u7C7B",name:"productType",width:"md",initialValue:"0",rules:[{required:!0}],fieldProps:{onChange:function(){var t=(0,E.Z)((0,o.Z)().mark(function u(a){return(0,o.Z)().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:setTimeout(function(){var l;c==null||(l=c.current)===null||l===void 0||l.setFieldsValue({productType:C.Z.getName("invoiceProductType",a)})},100);case 1:case"end":return i.stop()}},u)}));function r(u){return t.apply(this,arguments)}return r}()},request:(0,E.Z)((0,o.Z)().mark(function t(){return(0,o.Z)().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",C.Z.getList("invoiceProductType"));case 1:case"end":return u.stop()}},t)}))})]}),(0,e.jsxs)(h.ZP.Group,{children:[(0,e.jsx)(V.Z,{label:"\u4ED8\u6B3E\u65B9\u5F0F",placeholder:"\u8BF7\u9009\u62E9\u6536\u6B3E\u65B9\u5F0F",name:"chargeAccount",rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u4ED8\u6B3E\u65B9\u5F0F"}],width:"md",fieldProps:{onChange:function(r){setTimeout(function(){var u;c==null||(u=c.current)===null||u===void 0||u.setFieldsValue({chargeAccount:C.Z.getName("dict_stu_refund_type",r)})},100)}},request:(0,E.Z)((0,o.Z)().mark(function t(){return(0,o.Z)().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",C.Z.getList("dict_stu_refund_type"));case 1:case"end":return u.stop()}},t)}))}),(0,e.jsx)(R.Z,{name:"price",label:"\u5355\u4EF7",rules:[{required:!0}],fieldProps:{onChange:function(r){return tu(r)}}}),(0,e.jsx)(R.Z,{name:"quantity",label:"\u6570\u91CF",rules:[{required:!0}],fieldProps:{onChange:function(r){return tu(r)}}})]}),(0,e.jsxs)(h.ZP.Group,{children:[(0,e.jsx)(Z.Z,{name:"taxCode",label:"\u7A0E\u53F7",width:"md",rules:[{required:!0}]}),(0,e.jsx)(R.Z,{name:"amount",label:"\u91D1\u989D",width:"md",rules:[{required:!0}],fieldProps:{precision:2}}),(0,e.jsx)(Z.Z,{name:"email",label:"\u5B66\u5458\u90AE\u7BB1",width:"md",rules:[{required:!0}],fieldProps:{autoComplete:"no"}})]}),(0,e.jsxs)(h.ZP.Group,{children:[(0,e.jsx)(H.Z,{width:1100,label:"\u53D1\u7968\u5907\u6CE8\uFF08\u5728\u7968\u636E\u4E0A\u663E\u793A\uFF0C\u8C28\u614E\u586B\u5199\uFF09",name:"remark",fieldProps:{autoComplete:"no"}}),(0,e.jsx)(H.Z,{width:1100,label:"\u6CE8\u610F\u4E8B\u9879",name:"cautions",fieldProps:{autoComplete:"no"}})]}),(0,e.jsxs)(h.ZP.Group,{children:[(0,e.jsx)(V.Z,{label:"\u53D1\u7968\u79CD\u7C7B",name:"type",width:"md",rules:[{required:!0}],fieldProps:{onChange:function(r){r==0?(T(!0),G(!1),S(!1)):(T(!1),G(!0),S(!0))}},initialValue:"0",request:(0,E.Z)((0,o.Z)().mark(function t(){return(0,o.Z)().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",C.Z.getList("invoiceType"));case 1:case"end":return u.stop()}},t)}))}),(0,e.jsx)(iu.Z,{style:{marginTop:"35px"},checked:Pu,disabled:Au,onChange:Su,children:"\u586B\u5199\u8D26\u53F7\u4FE1\u606F"})]}),(0,e.jsxs)("div",{hidden:I,children:[(0,e.jsxs)(h.ZP.Group,{children:[(0,e.jsx)(Z.Z,{name:"bank",label:"\u5F00\u6237\u884C",width:"md",rules:[{required:!I}]}),(0,e.jsx)(Z.Z,{name:"account",label:"\u8D26\u53F7",width:"md",rules:[{required:!I}]})]}),(0,e.jsxs)(h.ZP.Group,{children:[(0,e.jsx)(Z.Z,{name:"mobile",label:"\u7535\u8BDD",width:"md",rules:[{required:!I}]}),(0,e.jsx)(Z.Z,{name:"address",label:"\u5730\u5740",width:"md",rules:[{required:!I}]})]})]})]})}),(0,e.jsx)(O.Z,{type:"primary",onClick:Gu,children:"\u63D0\u4EA4"})]})]})]}),X&&(0,e.jsxs)(su.Z,{open:X,onClose:function(){return w(!1)},width:1200,children:[(0,e.jsx)("p",{style:{fontSize:"26px",fontWeight:"bold"},children:"\u8BF7\u52FE\u9009\u4F60\u8981\u5F00\u7968\u7684\u7F34\u8D39\u4FE1\u606F"}),(0,e.jsx)(mu.Z,{setModalsCharge:function(){return w(!1)},setChargeList:function(r){return Du(r)},chargeType:"chargeList",studentType:"all",formParam:{confirm:!0}})]})]})}}}]);
