(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[8706],{54618:function(Be,G,t){"use strict";t.d(G,{Z:function(){return k}});var ue=t(28991),V=t(67294),fe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M908 640H804V488c0-4.4-3.6-8-8-8H548v-96h108c8.8 0 16-7.2 16-16V80c0-8.8-7.2-16-16-16H368c-8.8 0-16 7.2-16 16v288c0 8.8 7.2 16 16 16h108v96H228c-4.4 0-8 3.6-8 8v152H116c-8.8 0-16 7.2-16 16v288c0 8.8 7.2 16 16 16h288c8.8 0 16-7.2 16-16V656c0-8.8-7.2-16-16-16H292v-88h440v88H620c-8.8 0-16 7.2-16 16v288c0 8.8 7.2 16 16 16h288c8.8 0 16-7.2 16-16V656c0-8.8-7.2-16-16-16zm-564 76v168H176V716h168zm84-408V140h168v168H428zm420 576H680V716h168v168z"}}]},name:"apartment",theme:"outlined"},C=fe,ve=t(27029),$=function(T,he){return V.createElement(ve.Z,(0,ue.Z)((0,ue.Z)({},T),{},{ref:he,icon:C}))},me=V.forwardRef($),k=me},14037:function(Be,G,t){"use strict";var ue=t(71194),V=t(50146),fe=t(34792),C=t(48086),ve=t(32157),$=t(5816),me=t(88983),k=t(55742),pe=t(86582),T=t(2824),he=t(47673),Ee=t(4107),je=t(54618),X=t(89366),W=t(63863),Z=t(67294),a=t(85893),w=Ee.Z.Search;G.Z=function(O){var g=O.CardVisible,_=O.setCardVisible,B=O.setDepartment,i=O.CardContent,J=O.departments,N=O.parentIdTree,Y=O.checkable,ye=Y===void 0?!1:Y,E=O.callbackRef,Ce=O.setchargePerson,o=O.setUserID,De=O.getUserList,Q=O.departNameList,I=Q===void 0?!1:Q,H,A=[],v=[],y=[],R=(0,Z.useState)([]),b=(0,T.Z)(R,2),Oe=b[0],z=b[1],Pe=(0,Z.useState)(""),q=(0,T.Z)(Pe,2),K=q[0],le=q[1],Ze=(0,Z.useState)(!0),ee=(0,T.Z)(Ze,2),S=ee[0],ie=ee[1],Ie=(0,Z.useState)(!1),de=(0,T.Z)(Ie,2),F=de[0],Me=de[1],oe=function l(r){var e=[];return r.forEach(function(s,m){if(s.enable||F||s.departmentName){var h=[];s.children&&(h=l(s.children));var D="",x,u;s.departmentName?(D=s.departmentName,x=(0,a.jsx)(je.Z,{}),u=!1):(D=s.name,x=(0,a.jsx)(X.Z,{}),u=!1),h.length>0?e.push({title:D,key:m,userId:s.userId,children:h,icon:x,disabled:u,id:s.id}):e.push({title:D,key:m,userId:s.userId,icon:x,disabled:u,id:s.id})}}),e},te=[];i.content.forEach(function(l){l.departmentName?l.departmentName.indexOf("\u79BB\u804C")==-1&&te.push(l):te.push(l)}),i&&(y=oe(te));var Le=function l(r,e){r.forEach(function(s,m){s.key=e+"-"+m,s.children&&l(s.children,s.key)})},ce=function l(r,e){r.forEach(function(s,m){["role","user","achievement","Groups","projectDepartment","sysuser"].includes(i.type)?s.userId==e&&(v.push(s.key),A.push(s)):s.id==e&&v.push(s.key),s.children&&l(s.children,e)})};y.length>0&&(Le(y,0),J&&J.forEach(function(l){ce(y,l.id)}),I&&I.split(",").forEach(function(l){ce(y,l)}));var _e=function l(r,e){for(var s=[],m=0;m<e.length;m++){var h=e[m];h.children&&(h.children.some(function(D){return D.title.indexOf(r)!=-1})?s.push(h.key):l(r,h.children)&&s.push.apply(s,(0,pe.Z)(l(r,h.children))))}return s},se=function(r){z(r),ie(!1)},ne=function(r){var e=r.target.value;z(_e(e,y)),le(e),ie(!0)},ge=function(r){var e=r.target.value;Me(e)},ae=function l(r){return r.map(function(e){var s=e.title.indexOf(K),m=e.title.substring(0,s),h=e.title.slice(s+K.length),D=s>-1?(0,a.jsxs)("span",{children:[m,(0,a.jsx)("span",{className:"site-tree-search-value",children:K}),h]}):(0,a.jsx)("span",{children:e.title});return e.children?{title:D,key:e.key,disabled:e.disabled,icon:e.icon,children:l(e.children),userId:e.userId}:{title:D,key:e.key,icon:e.icon,userId:e.userId,titles:e.title,disabled:e.disabled}})};return(0,Z.useEffect)(function(){if(!K){let r=function(e){e.forEach(function(s){s.children&&(l.push(s.key),r(s.children))})};var l=[];r(y),z(l)}},[K]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(k.ZP.Group,{onChange:ge,value:F,defaultValue:F,children:[(0,a.jsx)(k.ZP,{value:!1,children:"\u4E0D\u67E5\u770B\u79BB\u804C"}),(0,a.jsx)(k.ZP,{value:!0,children:"\u67E5\u770B\u79BB\u804C"})]}),(i==null?void 0:i.type)=="performance"?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(w,{style:{marginBottom:8},placeholder:"Search",onChange:function(r){return ne(r)}}),(0,a.jsx)($.Z,{showIcon:!0,checkable:ye,defaultExpandAll:!0,onExpand:function(r){return se(r)},autoExpandParent:S,defaultCheckedKeys:v,onCheck:function(r,e){var s=e.checkedNodes,m=[];s.forEach(function(h){h.userId&&m.push(h.userId)}),o(m)},onSelect:function(r,e){e.node.userId&&o(e.node.userId)},treeData:ae(y)})]}):(0,a.jsx)(V.Z,{title:"\u9009\u62E9\u4EBA\u5458",visible:g,destroyOnClose:!0,onCancel:function(){v=[],_(!1)},onOk:function(){var r,e=[],s=[];if((r=A)===null||r===void 0||r.forEach(function(u){u.userId&&(e.push(u),s.push(u.userId))}),i.type=="projectDepartment"){W.Z.post("/sms/system/sysDepartment",{id:N,projects:s.join(",")}).then(function(u){u.status=="success"&&(C.default.success("\u6388\u6743\u6210\u529F"),v=[],E(),setTimeout(function(){_(!1)},500))});return}if(i.type=="project"&&W.Z.post2("/sms/business/bizUserJob/updateFromTree",{id:N},{array:s}).then(function(u){u.status=="success"&&(C.default.success("\u6388\u6743\u6210\u529F"),v=[],E(),setTimeout(function(){_(!1)},500))}),i.type=="user"&&W.Z.post2("/sms/system/sysUserUser/updateFromTree",{id:N},{array:s}).then(function(u){u.status=="success"&&(C.default.success("\u6388\u6743\u6210\u529F"),v=[],E(),setTimeout(function(){_(!1)},500))}),i.type=="order")if(e.length>1){C.default.error("\u53EA\u80FD\u9009\u62E9\u4E00\u4F4D");return}else e.length==0?C.default.error("\u8BF7\u9009\u62E9\u6536\u8D39\u4EBA\uFF0C\u6536\u8D39\u4EBA\u4E0D\u80FD\u4E3A\u90E8\u95E8"):(B({name:e[0].titles,id:e[0].userId}),v=[],_(!1));if(i.type=="role"&&W.Z.post2("/sms/system/sysUserRole/updateFromTree",{id:N},{array:s}).then(function(u){u.status=="success"&&(C.default.success("\u6388\u6743\u6210\u529F"),v=[],E(),setTimeout(function(){_(!1)},500))}),i.type=="achievement"){var m=s.map(function(u){return{id:u,newOrderType:i.typeNum}}),h=J.map(function(u){return u.id});h.forEach(function(u){s.includes(u)||m.push({id:u,newOrderType:0})}),W.Z.postAll("/sms/system/sysUser/saveArray",{array:m}).then(function(u){u.status=="success"&&(C.default.success("\u6388\u6743\u6210\u529F"),v=[],De(),setTimeout(function(){_(!1)},500))})}if(i.type=="Groups"){var D=s.map(function(u){return{id:u,groupId:i.groups}}),x=J.map(function(u){return u.id});x.forEach(function(u){s.includes(u)||D.push({id:u,groupId:-1})}),W.Z.postAll("/sms/system/sysUser/saveArray",{array:D}).then(function(u){u.status=="success"&&(C.default.success("\u6388\u6743\u6210\u529F"),v=[],E(),setTimeout(function(){_(!1)},500))})}i.type=="sysuser"&&W.Z.postAll("/sms/system/sysUserLevel/correlationUser/".concat(N),s).then(function(u){u.status=="success"&&(C.default.success("\u6388\u6743\u6210\u529F"),v=[],E(),setTimeout(function(){_(!1)},500))})},children:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(w,{style:{marginBottom:8},placeholder:"Search",onChange:function(r){return ne(r)}}),(0,a.jsx)($.Z,{showIcon:!0,checkable:(i==null?void 0:i.type)!="pay",defaultExpandAll:!0,onExpand:function(r){return se(r)},expandedKeys:Oe,autoExpandParent:S,defaultCheckedKeys:v,onCheck:function(r,e){A=e.checkedNodes},onSelect:function(r,e){H={name:e.node.title,id:e.node.userId},i.type=="pay"&&e.node.userId&&(Ce({name:e.node.titles,id:e.node.userId}),_(!1))},treeData:ae(y)})]})})]})}},22210:function(Be,G,t){"use strict";t.r(G);var ue=t(77883),V=t(49747),fe=t(47673),C=t(4107),ve=t(71194),$=t(50146),me=t(20228),k=t(11382),pe=t(43358),T=t(34041),he=t(62350),Ee=t(24565),je=t(57663),X=t(71577),W=t(34792),Z=t(48086),a=t(39428),w=t(11849),O=t(9715),g=t(55843),_=t(2824),B=t(3182),i=t(67294),J=t(71906),N=t(66801),Y=t(51042),ye=t(14037),E=t(63863),Ce=t(37490),o=t(85893);function De(){return Q.apply(this,arguments)}function Q(){return Q=(0,B.Z)((0,a.Z)().mark(function I(){var H,A,v;return(0,a.Z)().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return R.next=2,E.Z.get("/sms/system/sysUserLevel");case 2:return v=R.sent,console.log("\u7B49\u7EA7\u9009\u9879",v.data),R.abrupt("return",((H=v.data)===null||H===void 0||(A=H.content)===null||A===void 0?void 0:A.map(function(b){return{label:b.name,value:b.id}}))||[]);case 5:case"end":return R.stop()}},I)})),Q.apply(this,arguments)}G.default=function(){var I=(0,i.useRef)(),H=(0,i.useState)(!1),A=(0,_.Z)(H,2),v=A[0],y=A[1],R=(0,i.useState)(!1),b=(0,_.Z)(R,2),Oe=b[0],z=b[1],Pe=(0,i.useState)(null),q=(0,_.Z)(Pe,2),K=q[0],le=q[1],Ze=(0,i.useState)(null),ee=(0,_.Z)(Ze,2),S=ee[0],ie=ee[1],Ie=g.Z.useForm(),de=(0,_.Z)(Ie,1),F=de[0],Me=(0,i.useState)([]),oe=(0,_.Z)(Me,2),te=oe[0],Le=oe[1],ce=(0,i.useState)(!1),_e=(0,_.Z)(ce,2),se=_e[0],ne=_e[1],ge=(0,i.useState)(),ae=(0,_.Z)(ge,2),l=ae[0],r=ae[1],e=(0,i.useState)(),s=(0,_.Z)(e,2),m=s[0],h=s[1],D=(0,i.useState)("-1"),x=(0,_.Z)(D,2),u=x[0],xe=x[1],We=(0,i.useState)([]),Ae=(0,_.Z)(We,2),be=Ae[0],Fe=Ae[1],Ve=(0,i.useState)([]),Re=(0,_.Z)(Ve,2),Se=Re[0],re=Re[1],$e=(0,i.useState)(!1),Ue=(0,_.Z)($e,2),Te=Ue[0],Ke=Ue[1],ke=function(){var c;I==null||(c=I.current)===null||c===void 0||c.reload()};(0,i.useEffect)(function(){Ne(),He()},[]);var Ne=function(){var f=(0,B.Z)((0,a.Z)().mark(function c(){var d,p,n,j,M;return(0,a.Z)().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return P.next=2,E.Z.get("/sms/share/getDepartment",{_isGetAll:!0});case 2:d=P.sent,p=d.data[0].id,n=d.data.find(function(U){return U.parentId===p}),j=n?d.data.filter(function(U){return U.parentId===p&&U.parentId!=-1}):[],M=j.map(function(U){return(0,w.Z)((0,w.Z)({},U),{},{label:U.name,value:U.id})}),Le(M);case 8:case"end":return P.stop()}},c)}));return function(){return f.apply(this,arguments)}}(),He=function(){var f=(0,B.Z)((0,a.Z)().mark(function c(){var d;return(0,a.Z)().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,De();case 3:d=n.sent,Fe(d),n.next=10;break;case 7:n.prev=7,n.t0=n.catch(0),Z.default.error("\u83B7\u53D6\u5BA2\u6236\u7B49\u7EA7\u9009\u9879\u5931\u8D25");case 10:case"end":return n.stop()}},c,null,[[0,7]])}));return function(){return f.apply(this,arguments)}}(),ze=function(){var f=(0,B.Z)((0,a.Z)().mark(function c(){var d;return(0,a.Z)().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(S!=null&&S.id){n.next=2;break}return n.abrupt("return");case 2:return n.prev=2,Ke(!0),n.next=6,E.Z.postAll("/sms/system/sysUserLevel/correlationStudentLevel/".concat(S.id),Se);case 6:Z.default.success("\u5173\u8054\u6210\u529F"),z(!1),re([]),(d=I.current)===null||d===void 0||d.reload(),n.next=15;break;case 12:n.prev=12,n.t0=n.catch(2),Z.default.error("\u5173\u8054\u5931\u8D25");case 15:return n.prev=15,Ke(!1),n.finish(15);case 18:case"end":return n.stop()}},c,null,[[2,12,15,18]])}));return function(){return f.apply(this,arguments)}}(),Ge=[{title:"\u540D\u79F0",dataIndex:"name"},{title:"\u6240\u5C5E\u516C\u53F8",sorter:!0,dataIndex:"departmentId",search:!1,render:function(c,d){return(0,o.jsx)("span",{children:Ce.Z.getDepartmentName(d.departmentId).join("-")})}},{title:"\u5BA2\u6237\u5BB9\u91CF",dataIndex:"customerCapacity",sorter:!0},{title:"\u9501\u5B9A\u6570\u91CF\u5BB9\u91CF",dataIndex:"lockedCustomerLimit",sorter:!0},{title:"\u63CF\u8FF0",dataIndex:"description",sorter:!0},{title:"\u53EF\u89C1\u7B49\u7EA7",colSpan:2,dataIndex:"studentLevelList",sorter:!0,render:function(c,d){var p;return(0,o.jsx)("span",{children:((p=d.studentLevelList)===null||p===void 0?void 0:p.map(function(n){return n.name}).join(", "))||"\u65E0"})}},{search:!1,colSpan:0,render:function(c,d,p,n){return(0,o.jsx)(X.Z,{size:"small",type:"primary",icon:(0,o.jsx)(Y.Z,{}),onClick:(0,B.Z)((0,a.Z)().mark(function j(){return(0,a.Z)().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:ie(d),d.studentLevelList?(console.log(d.studentLevelList),re(d.studentLevelList.map(function(P){return P.id}))):re([]),z(!0);case 3:case"end":return L.stop()}},j)})),children:"\u7B49\u7EA7"})}},{title:"\u6240\u5C5E\u7528\u6237",dataIndex:"userNameList",colSpan:2,search:!1,ellipsis:!0,tip:"\u8FC7\u957F\u4F1A\u81EA\u52A8\u6536\u7F29"},{search:!1,colSpan:0,render:function(c,d,p,n){return(0,o.jsx)(X.Z,{size:"small",type:"primary",icon:(0,o.jsx)(Y.Z,{}),onClick:(0,B.Z)((0,a.Z)().mark(function j(){var M;return(0,a.Z)().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return console.log(d),P.next=3,E.Z.get("/sms/share/getDepartmentAndUser");case 3:M=P.sent,r({content:M.data,type:"sysuser"}),h(d.userIdList.map(function(U){return{id:U}})),xe(d.id),ne(!0);case 8:case"end":return P.stop()}},j)})),children:"\u7528\u6237"})}},{title:"\u64CD\u4F5C",valueType:"option",render:function(c,d){return[(0,o.jsx)("a",{onClick:function(){le(d),F.setFieldsValue(d),y(!0)},children:"\u7F16\u8F91"},"edit"),(0,o.jsx)(Ee.Z,{title:"\u786E\u8BA4\u5220\u9664\u8BE5\u7B49\u7EA7\uFF1F",onConfirm:(0,B.Z)((0,a.Z)().mark(function p(){var n;return(0,a.Z)().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return M.next=2,E.Z.delete("/sms/system/sysUserLevel",{id:d.id});case 2:Z.default.success("\u5220\u9664\u6210\u529F"),(n=I.current)===null||n===void 0||n.reload();case 4:case"end":return M.stop()}},p)})),children:(0,o.jsx)("a",{children:"\u5220\u9664"})},"del")]}}];return(0,o.jsxs)(J.ZP,{children:[se&&(0,o.jsx)(ye.Z,{CardVisible:se,CardContent:l,callbackRef:function(){return ke()},setCardVisible:function(){return ne(!1)},parentIdTree:u,departments:m}),(0,o.jsx)($.Z,{title:"\u5173\u8054\u5B66\u751F\u7B49\u7EA7 - ".concat((S==null?void 0:S.name)||""),open:Oe,onCancel:function(){z(!1),re([])},onOk:ze,confirmLoading:Te,children:(0,o.jsx)(k.Z,{spinning:Te,children:(0,o.jsx)(g.Z,{layout:"vertical",children:(0,o.jsx)(g.Z.Item,{label:"\u9009\u62E9\u5B66\u751F\u7B49\u7EA7",children:(0,o.jsx)(T.Z,{mode:"multiple",options:be,value:Se,onChange:re,placeholder:"\u8BF7\u9009\u62E9\u5B66\u751F\u7B49\u7EA7",style:{width:"100%"}})})})})}),(0,o.jsx)(N.ZP,{rowKey:"id",columns:Ge,actionRef:I,search:{labelWidth:"auto"},toolBarRender:function(){return[(0,o.jsx)(X.Z,{type:"primary",onClick:function(){le(null),F.resetFields(),y(!0)},children:"\u65B0\u589E"},"new")]},request:function(){var f=(0,B.Z)((0,a.Z)().mark(function c(d){var p,n,j;return(0,a.Z)().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return L.next=2,E.Z.get("/sms/system/sysUserLevel",d);case 2:return j=L.sent,L.abrupt("return",{data:((p=j.data)===null||p===void 0?void 0:p.content)||[],success:!0,total:((n=j.data)===null||n===void 0?void 0:n.totalElements)||0});case 4:case"end":return L.stop()}},c)}));return function(c){return f.apply(this,arguments)}}()}),(0,o.jsx)($.Z,{title:K?"\u7F16\u8F91\u9500\u552E\u7B49\u7EA7":"\u65B0\u589E\u9500\u552E\u7B49\u7EA7",open:v,destroyOnClose:!0,onCancel:function(){return y(!1)},onOk:(0,B.Z)((0,a.Z)().mark(function f(){var c,d;return(0,a.Z)().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,F.validateFields();case 2:if(d=n.sent,!K){n.next=9;break}return n.next=6,E.Z.post("/sms/system/sysUserLevel",(0,w.Z)({id:K.id},d));case 6:Z.default.success("\u66F4\u65B0\u6210\u529F"),n.next=12;break;case 9:return n.next=11,E.Z.post("/sms/system/sysUserLevel",d);case 11:Z.default.success("\u65B0\u589E\u6210\u529F");case 12:y(!1),(c=I.current)===null||c===void 0||c.reload();case 14:case"end":return n.stop()}},f)})),children:(0,o.jsxs)(g.Z,{form:F,layout:"vertical",children:[(0,o.jsx)(g.Z.Item,{label:"\u7B49\u7EA7\u540D\u79F0",name:"name",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u7B49\u7EA7\u540D\u79F0"}],children:(0,o.jsx)(C.Z,{placeholder:"\u8BF7\u8F93\u5165"})}),(0,o.jsx)(g.Z.Item,{name:"departmentId",label:"\u6240\u5C5E\u516C\u53F8",rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u6240\u5C5E\u516C\u53F8"}],children:(0,o.jsx)(T.Z,{style:{width:"100%"},options:te,placeholder:"\u516C\u53F8"})}),(0,o.jsx)(g.Z.Item,{label:"\u5BA2\u6237\u5BB9\u91CF",name:"customerCapacity",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u5BA2\u6237\u5BB9\u91CF"}],children:(0,o.jsx)(V.Z,{min:0,precision:0,style:{width:"100%"}})}),(0,o.jsx)(g.Z.Item,{label:"\u9501\u5B9A\u6570\u91CF\u5BB9\u91CF",name:"lockedCustomerLimit",rules:[{required:!0,message:"\u9501\u5B9A\u6570\u91CF\u5BB9\u91CF"}],children:(0,o.jsx)(V.Z,{min:0,precision:0,style:{width:"100%"}})}),(0,o.jsx)(g.Z.Item,{label:"\u63CF\u8FF0",name:"description",children:(0,o.jsx)(C.Z.TextArea,{rows:3})})]})})]})}}}]);
