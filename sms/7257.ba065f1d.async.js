(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[7257],{57257:function(he,q,n){"use strict";n.d(q,{Z:function(){return fe}});var Ze=n(62350),_=n(24565),ye=n(34792),g=n(48086),f=n(39428),V=n(3182),be=n(57663),I=n(71577),E=n(11849),ge=n(402),ee=n(97272),T=n(2824),te=n(22),B=n(63863),v=n(67294),Ce=n(43185),ne=n(43027),Fe=n(12968),G=n(20352),k=n(952),z=n(37476),N=n(5966),L=n(90672),J=n(80876),t=n(85893),ae=function(m){var w=m.setModalVisible,Z=m.modalVisible,M=m.callbackRef,e=m.renderData,P=(0,v.useState)(!1),p=(0,T.Z)(P,2),A=p[0],i=p[1],h=(0,v.useState)(),l=(0,T.Z)(h,2),o=l[0],C=l[1],F=(0,v.useRef)();(0,v.useEffect)(function(){((e==null?void 0:e.type)=="eidt"||(e==null?void 0:e.type)=="eidtTitle")&&(e==null?void 0:e.renderDataNumber)===0&&(setTimeout(function(){var u;F==null||(u=F.current)===null||u===void 0||u.setFieldsValue({name:e.name,parameter:e.parameter,description:e.description,file:[{uid:"1",name:e.file,response:{data:e.file}}],newFile:e.newFile?[{uid:"1",name:e.newFile,response:{data:e.newFile}}]:[]})},100),++e.renderDataNumber)},[]);var c=sessionStorage.getItem("tokenName"),y=sessionStorage.getItem("tokenValue"),d={};d[c]=y;var S=function(r){return new Promise(function(a){B.Z.post("/sms/contract/conTemplate",r).then(function(x){x.status=="success"&&(g.default.success("\u64CD\u4F5C\u6210\u529F!"),w(),M(),a(!0))}).catch(function(x){a(!0)})})};return(0,t.jsxs)(z.Y,{width:700,formRef:F,onFinish:function(){var u=(0,V.Z)((0,f.Z)().mark(function r(a){return(0,f.Z)().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return((e==null?void 0:e.type)=="eidt"||(e==null?void 0:e.type)=="eidtTitle")&&(a.id=e.id),a.file&&(a.file=a.file[a.file.length-1].response.data),a.newFile&&(a.newFile=a.newFile[a.newFile.length-1].response.data),(e==null?void 0:e.type)=="eidtTitle"&&delete a.file,R.next=6,S(a);case 6:case"end":return R.stop()}},r)}));return function(r){return u.apply(this,arguments)}}(),modalProps:{destroyOnClose:!0,onCancel:function(){w()},maskClosable:!1},visible:Z,children:[(0,t.jsx)(N.Z,{label:"\u5408\u540C\u6A21\u677F\u540D\u79F0",name:"name",rules:[{required:!0,message:"\u8BF7\u586B\u5199\u5408\u540C\u6A21\u677F\u540D\u79F0"}]}),(0,t.jsx)(L.Z,{label:"\u6CE8\u91CA",name:"description"}),(0,t.jsxs)(k.ZP.Group,{children:[(0,t.jsx)(J.Z,{width:630,label:"\u4E0A\u4F20\u4E0B\u8F7D\u5408\u540C",name:"newFile",action:"/sms/contract/conTemplate/upload",fieldProps:{multiple:!1,headers:(0,E.Z)({},d),listType:"picture",defaultFileList:[],onPreview:function(){var u=(0,V.Z)((0,f.Z)().mark(function a(x){return(0,f.Z)().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:C(x.thumbUrl),i(!0);case 2:case"end":return j.stop()}},a)}));function r(a){return u.apply(this,arguments)}return r}(),onChange:function(r){var a=r.file.status;a==="done"?g.default.success("".concat(r.file.name," \u4E0A\u4F20\u6210\u529F.")):a==="error"&&g.default.error("".concat(r.file.name," \u4E0A\u4F20\u5931\u8D25."))}}}),(0,t.jsx)("div",{style:{display:"none"},children:(0,t.jsx)(G.Z,{width:200,style:{display:"none"},preview:{visible:A,src:o,onVisibleChange:function(r){i(r)}}})})]}),(0,t.jsxs)(k.ZP.Group,{children:[(0,t.jsx)(J.Z,{width:630,hidden:(e==null?void 0:e.type)=="eidtTitle",label:"\u4E0A\u4F20\u5408\u540C\u6A21\u677F",name:"file",action:"/sms/contract/conTemplate/upload",fieldProps:{multiple:!1,headers:(0,E.Z)({},d),listType:"picture",defaultFileList:[],beforeUpload:function(r){if(r.type!="application/pdf")return g.default.error("\u53EA\u80FD\u4E0A\u4F20PDF\u683C\u5F0F"),ne.Z.LIST_IGNORE},onPreview:function(){var u=(0,V.Z)((0,f.Z)().mark(function a(x){return(0,f.Z)().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:C(x.thumbUrl),i(!0);case 2:case"end":return j.stop()}},a)}));function r(a){return u.apply(this,arguments)}return r}(),onChange:function(r){var a=r.file.status;a==="done"?g.default.success("".concat(r.file.name," \u4E0A\u4F20\u6210\u529F.")):a==="error"&&g.default.error("".concat(r.file.name," \u4E0A\u4F20\u5931\u8D25."))}}}),(0,t.jsx)("div",{style:{display:"none"},children:(0,t.jsx)(G.Z,{width:200,style:{display:"none"},preview:{visible:A,src:o,onVisibleChange:function(r){i(r)}}})})]})]})},ie=n(59962),Y=n(64317),le=n(37490),re=n(18613),se=n(73218),ue=function(m){var w=m.setModalVisible,Z=m.modalVisible,M=m.callbackRef,e=m.renderData,P=(0,v.useRef)(),p=(0,v.useRef)();(e==null?void 0:e.parameter.length)>0&&e.recordNumber===0&&(e==null||e.parameter.forEach(function(i){i.type=i.type+"",i.isRequired=i.isRequired+""}),setTimeout(function(){var i;p==null||(i=p.current)===null||i===void 0||i.setFieldsValue({labels:e.parameter})},100));var A=function(h){return new Promise(function(l){B.Z.postAll("/sms/contract/conParameter/saveArray",{array:h.labels}).then(function(o){o.status=="success"&&(g.default.success("\u64CD\u4F5C\u6210\u529F!"),w(),M(),l(!0))}).catch(function(o){l(!0)})})};return(0,t.jsxs)(z.Y,{width:1e3,formRef:p,onFinish:function(){var i=(0,V.Z)((0,f.Z)().mark(function h(l){var o,C;return(0,f.Z)().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return(e==null?void 0:e.type)=="eidt"&&(l.id=e.id),l.batchCode&&(o=JSON.parse(l.batchCode),C=function y(){o.forEach(function(d,S){if(d.code=="partBCardNo"||d.code=="partBCardBankName"||d.code=="confirmTotalAmount"||d.code=="gnNameNm"||d.code=="totalAmountBig"||d.code=="gnNameNmOneAmountBig"||d.code=="gnNameNmTwoAmountBig"){o.splice(S,1),y();return}})},C(),o.forEach(function(y){delete y.id,y.templateId=e.id}),l.labels=o,delete l.batchCode),c.next=4,A(l);case 4:case"end":return c.stop()}},h)}));return function(h){return i.apply(this,arguments)}}(),modalProps:{destroyOnClose:!0,onCancel:function(){w()},maskClosable:!1},visible:Z,children:[(0,t.jsx)(ie.u,{actionRef:P,name:"labels",label:"\u5408\u540C\u8868\u5355\u4FE1\u606F",actionGuard:{beforeRemoveRow:function(){var i=(0,V.Z)((0,f.Z)().mark(function l(o,C){return(0,f.Z)().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",new Promise(function(y){if(e.parameter.length>=o&&e.parameter!=!1){var d=e.parameter.splice(o,1);B.Z.delete("/sms/contract/conParameter",{id:d[0].id}).then(function(S){S.status=="success"&&(g.default.success("\u5220\u9664\u6210\u529F"),y(!0))})}else y(!0)}));case 1:case"end":return c.stop()}},l)}));function h(l,o){return i.apply(this,arguments)}return h}()},initialValue:[{isRequired:"false",templateId:e.id}],creatorRecord:{templateId:e.id,isRequired:"false"},copyIconProps:{Icon:re.Z,tooltipText:"\u590D\u5236\u6B64\u884C\u5230\u672B\u5C3E"},deleteIconProps:{Icon:se.Z,tooltipText:"\u4E0D\u9700\u8981\u8FD9\u884C\u4E86"},children:(0,t.jsxs)(k.ZP.Group,{children:[(0,t.jsx)(N.Z,{name:"name",label:"\u8868\u5355\u540D\u79F0"}),(0,t.jsx)(N.Z,{name:"code",label:"\u8868\u5355\u4EE3\u7801"}),(0,t.jsx)(Y.Z,{label:"\u8868\u5355\u7C7B\u578B",width:100,name:"type",request:(0,V.Z)((0,f.Z)().mark(function i(){return(0,f.Z)().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",le.Z.getList("contract_type"));case 1:case"end":return l.stop()}},i)}))}),(0,t.jsx)(Y.Z,{label:"\u662F\u5426\u5FC5\u586B",width:100,name:"isRequired",valueEnum:{true:"\u662F",false:"\u5426"},fieldProps:{defaultValue:"false"}}),(0,t.jsx)(N.Z,{width:80,name:"sort",label:"\u6392\u5E8F"}),(0,t.jsx)(N.Z,{name:"templateId",fieldProps:{style:{display:"none"}}})]},"group")}),(0,t.jsx)(k.ZP.Group,{title:"\u6279\u91CF\u4EE3\u7801\u4E0A\u4F20"}),(0,t.jsx)(L.Z,{label:"\u4E0A\u4F20\u4EE3\u7801",name:"batchCode"})]})},H=n(51042),oe=n(35562),de=n(41574),ce=n(68503),fe=function(m){var w=m.type,Z=w===void 0?"":w,M=m.setCompanyId,e=m.onCancel,P=m.Users,p=P===void 0?!1:P,A=(0,v.useState)(null),i=(0,T.Z)(A,2),h=i[0],l=i[1],o=(0,v.useState)(!1),C=(0,T.Z)(o,2),F=C[0],c=C[1],y=(0,v.useState)(!1),d=(0,T.Z)(y,2),S=d[0],u=d[1],r=(0,v.useState)(!1),a=(0,T.Z)(r,2),x=a[0],R=a[1],j=(0,v.useState)(),K=(0,T.Z)(j,2),me=K[0],pe=K[1],Q=(0,v.useRef)(),O=function(){Q.current.reload()},ve=[{title:"\u6A21\u677F\u540D\u79F0",dataIndex:"name"},{title:"\u6A21\u677F\u5B57\u6BB5",dataIndex:"parameter",hideInTable:Z!==""||p,search:!1,colSpan:2,ellipsis:!0,tip:"\u8FC7\u957F\u4F1A\u81EA\u52A8\u6536\u7F29",render:function(U,s){return(0,t.jsxs)(ee.Z.Paragraph,{copyable:{text:JSON.stringify(s.parameter)},children:[s.parameter?s.parameter.length:0,"\u4E2A\u53C2\u6570"]})}},{width:80,search:!1,hideInTable:Z!==""||p,colSpan:0,render:function(U,s){return(0,t.jsx)(I.Z,{size:"small",type:"primary",icon:(0,t.jsx)(H.Z,{}),onClick:function(){l((0,E.Z)((0,E.Z)({},s),{},{recordNumber:0})),u(!0)},children:"\u7F16\u8F91"})}},{title:"\u6CD5\u5927\u5927\u7F16\u53F7",dataIndex:"num",hideInTable:Z!==""||p,search:!1},{title:"\u67E5\u770B",search:!1,render:function(U,s){return(0,t.jsx)("a",{onClick:(0,V.Z)((0,f.Z)().mark(function D(){return(0,f.Z)().wrap(function($){for(;;)switch($.prev=$.next){case 0:return $.next=2,(0,oe.Z)("/sms/contract/conTemplate/download",s.id,s.file).then(function(X){console.log("res",X),pe(X.pdfUrl[0]),R(!0)});case 2:case"end":return $.stop()}},D)})),children:"\u67E5\u770B"})}},{title:"\u5907\u6CE8",dataIndex:"description",search:!1,ellipsis:!0,tip:"\u8FC7\u957F\u4F1A\u81EA\u52A8\u6536\u7F29"},{title:"\u4E0A\u4F20\u65F6\u95F4",dataIndex:"updateTime",sorter:!0,valueType:"dateRange",render:function(U,s){return(0,t.jsx)("span",{children:s.updateTime})}},{title:"\u64CD\u4F5C",dataIndex:"options",search:!1,render:function(U,s){return[(0,t.jsx)(I.Z,{type:"primary",size:"small",hidden:Z==="contract"||p,style:{marginRight:"15px"},onClick:function(){l((0,E.Z)((0,E.Z)({},s),{},{type:"eidtTitle",renderDataNumber:0})),c(!0)},children:"\u7F16\u8F91\u5408\u540C\u540D\u79F0"},"eidt"),(0,t.jsx)(I.Z,{type:"primary",size:"small",hidden:Z==="contract",style:{marginRight:"15px"},onClick:function(){s!=null&&s.newFile?(0,ce.Z)("/sms/contract/conTemplate/download",s.id,s.newFile,"".concat(s.newFile)):g.default.error("\u8BE5\u5408\u540C\u8FD8\u6CA1\u4E0A\u4F20\u6A21\u677F\u3002")},children:"\u4E0B\u8F7D"},"upload"),(0,t.jsx)(_.Z,{title:"\u662F\u5426\u5220\u9664",okText:"\u5220\u9664",cancelText:"\u53D6\u6D88",onConfirm:function(){B.Z.delete("/sms/contract/conTemplate",{id:s.id}).then(function(W){W.status=="success"&&(g.default.success("\u64CD\u4F5C\u6210\u529F!"),O())})},children:(0,t.jsx)(I.Z,{hidden:Z==="contract"||p,type:"primary",size:"small",danger:!0,children:"\u5220\u9664"},"delete")},"deletes"),(0,t.jsx)(I.Z,{hidden:Z==="",type:"primary",onClick:function(){M(s),e()},children:"\u9009\u62E9"},"xuanze")]}}];return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(te.Z,{actionRef:Q,columns:ve,request:{url:"/sms/contract/conTemplate"},toolBarRender:[(0,t.jsx)(I.Z,{icon:(0,t.jsx)(H.Z,{}),hidden:p,type:"primary",onClick:function(){l({type:"add"}),c(!0)},children:"\u4E0A\u4F20\u5408\u540C\u6A21\u677F"},"button")]}),F&&(0,t.jsx)(ae,{setModalVisible:function(){return c(!1)},modalVisible:F,renderData:h,callbackRef:function(){return O()}}),S&&(0,t.jsx)(ue,{setModalVisible:function(){return u(!1)},modalVisible:S,renderData:h,callbackRef:function(){return O()}}),(0,t.jsx)(de.Z,{previewVisible:x,setPreviewVisible:function(){return R(!1)},previewImage:me})]})}}}]);
