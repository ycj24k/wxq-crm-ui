(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[6686],{21155:function(we,ee,n){"use strict";n.r(ee),n.d(ee,{default:function(){return $e}});var Me=n(71194),ne=n(50146),Ne=n(49111),X=n(19650),Ve=n(57663),g=n(71577),ze=n(43358),O=n(34041),ke=n(47673),z=n(4107),G=n(11849),We=n(62350),he=n(24565),Ye=n(77576),pe=n(12028),v=n(39428),Ge=n(34792),$=n(48086),A=n(3182),He=n(9715),a=n(55843),C=n(2824),j=n(67294),Ze=n(71906),je=n(66801),Ke=n(77883),Fe=n(49747),Le=n(13062),ae=n(71230),Ue=n(89032),h=n(15746),xe=n(51042),le=n(28991),ye={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M872 474H152c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h720c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8z"}}]},name:"minus",theme:"outlined"},ge=ye,Ce=n(27029),be=function(D,I){return j.createElement(Ce.Z,(0,le.Z)((0,le.Z)({},D),{},{ref:I,icon:ge}))},Ie=j.forwardRef(be),Ee=Ie,R=n(63863),e=n(85893),Se=[{label:"\u5F55\u5165\u540E\u901A\u77E5",value:0},{label:"\u8DDF\u8FDB\u540E\u901A\u77E5",value:1},{label:"\u6210\u4EA4\u540E\u901A\u77E5",value:2}],Be=[{label:"\u5929",value:"\u5929"},{label:"\u5C0F\u65F6",value:"\u5C0F\u65F6"},{label:"\u5206\u949F",value:"\u5206\u949F"}],Oe=[{label:"\u5168\u9009",value:"all"},{label:"\u521B\u5EFA\u4EBA",value:"creator"},{label:"\u8D1F\u8D23\u4EBA",value:"owner"},{label:"\u4E0A\u7EA7",value:"leader"}],Re=[{label:"\u6A21\u677F\u6D88\u606F",value:"\u6A21\u677F\u6D88\u606F"},{label:"\u7AD9\u5185\u4FE1",value:"\u7AD9\u5185\u4FE1"},{label:"\u77ED\u4FE1",value:"\u77ED\u4FE1"},{label:"\u4F01\u4E1A\u5FAE\u4FE1",value:"\u4F01\u4E1A\u5FAE\u4FE1"}],De=function(D){var I=D.open,k=D.onClose,p=D.templateId,J=a.Z.useForm(),H=(0,C.Z)(J,1),E=H[0],W=(0,j.useMemo)(function(){return{\u5929:86400,\u5C0F\u65F6:3600,\u5206\u949F:60}},[]);return(0,j.useEffect)(function(){var S=!1,F=function(){var d=(0,A.Z)((0,v.Z)().mark(function B(){var s,r,Z;return(0,v.Z)().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(I){u.next=2;break}return u.abrupt("return");case 2:if(u.prev=2,s=[{}],!p){u.next=11;break}return u.next=7,R.Z.getSOPRules(p);case 7:r=u.sent,Z=Array.isArray(r.data)?r.data:[],s=Z.map(function(Y){var T=Number(Y.triggerTime||0),P="\u5206\u949F",w=0;T%86400==0?(P="\u5929",w=T/86400):T%3600==0?(P="\u5C0F\u65F6",w=T/3600):(P="\u5206\u949F",w=Math.max(1,Math.round(T/60)));var K=(Y.receivers||"").split(",").filter(function(Q){return Q});return{event:Y.event,duration:w,unit:P,receivers:K,notifyWays:["\u6A21\u677F\u6D88\u606F"]}}),s.length||(s=[{}]);case 11:S||E.setFieldsValue({rules:s}),u.next=17;break;case 14:u.prev=14,u.t0=u.catch(2),S||E.setFieldsValue({rules:[{}]});case 17:case"end":return u.stop()}},B,null,[[2,14]])}));return function(){return d.apply(this,arguments)}}();return F(),function(){S=!0}},[I,p]),(0,e.jsx)(ne.Z,{title:"\u914D\u7F6E\u89C4\u5219",open:I,onCancel:k,centered:!0,destroyOnClose:!0,width:960,footer:(0,e.jsxs)(X.Z,{children:[(0,e.jsx)(g.Z,{onClick:k,children:"\u53D6\u6D88"}),(0,e.jsx)(g.Z,{type:"primary",onClick:(0,A.Z)((0,v.Z)().mark(function S(){var F,d;return(0,v.Z)().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,E.validateFields();case 2:return F=s.sent,d=(F.rules||[]).map(function(r){var Z;return{event:(Z=r.event)!==null&&Z!==void 0?Z:0,id:0,isDel:0,receivers:(r.receivers||[]).join(","),sopId:p,triggerMode:0,triggerTime:Number(r.duration||0)*(W[r.unit||"\u5206\u949F"]||60)}}),s.next=6,R.Z.saveSOPRules(Number(p),d);case 6:$.default.success("\u4FDD\u5B58\u6210\u529F"),k();case 8:case"end":return s.stop()}},S)})),children:"\u4FDD\u5B58"})]}),bodyStyle:{overflowX:"hidden"},children:(0,e.jsxs)(a.Z,{form:E,layout:"vertical",initialValues:{rules:[{}]},children:[(0,e.jsxs)(ae.Z,{gutter:16,style:{marginBottom:8,color:"#555"},children:[(0,e.jsx)(h.Z,{span:5,children:"\u4E8B\u4EF6"}),(0,e.jsx)(h.Z,{span:4,children:"\u591A\u4E45\u63D0\u9192"}),(0,e.jsx)(h.Z,{span:3,children:"\u5355\u4F4D"}),(0,e.jsx)(h.Z,{span:6,children:"\u63A5\u6536\u4EBA\uFF08\u591A\u9009\uFF09"}),(0,e.jsx)(h.Z,{span:6,children:"\u63D0\u9192\u65B9\u5F0F"})]}),(0,e.jsx)(a.Z.List,{name:"rules",children:function(F,d){var B=d.add,s=d.remove;return(0,e.jsxs)(e.Fragment,{children:[F.map(function(r){return(0,e.jsxs)(ae.Z,{gutter:16,style:{marginBottom:12},children:[(0,e.jsx)(h.Z,{span:5,children:(0,e.jsx)(a.Z.Item,{label:!1,name:[r.name,"event"],rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u4E8B\u4EF6"}],children:(0,e.jsx)(O.Z,{options:Se,placeholder:"\u8BF7\u9009\u62E9\u4E8B\u4EF6"})})}),(0,e.jsx)(h.Z,{span:4,children:(0,e.jsx)(a.Z.Item,{label:!1,name:[r.name,"duration"],rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u65F6\u957F"}],children:(0,e.jsx)(Fe.Z,{min:1,precision:0,style:{width:"100%"},placeholder:"\u8BF7\u8F93\u5165"})})}),(0,e.jsx)(h.Z,{span:3,children:(0,e.jsx)(a.Z.Item,{label:!1,name:[r.name,"unit"],initialValue:"\u5929",rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u5355\u4F4D"}],children:(0,e.jsx)(O.Z,{options:Be,placeholder:"\u5355\u4F4D"})})}),(0,e.jsx)(h.Z,{span:6,children:(0,e.jsx)(a.Z.Item,{label:!1,name:[r.name,"receivers"],rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u63A5\u6536\u4EBA"}],children:(0,e.jsx)(O.Z,{mode:"multiple",options:Oe,placeholder:"\u8BF7\u9009\u62E9"})})}),(0,e.jsx)(h.Z,{span:4,children:(0,e.jsx)(a.Z.Item,{label:!1,name:[r.name,"notifyWays"],rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u63D0\u9192\u65B9\u5F0F"}],children:(0,e.jsx)(O.Z,{mode:"multiple",options:Re,placeholder:"\u8BF7\u9009\u62E9"})})}),(0,e.jsx)(h.Z,{span:2,style:{display:"flex",alignItems:"baseline",justifyContent:"flex-start",paddingTop:4},children:(0,e.jsxs)(X.Z,{size:8,children:[(0,e.jsx)(g.Z,{shape:"circle",size:"small",icon:(0,e.jsx)(xe.Z,{}),onClick:function(){return B({})}}),(0,e.jsx)(g.Z,{shape:"circle",size:"small",icon:(0,e.jsx)(Ee,{}),disabled:F.length<=1,onClick:function(){F.length>1&&s(r.name)}})]})})]},r.key)}),(0,e.jsx)("div",{style:{textAlign:"center"},children:(0,e.jsx)(g.Z,{onClick:function(){return B({})},children:"\u6DFB\u52A0"})})]})}})]})})},Te=De,re=[{label:"\u5BA2\u6237\u8DDF\u8FDB",value:"\u5BA2\u6237\u8DDF\u8FDB"},{label:"\u4E0B\u5355\u610F\u613F",value:"\u4E0B\u5355\u610F\u613F"}],$e=function(){var b=(0,j.useRef)(),D=(0,j.useState)(!1),I=(0,C.Z)(D,2),k=I[0],p=I[1],J=(0,j.useState)(null),H=(0,C.Z)(J,2),E=H[0],W=H[1],S=a.Z.useForm(),F=(0,C.Z)(S,1),d=F[0],B=(0,j.useState)(!1),s=(0,C.Z)(B,2),r=s[0],Z=s[1],te=(0,j.useState)(),u=(0,C.Z)(te,2),Y=u[0],T=u[1],P=a.Z.useForm(),w=(0,C.Z)(P,1),K=w[0],Q=(0,j.useState)({}),se=(0,C.Z)(Q,2),Ae=se[0],ue=se[1],Pe=[{title:"\u89C4\u5219\u540D\u79F0",dataIndex:"name",width:180},{title:"\u5206\u7C7B",dataIndex:"category",width:140,hideInSearch:!0},{title:"\u5F00\u542F/\u5173\u95ED",dataIndex:"enable",width:140,align:"center",render:function(t,l){return(0,e.jsx)(pe.Z,{checked:!!l.enable,onChange:function(){var i=(0,A.Z)((0,v.Z)().mark(function c(o){var m;return(0,v.Z)().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.prev=0,f.next=3,R.Z.post("/sms/sop/template/toggle",{id:l.id,enable:o});case 3:$.default.success("\u72B6\u6001\u5DF2\u66F4\u65B0"),(m=b.current)===null||m===void 0||m.reload(),f.next=10;break;case 7:f.prev=7,f.t0=f.catch(0),$.default.error("\u5207\u6362\u5931\u8D25");case 10:case"end":return f.stop()}},c,null,[[0,7]])}));return function(c){return i.apply(this,arguments)}}()})},hideInSearch:!0},{title:"\u9879\u76EE\u540D\u79F0",dataIndex:"project",width:160},{title:"\u63CF\u8FF0",dataIndex:"description",ellipsis:!0},{title:"\u64CD\u4F5C",valueType:"option",width:200,render:function(t,l){return[(0,e.jsx)("a",{onClick:function(){W(l),d.setFieldsValue(l),p(!0)},children:"\u67E5\u770B"},"view"),(0,e.jsx)("a",{onClick:function(){W(l),d.setFieldsValue(l),p(!0)},children:"\u7F16\u8F91"},"edit"),(0,e.jsx)("a",{onClick:function(){T(l.id),Z(!0)},children:"\u914D\u7F6E\u89C4\u5219"},"config"),(0,e.jsx)(he.Z,{title:"\u786E\u8BA4\u5220\u9664\u8BE5\u6A21\u677F\uFF1F",onConfirm:(0,A.Z)((0,v.Z)().mark(function i(){var c;return(0,v.Z)().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,R.Z.delete("/sms/sop/template",{id:l.id});case 2:$.default.success("\u5220\u9664\u6210\u529F"),(c=b.current)===null||c===void 0||c.reload();case 4:case"end":return m.stop()}},i)})),children:(0,e.jsx)("a",{children:"\u5220\u9664"})},"del")]}}];return(0,e.jsxs)(Ze.ZP,{children:[(0,e.jsx)("div",{style:{background:"#fff",border:"1px solid #f0f0f0",borderRadius:4,padding:16,marginBottom:16},children:(0,e.jsxs)(a.Z,{form:K,layout:"inline",onFinish:function(t){var l,i=t.enable===void 0?void 0:t.enable==="true"?!0:t.enable==="false"?!1:void 0,c=(0,G.Z)((0,G.Z)({},t),{},{enable:i});ue(c),(l=b.current)===null||l===void 0||l.reload()},children:[(0,e.jsx)(a.Z.Item,{label:"\u89C4\u5219\u540D\u79F0",name:"name",children:(0,e.jsx)(z.Z,{allowClear:!0,placeholder:"\u8BF7\u8F93\u5165",style:{width:220}})}),(0,e.jsx)(a.Z.Item,{label:"\u5206\u7C7B",name:"category",children:(0,e.jsx)(O.Z,{allowClear:!0,placeholder:"\u8BF7\u9009\u62E9",style:{width:180},options:re})}),(0,e.jsx)(a.Z.Item,{label:"\u9879\u76EE\u540D\u79F0",name:"project",children:(0,e.jsx)(z.Z,{allowClear:!0,placeholder:"\u8BF7\u8F93\u5165",style:{width:220}})}),(0,e.jsx)(a.Z.Item,{label:"\u542F\u7528",name:"enable",initialValue:void 0,children:(0,e.jsx)(O.Z,{allowClear:!0,placeholder:"\u5168\u90E8",style:{width:140},options:[{label:"\u5168\u90E8",value:void 0},{label:"\u5DF2\u542F\u7528",value:"true"},{label:"\u672A\u542F\u7528",value:"false"}]})}),(0,e.jsx)(a.Z.Item,{children:(0,e.jsxs)(X.Z,{children:[(0,e.jsx)(g.Z,{type:"primary",htmlType:"submit",children:"\u67E5\u8BE2"}),(0,e.jsx)(g.Z,{onClick:function(){var t;K.resetFields(),ue({}),(t=b.current)===null||t===void 0||t.reload()},children:"\u91CD\u7F6E"})]})})]})}),(0,e.jsx)(je.ZP,{rowKey:"id",columns:Pe,actionRef:b,search:!1,size:"middle",options:!1,scroll:{x:1e3,y:"calc(100vh - 380px)"},toolBarRender:function(){return[(0,e.jsx)(g.Z,{type:"primary",onClick:function(){W(null),d.resetFields(),p(!0)},children:"\u6DFB\u52A0"},"new")]},request:function(){var x=(0,A.Z)((0,v.Z)().mark(function t(l,i){var c,o,m,q,f,M,ie,oe,de,ce,ve,me,fe,L,y,_;return(0,v.Z)().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:return m=l,q=m.current,f=m.pageSize,M=Ae,ie=M.name,oe=M.project,de=M.description,ce=M.enable,ve=M.category,i&&typeof i=="object"&&(L=Object.keys(i),L.length&&(me=L.join(","),fe=L.map(function(U){var V;return((V=i[U])===null||V===void 0?void 0:V.order)==="ascend"?"asc":"desc"}).join(","))),y={name:ie,category:ve,project:oe,description:de,enable:ce,_page:q,_size:f,_orderBy:me,_direction:fe},Object.keys(y).forEach(function(U){var V=y[U];(V===void 0||V==="")&&delete y[U]}),y.enable!==void 0&&(y.enable=y.enable===!0||y.enable==="true"),N.next=8,R.Z.getSOPTemplates(y);case 8:return _=N.sent,N.abrupt("return",{data:((c=_.data)===null||c===void 0?void 0:c.content)||[],success:!0,total:((o=_.data)===null||o===void 0?void 0:o.totalElements)||0});case 10:case"end":return N.stop()}},t)}));return function(t,l){return x.apply(this,arguments)}}()}),(0,e.jsx)(ne.Z,{title:E?"\u7F16\u8F91SOP\u6A21\u677F":"\u65B0\u589ESOP\u6A21\u677F",open:k,destroyOnClose:!0,onCancel:function(){return p(!1)},onOk:(0,A.Z)((0,v.Z)().mark(function x(){var t,l,i;return(0,v.Z)().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,d.validateFields();case 2:if(l=o.sent,!E){o.next=10;break}return i=(0,G.Z)((0,G.Z)({},l),{},{id:E.id}),o.next=7,R.Z.post("/sms/sop/template/update",i);case 7:$.default.success("\u66F4\u65B0\u6210\u529F"),o.next=13;break;case 10:return o.next=12,R.Z.post("/sms/sop/template",l);case 12:$.default.success("\u65B0\u589E\u6210\u529F");case 13:p(!1),(t=b.current)===null||t===void 0||t.reload();case 15:case"end":return o.stop()}},x)})),children:(0,e.jsxs)(a.Z,{form:d,layout:"vertical",children:[(0,e.jsx)(a.Z.Item,{label:"\u89C4\u5219\u540D\u79F0",name:"name",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u89C4\u5219\u540D\u79F0"}],children:(0,e.jsx)(z.Z,{placeholder:"\u8BF7\u8F93\u5165"})}),(0,e.jsx)(a.Z.Item,{label:"\u5206\u7C7B",name:"category",children:(0,e.jsx)(O.Z,{placeholder:"\u8BF7\u9009\u62E9",options:re})}),(0,e.jsx)(a.Z.Item,{label:"\u9879\u76EE\u540D\u79F0",name:"project",children:(0,e.jsx)(z.Z,{placeholder:"\u8BF7\u8F93\u5165"})}),(0,e.jsx)(a.Z.Item,{label:"\u63CF\u8FF0",name:"description",children:(0,e.jsx)(z.Z.TextArea,{rows:3})})]})}),(0,e.jsx)(Te,{open:r,templateId:Y,onClose:function(){return Z(!1)}})]})}}}]);
