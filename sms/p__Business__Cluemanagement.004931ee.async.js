(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[1557],{54618:function(We,ee,n){"use strict";n.d(ee,{Z:function(){return T}});var G=n(28991),L=n(67294),ue={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M908 640H804V488c0-4.4-3.6-8-8-8H548v-96h108c8.8 0 16-7.2 16-16V80c0-8.8-7.2-16-16-16H368c-8.8 0-16 7.2-16 16v288c0 8.8 7.2 16 16 16h108v96H228c-4.4 0-8 3.6-8 8v152H116c-8.8 0-16 7.2-16 16v288c0 8.8 7.2 16 16 16h288c8.8 0 16-7.2 16-16V656c0-8.8-7.2-16-16-16H292v-88h440v88H620c-8.8 0-16 7.2-16 16v288c0 8.8 7.2 16 16 16h288c8.8 0 16-7.2 16-16V656c0-8.8-7.2-16-16-16zm-564 76v168H176V716h168zm84-408V140h168v168H428zm420 576H680V716h168v168z"}}]},name:"apartment",theme:"outlined"},te=ue,X=n(27029),R=function(B,h){return L.createElement(X.Z,(0,G.Z)((0,G.Z)({},B),{},{ref:h,icon:te}))},se=L.forwardRef(R),T=se},31223:function(We,ee,n){"use strict";n.d(ee,{Z:function(){return T}});var G=n(28991),L=n(67294),ue={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M678.3 642.4c24.2-13 51.9-20.4 81.4-20.4h.1c3 0 4.4-3.6 2.2-5.6a371.67 371.67 0 00-103.7-65.8c-.4-.2-.8-.3-1.2-.5C719.2 505 759.6 431.7 759.6 349c0-137-110.8-248-247.5-248S264.7 212 264.7 349c0 82.7 40.4 156 102.6 201.1-.4.2-.8.3-1.2.5-44.7 18.9-84.8 46-119.3 80.6a373.42 373.42 0 00-80.4 119.5A373.6 373.6 0 00137 888.8a8 8 0 008 8.2h59.9c4.3 0 7.9-3.5 8-7.8 2-77.2 32.9-149.5 87.6-204.3C357 628.2 432.2 597 512.2 597c56.7 0 111.1 15.7 158 45.1a8.1 8.1 0 008.1.3zM512.2 521c-45.8 0-88.9-17.9-121.4-50.4A171.2 171.2 0 01340.5 349c0-45.9 17.9-89.1 50.3-121.6S466.3 177 512.2 177s88.9 17.9 121.4 50.4A171.2 171.2 0 01683.9 349c0 45.9-17.9 89.1-50.3 121.6C601.1 503.1 558 521 512.2 521zM880 759h-84v-84c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v84h-84c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h84v84c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-84h84c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8z"}}]},name:"user-add",theme:"outlined"},te=ue,X=n(27029),R=function(B,h){return L.createElement(X.Z,(0,G.Z)((0,G.Z)({},B),{},{ref:h,icon:te}))},se=L.forwardRef(R),T=se},31199:function(We,ee,n){"use strict";var G=n(28991),L=n(81253),ue=n(85893),te=n(67294),X=n(53048),R=["fieldProps","min","proFieldProps","max"],se=function(y,B){var h=y.fieldProps,k=y.min,le=y.proFieldProps,o=y.max,f=(0,L.Z)(y,R);return(0,ue.jsx)(X.Z,(0,G.Z)({valueType:"digit",fieldProps:(0,G.Z)({min:k,max:o},h),ref:B,filedConfig:{defaultProps:{width:"100%"}},proFieldProps:le},f))};ee.Z=te.forwardRef(se)},64317:function(We,ee,n){"use strict";var G=n(28991),L=n(81253),ue=n(85893),te=n(96202),X=n(67294),R=n(66758),se=n(53048),T=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","showSearch","options"],y=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","options"],B=X.forwardRef(function(f,Ze){var ge=f.fieldProps,Te=f.children,Se=f.params,ke=f.proFieldProps,t=f.mode,Me=f.valueEnum,Ue=f.request,Be=f.showSearch,Ve=f.options,Ge=(0,L.Z)(f,T),Ne=(0,X.useContext)(R.Z);return(0,ue.jsx)(se.Z,(0,G.Z)((0,G.Z)({valueEnum:(0,te.h)(Me),request:Ue,params:Se,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,G.Z)({options:Ve,mode:t,showSearch:Be,getPopupContainer:Ne.getPopupContainer},ge),ref:Ze,proFieldProps:ke},Ge),{},{children:Te}))}),h=X.forwardRef(function(f,Ze){var ge=f.fieldProps,Te=f.children,Se=f.params,ke=f.proFieldProps,t=f.mode,Me=f.valueEnum,Ue=f.request,Be=f.options,Ve=(0,L.Z)(f,y),Ge=(0,G.Z)({options:Be,mode:t||"multiple",labelInValue:!0,showSearch:!0,showArrow:!1,autoClearSearchValue:!0,optionLabelProp:"label"},ge),Ne=(0,X.useContext)(R.Z);return(0,ue.jsx)(se.Z,(0,G.Z)((0,G.Z)({valueEnum:(0,te.h)(Me),request:Ue,params:Se,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,G.Z)({getPopupContainer:Ne.getPopupContainer},Ge),ref:Ze,proFieldProps:ke},Ve),{},{children:Te}))}),k=B,le=h,o=k;o.SearchSelect=le,o.displayName="ProFormComponent",ee.Z=o},17092:function(We,ee,n){"use strict";n.r(ee),n.d(ee,{default:function(){return Rt}});var G=n(49111),L=n(19650),ue=n(62350),te=n(24565),X=n(34792),R=n(48086),se=n(57663),T=n(71577),y=n(39428),B=n(3182),h=n(2824),k=n(63863),le=n(51042),o=n(67294),f=n(11849),Ze=n(37476),ge=n(5966),Te=n(31199),Se=n(64317),ke=n(90672),t=n(85893),Me=function(b){var x=b.renderData,V=b.visible,Y=b.setVisible,M=b.callbackRef,g=(0,o.useRef)(),ne=(0,o.useState)([]),W=(0,h.Z)(ne,2),q=W[0],S=W[1];(0,o.useEffect)(function(){if(x.type=="eidt"){var I,C=(0,f.Z)({},x.record);(I=g.current)===null||I===void 0||I.setFieldsValue(C)}},[x]),(0,o.useEffect)(function(){$()},[]);var $=function(){var I=(0,B.Z)((0,y.Z)().mark(function C(){var E,J,D,j,ae;return(0,y.Z)().wrap(function(Q){for(;;)switch(Q.prev=Q.next){case 0:return Q.next=2,k.Z.get("/sms/share/getDepartment",{_isGetAll:!0});case 2:E=Q.sent,J=E.data[0].id,D=E.data.find(function(N){return N.parentId===J}),j=D?E.data.filter(function(N){return N.parentId===J&&N.parentId!=-1}):[],ae=j.map(function(N){return(0,f.Z)((0,f.Z)({},N),{},{label:N.name,value:N.id})}),S(ae);case 8:case"end":return Q.stop()}},C)}));return function(){return I.apply(this,arguments)}}();return(0,t.jsxs)(Ze.Y,{title:"\u6DFB\u52A0\u5C0F\u7EC4\u540D\u79F0",visible:V,formRef:g,width:500,modalProps:{onCancel:function(){var C;(C=g.current)===null||C===void 0||C.resetFields(),Y(!1)}},onFinish:function(){var I=(0,B.Z)((0,y.Z)().mark(function C(E){return(0,y.Z)().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:x.type=="eidt"?E.id=x.record.id:x.type=="add"&&delete E.id,k.Z.post("/sms/lead/ladUserGroup",E).then(function(j){j.status=="success"?(R.default.success("\u64CD\u4F5C\u6210\u529F"),Y(!1),M()):R.default.error(j.msg)});case 2:case"end":return D.stop()}},C)}));return function(C){return I.apply(this,arguments)}}(),children:[(0,t.jsx)(ge.Z,{label:"\u5C0F\u7EC4\u540D\u79F0",placeholder:"\u8BF7\u8F93\u5165\u5C0F\u7EC4\u540D\u79F0",name:"name",width:"md",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u5C0F\u7EC4\u540D\u79F0"}]}),(0,t.jsx)(Te.Z,{name:"sort",label:"\u4F18\u5148\u7EA7",width:"md",rules:[{required:!0}]}),(0,t.jsx)(Se.Z,{label:"\u4E8B\u4E1A\u90E8\u516C\u53F8",name:"departmentId",width:"md",options:q,rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u4E8B\u4E1A\u90E8\u516C\u53F8"}]}),(0,t.jsx)(ke.Z,{label:"\u63CF\u8FF0",name:"description",width:"md"})]})},Ue=n(952),Be=n(59962),Ve=n(18613),Ge=n(73218),Ne=function(b){var x=b.visible,V=b.setVisible,Y=(0,o.useState)([]),M=(0,h.Z)(Y,2),g=M[0],ne=M[1],W=(0,o.useRef)(),q=(0,o.useRef)(),S=function(){k.Z.post("/sms/lead/ladRule/getExpandField").then(function(I){console.log(I.data,"res------>");var C=I.data.map(function(E){return(0,f.Z)((0,f.Z)({},E),{},{operationType:E.operationType.split(",")})});console.log(C,"result------>"),ne(C)})};return(0,o.useEffect)(function(){S()},[]),(0,t.jsx)(Ze.Y,{width:800,formRef:q,onFinish:function(){var $=(0,B.Z)((0,y.Z)().mark(function I(C){var E;return(0,y.Z)().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:E=C.labels.map(function(j){return(0,f.Z)((0,f.Z)({},j),{},{name:j.field,operationType:j.operationType.join(",")})}),k.Z.postAll("/sms/lead/ladRule/expandField",E).then(function(j){j.status=="success"&&R.default.success("\u64CD\u4F5C\u6210\u529F!")}).catch(function(j){});case 2:case"end":return D.stop()}},I)}));return function(I){return $.apply(this,arguments)}}(),modalProps:{destroyOnClose:!0,onCancel:function(){V()},maskClosable:!1},visible:x,children:(0,t.jsx)(Be.u,{actionRef:W,name:"labels",label:"\u914D\u7F6E\u62D3\u5C55\u4FE1\u606F",actionGuard:{},initialValue:g,copyIconProps:{Icon:Ve.Z,tooltipText:"\u590D\u5236\u6B64\u884C\u5230\u672B\u5C3E"},deleteIconProps:{Icon:Ge.Z,tooltipText:"\u4E0D\u9700\u8981\u8FD9\u884C\u4E86"},children:(0,t.jsxs)(Ue.ZP.Group,{children:[(0,t.jsx)(ge.Z,{name:"field",label:"\u7EBF\u7D22\u4FE1\u606F",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u7EBF\u7D22\u4FE1\u606F"}]}),(0,t.jsx)(Se.Z,{label:"\u8FD0\u7B97\u7C7B\u578B",width:"md",name:"operationType",options:[{label:"\u7B49\u4E8E",value:"0"},{label:"\u4E0D\u7B49\u4E8E",value:"1"},{label:"\u5305\u542B",value:"2"},{label:"\u4E0D\u5305\u542B",value:"3"},{label:"\u4E3A\u7A7A",value:"4"},{label:"\u4E0D\u4E3A\u7A7A",value:"5"},{label:"\u6570\u5B57\u5927\u4E8E",value:"6"},{label:"\u6570\u5B57\u5C0F\u4E8E",value:"7"},{label:"\u6B63\u5219\u8868\u8FBE\u5F0F",value:"8"},{label:"\u65E5\u671F\u65F6\u95F4\u5927\u4E8E",value:"9"},{label:"\u65E5\u671F\u65F6\u95F4\u5C0F\u4E8E",value:"10"},{label:"\u65F6\u95F4\u5927\u4E8E",value:"11"},{label:"\u65F6\u95F4\u5C0F\u4E8E",value:"12"},{label:"\u5728\u5217\u8868",value:"13"},{label:"\u662F",value:"14"},{label:"\u5426",value:"15"}],fieldProps:{mode:"multiple"}})]},"group")})})},it=n(71906),Le=n(37490),ot=n(66801),Tt=n(71194),dt=n(50146),kt=n(32157),qe=n(5816),we=n(86582),Mt=n(47673),Ke=n(4107),ct=n(54618),vt=n(89366),_e=Ke.Z.Search,et=function(b){var x=b.UserChooseVisible,V=b.setUserChooseVisible,Y=b.callbackRef,M=b.CardContent,g=b.departments,ne=b.checkable,W=ne===void 0?!1:ne,q=b.setUserID,S=b.renderData,$=b.departNameList,I=$===void 0?!1:$,C=b.onConfirmSelected,E,J=[],D=[],j=[],ae=(0,o.useState)([]),H=(0,h.Z)(ae,2),Q=H[0],N=H[1],ie=(0,o.useState)(""),z=(0,h.Z)(ie,2),re=z[0],je=z[1],ve=(0,o.useState)(!0),fe=(0,h.Z)(ve,2),pe=fe[0],ce=fe[1],oe=(0,o.useState)(),Fe=(0,h.Z)(oe,2),He=Fe[0],ze=Fe[1],be=(0,o.useState)(!1),Ie=(0,h.Z)(be,2),Pe=Ie[0],Ye=Ie[1],De=(0,o.useState)([]),me=(0,h.Z)(De,2),de=me[0],U=me[1],Oe=(0,o.useState)([]),Re=(0,h.Z)(Oe,2),Ae=Re[0],O=Re[1],Z=(0,o.useState)([]),u=(0,h.Z)(Z,2),e=u[0],a=u[1],i=(0,o.useState)(!1),s=(0,h.Z)(i,2),r=s[0],l=s[1],P=function m(p){var v=[];return p.forEach(function(d,A){if(d.enable||Pe||d.departmentName){var F=[];d.children&&(F=m(d.children));var w="",ye,Ce;d.departmentName?(w=d.departmentName,ye=(0,t.jsx)(ct.Z,{}),Ce=!1):(w=d.name,ye=(0,t.jsx)(vt.Z,{}),Ce=!1),F.length>0?v.push({title:w,key:A,userId:d.userId,children:F,icon:ye,disabled:Ce,id:d.id}):v.push({title:w,key:A,userId:d.userId,icon:ye,disabled:Ce,id:d.id})}}),v},c=[];M.content.forEach(function(m){m.departmentName?m.departmentName.indexOf("\u79BB\u804C")==-1&&c.push(m):c.push(m)}),M&&(j=P(c));var he=function m(p,v){p.forEach(function(d,A){d.key=v+"-"+A,d.children&&m(d.children,d.key)})},rt=function m(p,v){p.forEach(function(d,A){["role","user","achievement","Groups","projectDepartment"].includes(M.type)?d.userId==v&&(D.push(d.key),J.push(d)):d.id==v&&D.push(d.key),d.children&&m(d.children,v)})};j.length>0&&(he(j,0),g&&g.forEach(function(m){rt(j,m.id)}),I&&I.split(",").forEach(function(m){rt(j,m)})),(0,o.useEffect)(function(){if(g&&Array.isArray(g)){var m=g.map(function(p){return Number(p==null?void 0:p.id)}).filter(function(p){return!Number.isNaN(p)});O(m),a(m)}else O([]),a([])},[x]);var At=function m(p,v){for(var d=[],A=0;A<v.length;A++){var F=v[A];F.children&&(F.children.some(function(w){return w.title.indexOf(p)!=-1})?d.push(F.key):m(p,F.children)&&d.push.apply(d,(0,we.Z)(m(p,F.children))))}return d},ut=function(p){N(p),ce(!1)},st=function(p){var v=p.target.value;N(At(v,j)),je(v),ce(!0)},lt=function m(p){return p.map(function(v){var d=v.title.indexOf(re),A=v.title.substring(0,d),F=v.title.slice(d+re.length),w=d>-1?(0,t.jsxs)("span",{children:[A,(0,t.jsx)("span",{className:"site-tree-search-value",children:re}),F]}):(0,t.jsx)("span",{children:v.title});return v.children?{title:w,key:v.key,disabled:v.disabled,icon:v.icon,children:m(v.children),userId:v.userId}:{title:w,key:v.key,icon:v.icon,userId:v.userId,titles:v.title,disabled:v.disabled}})};return(0,o.useEffect)(function(){if(!re){let p=function(v){v.forEach(function(d){d.children&&(m.push(d.key),p(d.children))})};var m=[];p(j),N(m)}},[re]),(0,t.jsx)(t.Fragment,{children:(M==null?void 0:M.type)=="performance"?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(_e,{style:{marginBottom:8},placeholder:"Search",onChange:function(p){return st(p)}}),(0,t.jsx)(qe.Z,{showIcon:!0,checkable:W,defaultExpandAll:!0,onExpand:function(p){return ut(p)},autoExpandParent:pe,defaultCheckedKeys:D,onCheck:function(p,v){var d=v.checkedNodes,A=[];d.forEach(function(F){F.userId&&A.push(F.userId)}),q(A)},onSelect:function(p,v){v.node.userId&&q(v.node.userId)},treeData:lt(j)})]}):(0,t.jsx)(dt.Z,{title:"\u9009\u62E9\u4EBA\u5458",open:x,destroyOnClose:!0,onCancel:function(){D=[],V(!1)},confirmLoading:r,onOk:(0,B.Z)((0,y.Z)().mark(function m(){var p,v,d,A,F,w,ye,Ce;return(0,y.Z)().wrap(function(K){for(;;)switch(K.prev=K.next){case 0:if(typeof C!="function"){K.next=4;break}return C(e),V(!1),K.abrupt("return");case 4:if(p=new Set(Ae),v=new Set(e),d=[],A=[],e.forEach(function(_){p.has(_)||d.push(_)}),Ae.forEach(function(_){v.has(_)||A.push(_)}),!(d.length===0&&A.length===0)){K.next=13;break}return V(!1),K.abrupt("return");case 13:return l(!0),K.prev=14,w=S==null||(F=S.record)===null||F===void 0?void 0:F.id,ye=d.map(function(_){return(S==null?void 0:S.type)==="sale"?k.Z.post("/sms/lead/ladUserGroupUser",{userGroupId:w,userId:_}):(S==null?void 0:S.type)==="newMedia"?k.Z.post("/sms/lead/ladUserGroupProvider",{userGroupId:w,provider:_}):Promise.resolve(null)}),Ce=A.map(function(_){return(S==null?void 0:S.type)==="sale"?k.Z.delete("/sms/lead/ladUserGroupUser/deleteByParam",{userGroupId:w,userId:_}):(S==null?void 0:S.type)==="newMedia"?k.Z.delete("/sms/lead/ladUserGroupProvider/deleteByParam",{userGroupId:w,provider:_}):Promise.resolve(null)}),K.next=20,Promise.allSettled([].concat((0,we.Z)(ye),(0,we.Z)(Ce)));case 20:R.default.success("\u64CD\u4F5C\u6210\u529F\uFF01"),V(!1),Y(),K.next=28;break;case 25:K.prev=25,K.t0=K.catch(14),R.default.error("\u64CD\u4F5C\u5931\u8D25\uFF01");case 28:return K.prev=28,l(!1),K.finish(28);case 31:case"end":return K.stop()}},m,null,[[14,25,28,31]])})),children:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(_e,{style:{marginBottom:8},placeholder:"Search",onChange:function(p){return st(p)}}),(0,t.jsx)(qe.Z,{showIcon:!0,checkable:(M==null?void 0:M.type)!="pay",defaultExpandAll:!0,onExpand:function(p){return ut(p)},expandedKeys:Q,autoExpandParent:pe,defaultCheckedKeys:D,onCheck:function(p,v){var d=v.checkedNodes||[],A=d.map(function(F){return Number(F==null?void 0:F.userId)}).filter(function(F){return!!F&&!Number.isNaN(F)});a(A),J=v.checkedNodes},treeData:lt(j)})]})})})},Ut=n(57338),ft=n(273),Bt=n(20228),pt=n(11382),Vt=n(58024),mt=n(91894),Gt=n(13062),ht=n(71230),Nt=n(89032),$e=n(15746),Lt=n(14965),Qe=n(88137),wt=n(77883),yt=n(49747),Ct=n(32059),Kt=n(43358),xe=n(34041),Zt=n(31223),Je=n(28991),gt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H544V328c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v152H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h152v152c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V544h152c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"plus-circle",theme:"outlined"},St=gt,tt=n(27029),xt=function(x,V){return o.createElement(tt.Z,(0,Je.Z)((0,Je.Z)({},x),{},{ref:V,icon:St}))},Et=o.forwardRef(xt),nt=Et,jt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h368c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"minus-circle",theme:"outlined"},Ft=jt,bt=function(x,V){return o.createElement(tt.Z,(0,Je.Z)((0,Je.Z)({},x),{},{ref:V,icon:Ft}))},It=o.forwardRef(bt),at=It,Pt=n(30381),Xe=n.n(Pt),Ee=xe.Z.Option,Dt=function(x){var V=x.visible,Y=x.onClose,M=x.onConfirm,g=x.userGroupId,ne=(0,o.useState)(!1),W=(0,h.Z)(ne,2),q=W[0],S=W[1],$=(0,o.useState)([]),I=(0,h.Z)($,2),C=I[0],E=I[1],J=(0,o.useState)([]),D=(0,h.Z)(J,2),j=D[0],ae=D[1],H=[{value:0,name:"\u7B49\u4E8E",valueType:"string"},{value:1,name:"\u4E0D\u7B49\u4E8E",valueType:"string"},{value:2,name:"\u5305\u542B",valueType:"string"},{value:3,name:"\u4E0D\u5305\u542B",valueType:"string"},{value:4,name:"\u4E3A\u7A7A",valueType:"empty"},{value:5,name:"\u4E0D\u4E3A\u7A7A",valueType:"empty"},{value:6,name:"\u6570\u5B57\u5927\u4E8E",valueType:"number"},{value:7,name:"\u6570\u5B57\u5C0F\u4E8E",valueType:"number"},{value:8,name:"\u6B63\u5219\u8868\u8FBE\u5F0F",valueType:"string"},{value:9,name:"\u65E5\u671F\u65F6\u95F4\u5927\u4E8E",valueType:"datetime"},{value:10,name:"\u65E5\u671F\u65F6\u95F4\u5C0F\u4E8E",valueType:"datetime"},{value:11,name:"\u65F6\u95F4\u5927\u4E8E",valueType:"time"},{value:12,name:"\u65F6\u95F4\u5C0F\u4E8E",valueType:"time"},{value:13,name:"\u5728\u5217\u8868",valueType:"string"},{value:14,name:"\u662F",valueType:"boolean"},{value:15,name:"\u5426",valueType:"boolean"}],Q=(0,o.useState)([]),N=(0,h.Z)(Q,2),ie=N[0],z=N[1],re=(0,o.useState)(!1),je=(0,h.Z)(re,2),ve=je[0],fe=je[1],pe=(0,o.useState)(null),ce=(0,h.Z)(pe,2),oe=ce[0],Fe=ce[1],He=function(){var u=(0,B.Z)((0,y.Z)().mark(function e(){var a,i,s,r,l;return(0,y.Z)().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.prev=0,c.next=3,k.Z.getRuleFields();case 3:a=c.sent,a.status==="success"&&a.data?(i=Array.isArray(a.data)?a.data:[a.data],ae(i),s=i.map(function(he){return{key:he.field||"",name:he.name||"",type:he.type||"string"}}),E(s)):(r=[{key:"owner",name:"\u4FE1\u606F\u6240\u6709\u4EBA",type:"string"},{key:"department",name:"\u90E8\u95E8",type:"string"},{key:"position",name:"\u804C\u4F4D",type:"string"},{key:"age",name:"\u5E74\u9F84",type:"number"},{key:"salary",name:"\u85AA\u8D44",type:"number"},{key:"birthday",name:"\u751F\u65E5",type:"date"},{key:"workTime",name:"\u5DE5\u4F5C\u65F6\u95F4",type:"time"},{key:"isActive",name:"\u662F\u5426\u6FC0\u6D3B",type:"boolean"}],E(r)),c.next=12;break;case 7:c.prev=7,c.t0=c.catch(0),R.default.error("\u52A0\u8F7D\u5B57\u6BB5\u5217\u8868\u5931\u8D25"),l=[{key:"owner",name:"\u4FE1\u606F\u6240\u6709\u4EBA",type:"string"},{key:"department",name:"\u90E8\u95E8",type:"string"},{key:"position",name:"\u804C\u4F4D",type:"string"},{key:"age",name:"\u5E74\u9F84",type:"number"},{key:"salary",name:"\u85AA\u8D44",type:"number"},{key:"birthday",name:"\u751F\u65E5",type:"date"},{key:"workTime",name:"\u5DE5\u4F5C\u65F6\u95F4",type:"time"},{key:"isActive",name:"\u662F\u5426\u6FC0\u6D3B",type:"boolean"}],E(l);case 12:case"end":return c.stop()}},e,null,[[0,7]])}));return function(){return u.apply(this,arguments)}}(),ze=(0,o.useCallback)((0,B.Z)((0,y.Z)().mark(function u(){var e,a,i;return(0,y.Z)().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(g){r.next=2;break}return r.abrupt("return");case 2:return S(!0),r.prev=3,r.next=6,k.Z.getRuleConfig(g);case 6:e=r.sent,e.status==="success"&&e.data?(a=Array.isArray(e.data)?e.data:[e.data],i=a.map(function(l,P){return{id:l.id||0,name:"\u89C4\u5219\u7EC4".concat(l.id||1),relation:l.operator===0?"and":"or",rules:(l.ruleList||[]).map(function(c,he){return(0,f.Z)((0,f.Z)({},c),{},{uid:"".concat(P,"-").concat(he,"-").concat(Date.now(),"-").concat(Math.random().toString(36).slice(2,8))})}),userGroupId:l.userGroupId||g,operator:l.operator||0}}),z(i)):z([{id:0,name:"\u89C4\u5219\u7EC41",relation:"and",rules:[],userGroupId:g,operator:0}]),r.next=14;break;case 10:r.prev=10,r.t0=r.catch(3),R.default.error("\u52A0\u8F7D\u89C4\u5219\u914D\u7F6E\u5931\u8D25"),z([{id:0,name:"\u89C4\u5219\u7EC41",relation:"and",rules:[],userGroupId:g,operator:0}]);case 14:return r.prev=14,S(!1),r.finish(14);case 17:case"end":return r.stop()}},u,null,[[3,10,14,17]])})),[g]);(0,o.useEffect)(function(){V&&(He(),ze())},[V,g,ze]);var be=function(e){var a=C.find(function(i){return i.key===e});return(a==null?void 0:a.type)||"string"},Ie=function(e){var a={consultationTime:[4,5,9,10,11,12],project:[4,5,13],studentSource:[4,5,13],provider:[4,5,13],isLive:[4,5,14,15],owner:[4,5,13],intentionLevel:[4,5,13]},i=a[e];if(i)return H.filter(function(r){return i.includes(r.value)});var s=be(e);switch(s){case"string":return H.filter(function(r){return[0,1,2,3,4,5,8,13].includes(r.value)});case"number":return H.filter(function(r){return[0,1,4,5,6,7].includes(r.value)});case"date":case"datetime":return H.filter(function(r){return[0,1,4,5,9,10].includes(r.value)});case"time":return H.filter(function(r){return[0,1,4,5,11,12].includes(r.value)});case"boolean":return H.filter(function(r){return[0,1,4,5,14,15].includes(r.value)});default:return H}},Pe=function(e){if(e==null)return"empty";var a=H.find(function(i){return i.value===e});return(a==null?void 0:a.valueType)||"string"},Ye=function(e){z(function(a){return a.map(function(i){if(i.id===e){var s={id:0,field:C.length>0?C[0].key:"",type:void 0,value:"",ruleGroupId:e,uid:"".concat(e,"-").concat(Date.now(),"-").concat(Math.random().toString(36).slice(2,8))};return(0,f.Z)((0,f.Z)({},i),{},{rules:[].concat((0,we.Z)(i.rules),[s])})}return i})})},De=function(e,a){z(function(i){return i.map(function(s){return s.id===e?(0,f.Z)((0,f.Z)({},s),{},{rules:s.rules.filter(function(r){return r.uid!==a})}):s})})},me=function(){var e={id:0,name:"\u89C4\u5219\u7EC4".concat(ie.length+1),relation:"and",rules:[{id:0,field:C.length>0?C[0].key:"",type:void 0,value:"",ruleGroupId:0}],userGroupId:g,operator:0};z(function(a){return[].concat((0,we.Z)(a),[e])})},de=function(e){z(function(a){return a.filter(function(i){return i.id!==e})})},U=function(e,a,i,s){z(function(r){return r.map(function(l){return l.id===e?(0,f.Z)((0,f.Z)({},l),{},{rules:l.rules.map(function(P){if(P.uid===a){var c=(0,f.Z)((0,f.Z)({},P),{},(0,Ct.Z)({},i,s));return i==="field"&&(c.type=void 0,c.value=""),i==="type"&&(c.value=""),c}return P})}):l})})},Oe=function(){var u=(0,B.Z)((0,y.Z)().mark(function e(){var a,i;return(0,y.Z)().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(g){r.next=3;break}return R.default.error("\u7528\u6237\u7EC4ID\u4E0D\u80FD\u4E3A\u7A7A"),r.abrupt("return");case 3:return S(!0),r.prev=4,a=ie.map(function(l){return{userGroupId:g,operator:l.relation==="and"?0:1,ruleList:l.rules.map(function(P){return{userGroupId:g,field:P.field,type:P.type,value:P.value}})}}),r.next=8,k.Z.setRuleConfig(g,a);case 8:i=r.sent,i.status==="success"?(R.default.success("\u89C4\u5219\u914D\u7F6E\u4FDD\u5B58\u6210\u529F"),M==null||M(ie),Y()):R.default.error(i.msg||"\u4FDD\u5B58\u5931\u8D25"),r.next=15;break;case 12:r.prev=12,r.t0=r.catch(4),R.default.error("\u4FDD\u5B58\u89C4\u5219\u914D\u7F6E\u5931\u8D25");case 15:return r.prev=15,S(!1),r.finish(15);case 18:case"end":return r.stop()}},e,null,[[4,12,15,18]])}));return function(){return u.apply(this,arguments)}}(),Re=function(){var e=Le.Z.getCascader("dict_reg_job")||[],a=[],i=function s(r){r.forEach(function(l){l.children&&l.children.length?s(l.children):a.push({label:l.label,value:l.value})})};return i(e),a},Ae=function(){var e=JSON.parse(localStorage.getItem("Department"))||[],a=[],i=function s(r){r.forEach(function(l){l.userId&&l.enable!==!1&&a.push({label:l.name,value:l.userId}),l.children&&l.children.length&&s(l.children)})};return i(e),a},O=function(e){return e==="project"?Re():e==="studentSource"?Le.Z.getList("dict_source")||[]:e==="intentionLevel"?Le.Z.getList("dict_intention_level")||[]:e==="provider"||e==="owner"?Ae():[]},Z=function(e){var a=Pe(e.type),i=e.field;switch(a){case"empty":return(0,t.jsx)(Ke.Z,{disabled:!0,placeholder:"\u65E0\u9700\u8F93\u5165\u503C"});case"number":return(0,t.jsx)(yt.Z,{value:e.value?Number(e.value):void 0,onChange:function(c){return U(e.ruleGroupId||0,e.id,"value",(c==null?void 0:c.toString())||"")},placeholder:"\u8BF7\u8F93\u5165\u6570\u5B57",style:{width:"100%"}});case"date":return(0,t.jsx)(Qe.Z,{showTime:!0,value:e.value?Xe()(e.value,"YYYY-MM-DD HH:mm:ss"):null,onChange:function(c){return U(e.ruleGroupId||0,e.id,"value",(c==null?void 0:c.format("YYYY-MM-DD HH:mm:ss"))||"")},placeholder:"\u8BF7\u9009\u62E9\u65E5\u671F\u65F6\u95F4",style:{width:"100%"}});case"datetime":return(0,t.jsx)(Qe.Z,{showTime:!0,value:e.value?Xe()(e.value,"YYYY-MM-DD HH:mm:ss"):null,onChange:function(c){return U(e.ruleGroupId||0,e.id,"value",(c==null?void 0:c.format("YYYY-MM-DD HH:mm:ss"))||"")},placeholder:"\u8BF7\u9009\u62E9\u65E5\u671F\u65F6\u95F4",style:{width:"100%"}});case"time":return(0,t.jsx)(Qe.Z,{picker:"time",value:e.value?Xe()(e.value,"HH:mm:ss"):null,onChange:function(c){return U(e.ruleGroupId||0,e.id,"value",(c==null?void 0:c.format("HH:mm:ss"))||"")},placeholder:"\u8BF7\u9009\u62E9\u65F6\u95F4",style:{width:"100%"}});case"boolean":return(0,t.jsxs)(xe.Z,{value:e.value,onChange:function(c){return U(e.ruleGroupId||0,e.id,"value",c)},placeholder:"\u8BF7\u9009\u62E9",style:{width:"100%"},children:[(0,t.jsx)(Ee,{value:"14",children:"\u662F"}),(0,t.jsx)(Ee,{value:"15",children:"\u5426"})]});case"string":if(e.type===13){var s=O(i),r=e.value?String(e.value).split(","):[];if(i==="provider"||i==="owner"){var l=r.map(function(P){return Le.Z.getDepartmentUserName(Number(P))}).filter(Boolean).join(", ");return(0,t.jsxs)("div",{className:"rule-user-picker",children:[(0,t.jsx)(Ke.Z,{readOnly:!0,value:l,placeholder:"\u8BF7\u9009\u62E9\u4EBA\u5458",style:{width:220}}),(0,t.jsx)(T.Z,{type:"primary",size:"small",shape:"round",icon:(0,t.jsx)(Zt.Z,{}),onClick:function(){Fe({groupId:e.ruleGroupId||0,ruleUid:e.uid,fieldKey:i}),fe(!0)},children:"\u9009\u62E9\u4EBA\u5458"})]})}return(0,t.jsx)(xe.Z,{mode:"multiple",allowClear:!0,value:r,onChange:function(c){return U(e.ruleGroupId||0,e.id,"value",c.join(","))},options:s,placeholder:"\u8BF7\u9009\u62E9",style:{width:"100%"}})}return(0,t.jsx)(Ke.Z,{value:e.value,onChange:function(c){return U(e.ruleGroupId||0,e.uid,"value",c.target.value)},placeholder:"\u8BF7\u8F93\u5165\u503C"});default:return(0,t.jsx)(Ke.Z,{value:e.value,onChange:function(c){return U(e.ruleGroupId||0,e.uid,"value",c.target.value)},placeholder:"\u8BF7\u8F93\u5165\u503C"})}};return(0,t.jsxs)(ft.Z,{title:"\u914D\u7F6E\u89C4\u5219\u7EC4",placement:"right",width:1e3,open:V,onClose:Y,extra:(0,t.jsxs)(L.Z,{children:[(0,t.jsx)(T.Z,{size:"middle",onClick:Y,children:"\u53D6\u6D88"}),(0,t.jsx)(T.Z,{size:"middle",type:"primary",loading:q,onClick:Oe,children:"\u786E\u8BA4"})]}),children:[(0,t.jsx)(pt.Z,{spinning:q,children:(0,t.jsxs)("div",{style:{padding:"20px 0"},children:[ie.map(function(u,e){return(0,t.jsx)(mt.Z,{title:(0,t.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12},children:[(0,t.jsx)("span",{children:"\u89C4\u5219\u7EC4".concat(e+1)}),(0,t.jsxs)(xe.Z,{value:u.relation,style:{width:80},onChange:function(i){z(function(s){return s.map(function(r){return r.id===u.id?(0,f.Z)((0,f.Z)({},r),{},{relation:i}):r})})},children:[(0,t.jsx)(Ee,{value:"and",children:"\u4E14"}),(0,t.jsx)(Ee,{value:"or",children:"\u6216"})]})]}),style:{marginBottom:"20px"},extra:(0,t.jsxs)(L.Z,{children:[(0,t.jsx)(T.Z,{type:"text",icon:(0,t.jsx)(nt,{}),onClick:function(){return Ye(u.id)}}),(0,t.jsx)(T.Z,{type:"text",danger:!0,icon:(0,t.jsx)(at,{}),onClick:function(){return de(u.id)}})]}),children:u.rules.map(function(a,i){return(0,t.jsxs)(ht.Z,{gutter:8,style:{marginBottom:"12px",alignItems:"center"},children:[(0,t.jsx)($e.Z,{span:5,children:(0,t.jsx)(xe.Z,{value:a.field,style:{width:"100%"},onChange:function(r){return U(u.id,a.uid,"field",r)},children:C.map(function(s){return(0,t.jsx)(Ee,{value:s.key,children:s.name},s.key)})})}),(0,t.jsx)($e.Z,{span:4,children:(0,t.jsx)(xe.Z,{value:a.type,style:{width:"100%"},onChange:function(r){return U(u.id,a.uid,"type",r)},placeholder:"\u8BF7\u9009\u62E9\u8FD0\u7B97\u7C7B\u578B",children:Ie(a.field).map(function(s){return(0,t.jsx)(Ee,{value:s.value,children:s.name},s.value)})})}),(0,t.jsx)($e.Z,{span:8,children:Z(a)}),(0,t.jsx)($e.Z,{span:3,children:(0,t.jsxs)(L.Z,{children:[(0,t.jsx)(T.Z,{type:"text",icon:(0,t.jsx)(nt,{}),onClick:function(){return Ye(u.id)}}),(0,t.jsx)(T.Z,{type:"text",danger:!0,icon:(0,t.jsx)(at,{}),onClick:function(){return De(u.id,a.uid)}})]})})]},a.uid)})},u.id)}),(0,t.jsx)("div",{style:{textAlign:"center",marginTop:"20px"},children:(0,t.jsx)(T.Z,{type:"dashed",icon:(0,t.jsx)(le.Z,{}),onClick:me,style:{width:"200px"},children:"\u6DFB\u52A0\u89C4\u5219\u7EC4"})})]})}),ve&&(0,t.jsx)(et,{UserChooseVisible:ve,setUserChooseVisible:fe,CardContent:{content:JSON.parse(localStorage.getItem("Department"))||[],type:"role"},departments:[],renderData:{},onConfirmSelected:function(e){!oe||U(oe.groupId,oe.ruleUid,"value",e.join(","))}})]})},Ot=Dt,Rt=function(){var b=(0,o.useRef)(),x=function(){var Z;return(Z=b.current)===null||Z===void 0?void 0:Z.reload()},V=(0,o.useState)(!1),Y=(0,h.Z)(V,2),M=Y[0],g=Y[1],ne=(0,o.useState)(!1),W=(0,h.Z)(ne,2),q=W[0],S=W[1],$=(0,o.useState)({}),I=(0,h.Z)($,2),C=I[0],E=I[1],J=(0,o.useState)(),D=(0,h.Z)(J,2),j=D[0],ae=D[1],H=(0,o.useState)("-1"),Q=(0,h.Z)(H,2),N=Q[0],ie=Q[1],z=(0,o.useState)(),re=(0,h.Z)(z,2),je=re[0],ve=re[1],fe=(0,o.useState)(!1),pe=(0,h.Z)(fe,2),ce=pe[0],oe=pe[1],Fe=(0,o.useState)(!1),He=(0,h.Z)(Fe,2),ze=He[0],be=He[1],Ie=(0,o.useState)(),Pe=(0,h.Z)(Ie,2),Ye=Pe[0],De=Pe[1],me="/sms/lead/ladUserGroup",de=null,U=null,Oe=function(Z){if(!Z)return[];if(Array.isArray(Z))return Z.map(function(e){return Number(e)}).filter(function(e){return!Number.isNaN(e)}).map(function(e){return{id:e}});if(typeof Z=="string"){var u=Z.trim();return u?u.split(",").map(function(e){return Number(e)}).filter(function(e){return!Number.isNaN(e)}).map(function(e){return{id:e}}):[]}return typeof Z=="number"?Number.isNaN(Z)?[]:[{id:Z}]:[]},Re=[{title:"\u5C0F\u7EC4\u540D\u79F0",dataIndex:"name"},{title:"\u4F18\u5148\u7EA7",dataIndex:"sort"},{title:"\u5F53\u524D\u6240\u5728\u90E8\u95E8",sorter:!0,dataIndex:"departmentName",search:!1,render:function(Z,u){return(0,t.jsx)("span",{children:Le.Z.getDepartmentName(u.departmentId).join("-")})}},{title:"\u7ED1\u5B9A\u9500\u552E\u4EBA\u5458",dataIndex:"userNameList",colSpan:2,ellipsis:!0,search:!1,tip:"\u8FC7\u957F\u4F1A\u81EA\u52A8\u6536\u7F29"},{width:80,search:!1,colSpan:0,render:function(Z,u,e,a){return(0,t.jsx)(T.Z,{size:"small",type:"primary",icon:(0,t.jsx)(le.Z,{}),onClick:(0,B.Z)((0,y.Z)().mark(function i(){var s;return(0,y.Z)().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(de){l.next=4;break}return l.next=3,k.Z.get("/sms/share/getDepartmentAndUser");case 3:de=l.sent;case 4:ae({content:de.data,type:"role"}),s=Oe(u==null?void 0:u.userList),ve(s),ie(u.id),oe(!0),E({record:u,type:"sale"});case 10:case"end":return l.stop()}},i)})),children:"\u7ED1\u5B9A"})}},{title:"\u7ED1\u5B9A\u65B0\u5A92\u4F53\u4EBA\u5458",dataIndex:"providerNameList",colSpan:2,ellipsis:!0,search:!1,tip:"\u8FC7\u957F\u4F1A\u81EA\u52A8\u6536\u7F29"},{width:80,search:!1,colSpan:0,render:function(Z,u,e,a){return(0,t.jsx)(T.Z,{size:"small",type:"primary",icon:(0,t.jsx)(le.Z,{}),onClick:(0,B.Z)((0,y.Z)().mark(function i(){var s;return(0,y.Z)().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(de){l.next=4;break}return l.next=3,k.Z.get("/sms/share/getDepartmentAndUser");case 3:de=l.sent;case 4:ae({content:de.data,type:"role"}),s=Oe(u==null?void 0:u.providerList),ve(s),ie(u.id),oe(!0),E({record:u,type:"newMedia"});case 10:case"end":return l.stop()}},i)})),children:"\u7ED1\u5B9A"})}},{title:"\u63CF\u8FF0",dataIndex:"description"},{title:"\u521B\u5EFA\u65F6\u95F4",dataIndex:"createTime",valueType:"dateRange",sorter:!0,render:function(Z,u){return(0,t.jsx)("span",{children:u.createTime},"createTime-".concat(u.id))}},{title:"\u64CD\u4F5C",search:!1,render:function(Z,u){return[(0,t.jsxs)(L.Z,{children:[(0,t.jsx)("a",{onClick:function(){E({record:u,type:"eidt"}),g(!0)},children:"\u7F16\u8F91"}),(0,t.jsx)(te.Z,{title:"\u662F\u5426\u786E\u5B9A\u5220\u9664\uFF1F",onConfirm:function(){k.Z.delete(me,{id:u.id}).then(function(a){a.status=="success"&&(R.default.success("\u5220\u9664\u6210\u529F"),x())})},okText:"\u5220\u9664",cancelText:"\u53D6\u6D88",children:(0,t.jsx)("a",{style:{color:"red"},children:"\u5220\u9664"})},u.id),(0,t.jsx)(T.Z,{type:"link",onClick:function(){De(u.id),be(!0)},children:"\u914D\u7F6E\u89C4\u5219"})]},u.id)]}}],Ae=function(){var O=(0,B.Z)((0,y.Z)().mark(function Z(){var u;return(0,y.Z)().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,k.Z.get("/sms/share/getDepartmentAndUser");case 2:u=a.sent,ae(u.data);case 4:case"end":return a.stop()}},Z)}));return function(){return O.apply(this,arguments)}}();return(0,o.useEffect)(function(){Ae()},[]),(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)(it.ZP,{children:[(0,t.jsx)(ot.ZP,{columns:Re,actionRef:b,cardBordered:!0,scroll:{x:1500},request:(0,B.Z)((0,y.Z)().mark(function O(){var Z,u,e,a=arguments;return(0,y.Z)().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return Z=a.length>0&&a[0]!==void 0?a[0]:{},u=a.length>1?a[1]:void 0,e=a.length>2?a[2]:void 0,s.next=5,k.Z.get(me,Z);case 5:return U=s.sent,s.abrupt("return",{data:U.data.content,success:U.success,total:U.data.totalElements});case 7:case"end":return s.stop()}},O)})),rowKey:"id",search:{labelWidth:"auto",collapsed:!1},onSubmit:function(){U=null},onReset:function(){U=null},options:{reload:function(){U=null,x()}},toolBarRender:function(){return[(0,t.jsx)(T.Z,{icon:(0,t.jsx)(le.Z,{}),type:"primary",onClick:function(){E({type:"add"}),S(!0)},children:"\u6DFB\u52A0\u62D3\u5C55\u4FE1\u606F"},"button-bind-sales"),(0,t.jsx)(T.Z,{icon:(0,t.jsx)(le.Z,{}),type:"primary",onClick:function(){E({type:"add"}),g(!0)},children:"\u6DFB\u52A0\u8D44\u6E90\u5C0F\u7EC4"},"button-bind-media")]},dateFormatter:"string"}),(0,t.jsx)(Me,{renderData:C,visible:M,setVisible:g,callbackRef:x}),(0,t.jsx)(Ne,{visible:q,setVisible:S,callbackRef:x}),ce&&(0,t.jsx)(et,{UserChooseVisible:ce,CardContent:j,renderData:C,departments:je,callbackRef:function(){return x()},setUserChooseVisible:function(){return oe(!1)}}),(0,t.jsx)(Ot,{visible:ze,onClose:function(){be(!1),De(void 0)},userGroupId:Ye})]})})}}}]);
