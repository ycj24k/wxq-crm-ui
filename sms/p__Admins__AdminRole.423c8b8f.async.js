(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[4062],{54618:function(Fe,ue,e){"use strict";e.d(ue,{Z:function(){return S}});var ie=e(28991),ae=e(67294),ge={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M908 640H804V488c0-4.4-3.6-8-8-8H548v-96h108c8.8 0 16-7.2 16-16V80c0-8.8-7.2-16-16-16H368c-8.8 0-16 7.2-16 16v288c0 8.8 7.2 16 16 16h108v96H228c-4.4 0-8 3.6-8 8v152H116c-8.8 0-16 7.2-16 16v288c0 8.8 7.2 16 16 16h288c8.8 0 16-7.2 16-16V656c0-8.8-7.2-16-16-16H292v-88h440v88H620c-8.8 0-16 7.2-16 16v288c0 8.8 7.2 16 16 16h288c8.8 0 16-7.2 16-16V656c0-8.8-7.2-16-16-16zm-564 76v168H176V716h168zm84-408V140h168v168H428zm420 576H680V716h168v168z"}}]},name:"apartment",theme:"outlined"},f=ge,se=e(27029),oe=function(o,l){return ae.createElement(se.Z,(0,ie.Z)((0,ie.Z)({},o),{},{ref:l,icon:f}))},Y=ae.forwardRef(oe),S=Y},32779:function(Fe,ue,e){"use strict";e.d(ue,{Z:function(){return S}});var ie=e(28991),ae=e(67294),ge={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M758.2 839.1C851.8 765.9 912 651.9 912 523.9 912 303 733.5 124.3 512.6 124 291.4 123.7 112 302.8 112 523.9c0 125.2 57.5 236.9 147.6 310.2 3.5 2.8 8.6 2.2 11.4-1.3l39.4-50.5c2.7-3.4 2.1-8.3-1.2-11.1-8.1-6.6-15.9-13.7-23.4-21.2a318.64 318.64 0 01-68.6-101.7C200.4 609 192 567.1 192 523.9s8.4-85.1 25.1-124.5c16.1-38.1 39.2-72.3 68.6-101.7 29.4-29.4 63.6-52.5 101.7-68.6C426.9 212.4 468.8 204 512 204s85.1 8.4 124.5 25.1c38.1 16.1 72.3 39.2 101.7 68.6 29.4 29.4 52.5 63.6 68.6 101.7 16.7 39.4 25.1 81.3 25.1 124.5s-8.4 85.1-25.1 124.5a318.64 318.64 0 01-68.6 101.7c-9.3 9.3-19.1 18-29.3 26L668.2 724a8 8 0 00-14.1 3l-39.6 162.2c-1.2 5 2.6 9.9 7.7 9.9l167 .8c6.7 0 10.5-7.7 6.3-12.9l-37.3-47.9z"}}]},name:"redo",theme:"outlined"},f=ge,se=e(27029),oe=function(o,l){return ae.createElement(se.Z,(0,ie.Z)((0,ie.Z)({},o),{},{ref:l,icon:f}))},Y=ae.forwardRef(oe),S=Y},19835:function(Fe,ue,e){"use strict";e.r(ue),e.d(ue,{default:function(){return ce}});var ie=e(62350),ae=e(24565),ge=e(34792),f=e(48086),se=e(11849),oe=e(57663),Y=e(71577),S=e(39428),_=e(3182),o=e(2824),l=e(67294),ve=e(51042),Ue=e(8212),Ne=e(82061),q=e(32779),re=e(66801),E=e(71906),Ie=e(37476),F=e(5966),We=e(90672),v=e(63863),r=e(85893),m=function(i){var A=(0,l.useRef)(),X=i.modalVisible,k=i.setModalVisible,G=i.callbackRef,y=i.renderData,w=i.url;setTimeout(function(){var T;if(A==null||(T=A.current)===null||T===void 0||T.resetFields(),y.type=="eidt"){var x;A==null||(x=A.current)===null||x===void 0||x.setFieldsValue(y)}},100);var Q={labelCol:{span:4},wrapperCol:{span:14}},N=function(x){return y.type=="eidt"&&(x.id=y.id),new Promise(function(W,z){v.Z.post(w,x).then(function(B){B.status=="success"&&(W(!0),f.default.success("\u63D0\u4EA4\u6210\u529F"),k(),G())}).catch(function(B){W(!0)})})};return(0,r.jsxs)(Ie.Y,(0,se.Z)((0,se.Z)({title:y.type=="add"?"\u65B0\u5EFA":"\u4FEE\u6539",autoFocusFirstInput:!0},Q),{},{layout:"LAYOUT_TYPE_HORIZONTAL",modalProps:{onCancel:function(){return k()}},formRef:A,onFinish:function(){var T=(0,_.Z)((0,S.Z)().mark(function x(W){return(0,S.Z)().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return B.next=2,N(W);case 2:case"end":return B.stop()}},x)}));return function(x){return T.apply(this,arguments)}}(),visible:X,children:[(0,r.jsx)(F.Z,{width:"xl",name:"name",label:"\u540D\u79F0"}),(0,r.jsx)(F.Z,{width:"xl",name:"code",label:"\u6743\u9650\u4EE3\u7801"}),(0,r.jsx)(We.Z,{width:"md",name:"description",label:"\u63CF\u8FF0"})]}))},me=e(14037),ye=e(71194),Se=e(50146),Xe=e(32157),le=e(5816),pe=e(86582),be=e(91220),we=e(47673),Oe=e(4107),Te=Oe.Z.Search,ze=function(i){var A=i.MenuVisible,X=i.setMenuVisible,k=i.MenuContent,G=i.callbackRef,y=i.menuRenderData;console.log(y,"this.MenuContent");var w=(0,l.useState)([]),Q=(0,o.Z)(w,2),N=Q[0],T=Q[1],x=(0,l.useState)([]),W=(0,o.Z)(x,2),z=W[0],B=W[1],V=(0,l.useState)([]),c=(0,o.Z)(V,2),p=c[0],C=c[1],s=(0,l.useState)([]),a=(0,o.Z)(s,2),n=a[0],t=a[1],Z=(0,l.useState)(""),R=(0,o.Z)(Z,2),K=R[0],ne=R[1],u=function I(D){return!D||!Array.isArray(D)?[]:D.map(function(b){return{key:b.id,title:b.name,children:b.children?I(b.children):[]}})},He=function I(D,b){return b?D.map(function(L){var H=(0,se.Z)({},L),j=L.title.toLowerCase().includes(b.toLowerCase());return L.children&&L.children.length>0?(H.children=I(L.children,b),H.children.length>0||j?H:null):j?H:null}).filter(Boolean):D};(0,l.useEffect)(function(){if(k&&k.data){var I=u(k.data);T(I),B(I)}},[k.data]),(0,l.useEffect)(function(){B(He(N,K))},[K,N]),(0,l.useEffect)(function(){if(y&&y.menuList&&y.menuList.length>0){var I=y.menuList.map(function(D){return D.id});C(I),t(I)}else C([]),t([])},[y]);var $e=function(D){var b=[],L=function H(j){!j||(j.key&&b.push(j.key),j.children&&j.children.length>0&&j.children.forEach(function($){return H($)}))};return L(D),b},Ve=function I(D,b){var L=(0,be.Z)(b),H;try{for(L.s();!(H=L.n()).done;){var j=H.value;if(j.key===D)return j;if(j.children&&j.children.length>0){var $=I(D,j.children);if($)return $}}}catch(Ce){L.e(Ce)}finally{L.f()}return null},Le=function(D,b){var L=b.node,H=b.checked,j=L.key,$=(0,pe.Z)(p);if(H){var Ce=Ve(j,N);if(Ce){var Ye=$e(Ce);$=(0,pe.Z)(new Set([].concat((0,pe.Z)($),(0,pe.Z)(Ye))))}}else{var ke=Ve(j,N);if(ke){var Be=$e(ke);$=$.filter(function(Je){return!Be.includes(Je)})}}C($),console.log($,"newCheckedKeys"),t($)},Ge=function(){v.Z.post2("/sms/system/sysRoleMenu/updateFromTree",{id:y.id},{array:n}).then(function(D){D.status=="success"&&(f.default.success("\u6388\u6743\u6210\u529F"),t([]),G(),setTimeout(function(){X(!1),T([])},500))})};return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(Se.Z,{title:"\u83DC\u5355\u6388\u6743",open:A,onCancel:function(){X(!1),T([])},onOk:function(){Ge()},width:400,destroyOnClose:!0,children:(0,r.jsxs)("div",{className:"menu-tree-container",children:[(0,r.jsx)(Te,{placeholder:"\u641C\u7D22\u83DC\u5355",allowClear:!0,onChange:function(D){return ne(D.target.value)},style:{marginBottom:8}}),N.length>0?z.length>0?(0,r.jsx)(le.Z,{showIcon:!0,checkable:!0,defaultExpandAll:!0,treeData:z,checkedKeys:p,onCheck:Le,checkStrictly:!0}):(0,r.jsx)("div",{children:"\u6CA1\u6709\u5339\u914D\u7684\u83DC\u5355\u9879"}):(0,r.jsx)("div",{children:"\u6682\u65E0\u83DC\u5355\u6570\u636E"})]})})})},Me=e(49111),U=e(19650),ee=e(66456),Pe=e(15885),Ae=function(i){var A=(0,l.useRef)(),X=i.modalVisible,k=i.setModalVisible,G=i.callbackRef,y=i.departments,w=i.renderData,Q=(0,l.useState)([]),N=(0,o.Z)(Q,2),T=N[0],x=N[1],W=function(c){v.Z.delete("/sms/system/sysRolePermission/delFromRoleAndPermission",{roleId:w.id,permissionIds:c}).then(function(p){if(p.status=="success"){var C;f.default.success("\u53D6\u6D88\u6388\u6743"),c.split(",").forEach(function(s){y.splice(y.indexOf(s,1))}),(C=A.current)===null||C===void 0||C.reload()}})},z=function(c){typeof c!="object";var p=[];c.forEach(function(C){p.push({roleId:w.id,permissionId:C})}),console.log("arr",p),v.Z.postAll("/sms/system/sysRolePermission/saveArray",{array:p}).then(function(C){if(C.status=="success"){var s;f.default.success("\u6388\u6743\u6210\u529F"),c.forEach(function(a){y.push(a)}),(s=A.current)===null||s===void 0||s.reload()}})},B=[{title:"id",dataIndex:"id",search:!1},{title:"\u6743\u9650\u540D\u79F0",dataIndex:"name"},{title:"\u6743\u9650\u4EE3\u7801",dataIndex:"code"},{title:"\u64CD\u4F5C",search:!1,render:function(c,p){return(0,r.jsx)(r.Fragment,{children:y.some(function(C){return C==p.id})?(0,r.jsx)("a",{onClick:function(){W(p.id+"")},style:{color:"red"},children:"\u53D6\u6D88\u6388\u6743"},p.id):(0,r.jsx)("a",{onClick:function(){z([p.id])},children:"\u6388\u6743"},p.id)})}}];return(0,r.jsx)(Se.Z,{title:"\u89D2\u8272\u6388\u6743",width:1e3,onCancel:function(){k(!1),G()},onOk:function(){k(!1),G()},destroyOnClose:!0,visible:X,children:(0,r.jsx)(re.ZP,{columns:B,actionRef:A,cardBordered:!0,request:(0,_.Z)((0,S.Z)().mark(function V(){var c,p,C,s,a=arguments;return(0,S.Z)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return c=a.length>0&&a[0]!==void 0?a[0]:{},p=a.length>1?a[1]:void 0,C=a.length>2?a[2]:void 0,t.next=5,v.Z.get("/sms/system/sysPermission",c);case 5:return s=t.sent,t.abrupt("return",{data:s.data.content,success:s.success,total:s.data.totalElements});case 7:case"end":return t.stop()}},V)})),rowSelection:{selections:[Pe.Z.SELECTION_ALL,Pe.Z.SELECTION_INVERT],onChange:function(c,p){x(c)}},tableAlertOptionRender:function(){return(0,r.jsxs)(U.Z,{size:16,children:[(0,r.jsx)("a",{style:{color:"red"},onClick:function(){W(T.join(","))},children:"\u6279\u91CF\u53D6\u6D88"}),(0,r.jsx)("a",{onClick:function(){z(T)},children:"\u6279\u91CF\u6388\u6743"})]})},rowKey:"id",search:{labelWidth:"auto",collapsed:!1},pagination:{pageSize:10},dateFormatter:"string",headerTitle:"\u6743\u9650\u7BA1\u7406",toolBarRender:function(){return[]}})})},xe=null,Re=null,J=null,te=null,ce=function(){var i=(0,l.useRef)(),A=(0,l.useState)(!1),X=(0,o.Z)(A,2),k=X[0],G=X[1],y=(0,l.useState)(!1),w=(0,o.Z)(y,2),Q=w[0],N=w[1],T=(0,l.useState)({}),x=(0,o.Z)(T,2),W=x[0],z=x[1],B=(0,l.useState)(!1),V=(0,o.Z)(B,2),c=V[0],p=V[1],C=(0,l.useState)(!1),s=(0,o.Z)(C,2),a=s[0],n=s[1],t=(0,l.useState)(),Z=(0,o.Z)(t,2),R=Z[0],K=Z[1],ne=(0,l.useState)(),u=(0,o.Z)(ne,2),He=u[0],$e=u[1],Ve=(0,l.useState)("-1"),Le=(0,o.Z)(Ve,2),Ge=Le[0],I=Le[1],D=(0,l.useState)(),b=(0,o.Z)(D,2),L=b[0],H=b[1],j=(0,l.useState)(),$=(0,o.Z)(j,2),Ce=$[0],Ye=$[1],ke=(0,l.useState)(),Be=(0,o.Z)(ke,2),Je=Be[0],at=Be[1],tt=(0,l.useState)("1"),_e=(0,o.Z)(tt,2),de=_e[0],nt=_e[1],Qe=[],De=de=="1"?"/sms/system/sysRole":"/sms/system/sysPermission",fe=function(){var M;J=null,te=null,i==null||(M=i.current)===null||M===void 0||M.reload()},qe=[{title:"\u6743\u9650\u540D\u79F0",dataIndex:"name"},{title:"\u89D2\u8272\u4EE3\u7801",dataIndex:"code"},{title:"\u6388\u6743\u4EBA\u5458",dataIndex:"userName",colSpan:2,hideInTable:de!="1",ellipsis:!0,search:!1,tip:"\u8FC7\u957F\u4F1A\u81EA\u52A8\u6536\u7F29"},{width:80,hideInTable:de!="1",search:!1,colSpan:0,render:function(M,h,Ze,P){return(0,r.jsx)(Y.Z,{size:"small",type:"primary",icon:(0,r.jsx)(ve.Z,{}),onClick:(0,_.Z)((0,S.Z)().mark(function he(){return(0,S.Z)().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:if(xe){O.next=4;break}return O.next=3,v.Z.get("/sms/share/getDepartmentAndUser");case 3:xe=O.sent;case 4:Ye({content:xe.data,type:"role"}),H(h.userList),I(h.id),p(!0);case 8:case"end":return O.stop()}},he)})),children:"\u6388\u6743"})}},{title:"\u6388\u6743\u6743\u9650",dataIndex:"permission",colSpan:2,search:!1,hideInTable:de!="1",ellipsis:!0,tip:"\u8FC7\u957F\u4F1A\u81EA\u52A8\u6536\u7F29"},{width:80,colSpan:0,hideInTable:de!="1",search:!1,render:function(M,h,Ze,P){return(0,r.jsx)(Y.Z,{size:"small",type:"primary",icon:(0,r.jsx)(ve.Z,{}),onClick:(0,_.Z)((0,S.Z)().mark(function he(){var g;return(0,S.Z)().wrap(function(Ee){for(;;)switch(Ee.prev=Ee.next){case 0:g=[],h.permissionList.forEach(function(Ke){g.push(Ke.id)}),z(h),H(g),N(!0);case 5:case"end":return Ee.stop()}},he)})),children:"\u6388\u6743"})}},{title:"\u5907\u6CE8",dataIndex:"description",search:!1,ellipsis:!0,tip:"\u5907\u6CE8\u8FC7\u957F\u4F1A\u81EA\u52A8\u6536\u7F29"},{title:"\u64CD\u4F5C",valueType:"option",key:"option",fixed:"right",render:function(M,h,Ze,P){return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(Y.Z,{type:"primary",size:"small",icon:(0,r.jsx)(Ue.Z,{}),style:{marginRight:"10px",marginBottom:"8px"},onClick:function(){G(!0),z((0,se.Z)({type:"eidt"},h))},children:"\u7F16\u8F91"},"view"),(0,r.jsx)(ae.Z,{title:"\u662F\u5426\u786E\u5B9A\u5220\u9664\uFF1F",onConfirm:function(){v.Z.delete(De,{id:h.id}).then(function(g){g.status=="success"&&(f.default.success("\u5220\u9664\u6210\u529F"),fe())})},okText:"\u5220\u9664",cancelText:"\u53D6\u6D88",children:(0,r.jsx)(Y.Z,{type:"primary",size:"small",danger:!0,icon:(0,r.jsx)(Ne.Z,{}),children:"\u5220\u9664"},"delete")},h.id)]})}}];return(0,r.jsxs)(E.ZP,{onTabChange:function(M){var h;nt(M),i==null||(h=i.current)===null||h===void 0||h.reload()},tabList:[{tab:"\u89D2\u8272\u7BA1\u7406",key:"1"},{tab:"\u89D2\u8272\u6743\u9650",key:"2"}],children:[de=="1"?(0,r.jsx)(re.ZP,{columns:qe,actionRef:i,cardBordered:!0,scroll:{x:1500},request:(0,_.Z)((0,S.Z)().mark(function d(){var M,h,Ze,P=arguments;return(0,S.Z)().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(M=P.length>0&&P[0]!==void 0?P[0]:{},h=P.length>1?P[1]:void 0,Ze=P.length>2?P[2]:void 0,Qe=[],J){g.next=8;break}return g.next=7,v.Z.get(De,M);case 7:J=g.sent;case 8:return J.data.content.forEach(function(O){var Ee=[],Ke=[],et=[];Qe.push({name:O.userName,id:O.userId}),O.userList&&(O.userList.forEach(function(je){Ee.push(je.name)}),O.permissionList&&O.permissionList.forEach(function(je){Ke.push(je.name)}),O.menuList&&O.menuList.forEach(function(je){et.push(je.name)}),O.userName=Ee.join(","),O.permission=Ke.join(","),O.menu=et.join(","))}),H(Qe),g.abrupt("return",{data:J.data.content,success:J.success,total:J.data.totalElements});case 11:case"end":return g.stop()}},d)})),rowKey:"id",search:{labelWidth:"auto",collapsed:!1},onSubmit:function(){J=null},onReset:function(){J=null},options:{reload:function(){J=null,fe()}},dateFormatter:"string",headerTitle:"\u6388\u6743\u4EBA\u5458",toolBarRender:function(){return[(0,r.jsx)(Y.Z,{type:"primary",icon:(0,r.jsx)(q.Z,{}),onClick:function(){v.Z.post(de==1?"/sms/system/sysRole/reload":"/sms/system/sysPermission/reload").then(function(h){h.status=="success"?f.default.success("\u91CD\u8F7D\u6210\u529F"):f.default.error(h.msg)})},children:"\u91CD\u8F7D\u89D2\u8272"}),(0,r.jsx)(Y.Z,{type:"primary",icon:(0,r.jsx)(ve.Z,{}),onClick:function(){z({type:"add"}),G(!0)},children:"\u65B0\u589E\u89D2\u8272"})]}}):(0,r.jsx)(re.ZP,{columns:qe,actionRef:i,cardBordered:!0,request:(0,_.Z)((0,S.Z)().mark(function d(){var M,h,Ze,P=arguments;return(0,S.Z)().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return M=P.length>0&&P[0]!==void 0?P[0]:{},h=P.length>1?P[1]:void 0,Ze=P.length>2?P[2]:void 0,g.next=5,v.Z.get(De,M);case 5:return te=g.sent,g.abrupt("return",{data:te.data.content,success:te.success,total:te.data.totalElements});case 7:case"end":return g.stop()}},d)})),onSubmit:function(){te=null},onReset:function(){te=null},options:{reload:function(){J=null,fe()}},rowKey:"id",search:{labelWidth:"auto",collapsed:!1},dateFormatter:"string",headerTitle:"\u6743\u9650\u7BA1\u7406",toolBarRender:function(){return[(0,r.jsx)(Y.Z,{type:"primary",icon:(0,r.jsx)(q.Z,{}),onClick:function(){v.Z.post("/sms/system/sysPermission/reload").then(function(h){h.status=="success"?f.default.success("\u91CD\u8F7D\u6210\u529F"):f.default.error(h.msg)})},children:"\u91CD\u8F7D\u6743\u9650"}),(0,r.jsx)(Y.Z,{type:"primary",icon:(0,r.jsx)(ve.Z,{}),onClick:function(){z({type:"add"}),G(!0)},children:"\u65B0\u589E\u6743\u9650"})]}}),k&&(0,r.jsx)(m,{modalVisible:k,setModalVisible:function(){return G(!1)},callbackRef:function(){return fe()},renderData:W,url:De}),Q&&(0,r.jsx)(Ae,{modalVisible:Q,setModalVisible:function(){return N(!1)},callbackRef:function(){return fe()},departments:L,renderData:W,roleCardContent:Je,url:De}),c&&(0,r.jsx)(me.Z,{CardVisible:c,CardContent:Ce,callbackRef:function(){return fe()},setCardVisible:function(){return p(!1)},parentIdTree:Ge,departments:L}),a&&(0,r.jsx)(ze,{MenuVisible:a,MenuContent:Re,menuRenderData:He,callbackRef:function(){return fe()},setMenuVisible:function(){return n(!1)}})]})}},14037:function(Fe,ue,e){"use strict";var ie=e(71194),ae=e(50146),ge=e(34792),f=e(48086),se=e(32157),oe=e(5816),Y=e(88983),S=e(55742),_=e(86582),o=e(2824),l=e(47673),ve=e(4107),Ue=e(54618),Ne=e(89366),q=e(63863),re=e(67294),E=e(85893),Ie=ve.Z.Search;ue.Z=function(F){var We=F.CardVisible,v=F.setCardVisible,r=F.setDepartment,m=F.CardContent,me=F.departments,ye=F.parentIdTree,Se=F.checkable,Xe=Se===void 0?!1:Se,le=F.callbackRef,pe=F.setchargePerson,be=F.setUserID,we=F.getUserList,Oe=F.departNameList,Te=Oe===void 0?!1:Oe,ze,Me=[],U=[],ee=[],Pe=(0,re.useState)([]),Ae=(0,o.Z)(Pe,2),xe=Ae[0],Re=Ae[1],J=(0,re.useState)(""),te=(0,o.Z)(J,2),ce=te[0],i=te[1],A=(0,re.useState)(!0),X=(0,o.Z)(A,2),k=X[0],G=X[1],y=(0,re.useState)(!1),w=(0,o.Z)(y,2),Q=w[0],N=w[1],T=function s(a){var n=[];return a.forEach(function(t,Z){if(t.enable||Q||t.departmentName){var R=[];t.children&&(R=s(t.children));var K="",ne,u;t.departmentName?(K=t.departmentName,ne=(0,E.jsx)(Ue.Z,{}),u=!1):(K=t.name,ne=(0,E.jsx)(Ne.Z,{}),u=!1),R.length>0?n.push({title:K,key:Z,userId:t.userId,children:R,icon:ne,disabled:u,id:t.id}):n.push({title:K,key:Z,userId:t.userId,icon:ne,disabled:u,id:t.id})}}),n},x=[];m.content.forEach(function(s){s.departmentName?s.departmentName.indexOf("\u79BB\u804C")==-1&&x.push(s):x.push(s)}),m&&(ee=T(x));var W=function s(a,n){a.forEach(function(t,Z){t.key=n+"-"+Z,t.children&&s(t.children,t.key)})},z=function s(a,n){a.forEach(function(t,Z){["role","user","achievement","Groups","projectDepartment","sysuser"].includes(m.type)?t.userId==n&&(U.push(t.key),Me.push(t)):t.id==n&&U.push(t.key),t.children&&s(t.children,n)})};ee.length>0&&(W(ee,0),me&&me.forEach(function(s){z(ee,s.id)}),Te&&Te.split(",").forEach(function(s){z(ee,s)}));var B=function s(a,n){for(var t=[],Z=0;Z<n.length;Z++){var R=n[Z];R.children&&(R.children.some(function(K){return K.title.indexOf(a)!=-1})?t.push(R.key):s(a,R.children)&&t.push.apply(t,(0,_.Z)(s(a,R.children))))}return t},V=function(a){Re(a),G(!1)},c=function(a){var n=a.target.value;Re(B(n,ee)),i(n),G(!0)},p=function(a){var n=a.target.value;N(n)},C=function s(a){return a.map(function(n){var t=n.title.indexOf(ce),Z=n.title.substring(0,t),R=n.title.slice(t+ce.length),K=t>-1?(0,E.jsxs)("span",{children:[Z,(0,E.jsx)("span",{className:"site-tree-search-value",children:ce}),R]}):(0,E.jsx)("span",{children:n.title});return n.children?{title:K,key:n.key,disabled:n.disabled,icon:n.icon,children:s(n.children),userId:n.userId}:{title:K,key:n.key,icon:n.icon,userId:n.userId,titles:n.title,disabled:n.disabled}})};return(0,re.useEffect)(function(){if(!ce){let a=function(n){n.forEach(function(t){t.children&&(s.push(t.key),a(t.children))})};var s=[];a(ee),Re(s)}},[ce]),(0,E.jsxs)(E.Fragment,{children:[(0,E.jsxs)(S.ZP.Group,{onChange:p,value:Q,defaultValue:Q,children:[(0,E.jsx)(S.ZP,{value:!1,children:"\u4E0D\u67E5\u770B\u79BB\u804C"}),(0,E.jsx)(S.ZP,{value:!0,children:"\u67E5\u770B\u79BB\u804C"})]}),(m==null?void 0:m.type)=="performance"?(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(Ie,{style:{marginBottom:8},placeholder:"Search",onChange:function(a){return c(a)}}),(0,E.jsx)(oe.Z,{showIcon:!0,checkable:Xe,defaultExpandAll:!0,onExpand:function(a){return V(a)},autoExpandParent:k,defaultCheckedKeys:U,onCheck:function(a,n){var t=n.checkedNodes,Z=[];t.forEach(function(R){R.userId&&Z.push(R.userId)}),be(Z)},onSelect:function(a,n){n.node.userId&&be(n.node.userId)},treeData:C(ee)})]}):(0,E.jsx)(ae.Z,{title:"\u9009\u62E9\u4EBA\u5458",visible:We,destroyOnClose:!0,onCancel:function(){U=[],v(!1)},onOk:function(){var a,n=[],t=[];if((a=Me)===null||a===void 0||a.forEach(function(u){u.userId&&(n.push(u),t.push(u.userId))}),m.type=="projectDepartment"){q.Z.post("/sms/system/sysDepartment",{id:ye,projects:t.join(",")}).then(function(u){u.status=="success"&&(f.default.success("\u6388\u6743\u6210\u529F"),U=[],le(),setTimeout(function(){v(!1)},500))});return}if(m.type=="project"&&q.Z.post2("/sms/business/bizUserJob/updateFromTree",{id:ye},{array:t}).then(function(u){u.status=="success"&&(f.default.success("\u6388\u6743\u6210\u529F"),U=[],le(),setTimeout(function(){v(!1)},500))}),m.type=="user"&&q.Z.post2("/sms/system/sysUserUser/updateFromTree",{id:ye},{array:t}).then(function(u){u.status=="success"&&(f.default.success("\u6388\u6743\u6210\u529F"),U=[],le(),setTimeout(function(){v(!1)},500))}),m.type=="order")if(n.length>1){f.default.error("\u53EA\u80FD\u9009\u62E9\u4E00\u4F4D");return}else n.length==0?f.default.error("\u8BF7\u9009\u62E9\u6536\u8D39\u4EBA\uFF0C\u6536\u8D39\u4EBA\u4E0D\u80FD\u4E3A\u90E8\u95E8"):(r({name:n[0].titles,id:n[0].userId}),U=[],v(!1));if(m.type=="role"&&q.Z.post2("/sms/system/sysUserRole/updateFromTree",{id:ye},{array:t}).then(function(u){u.status=="success"&&(f.default.success("\u6388\u6743\u6210\u529F"),U=[],le(),setTimeout(function(){v(!1)},500))}),m.type=="achievement"){var Z=t.map(function(u){return{id:u,newOrderType:m.typeNum}}),R=me.map(function(u){return u.id});R.forEach(function(u){t.includes(u)||Z.push({id:u,newOrderType:0})}),q.Z.postAll("/sms/system/sysUser/saveArray",{array:Z}).then(function(u){u.status=="success"&&(f.default.success("\u6388\u6743\u6210\u529F"),U=[],we(),setTimeout(function(){v(!1)},500))})}if(m.type=="Groups"){var K=t.map(function(u){return{id:u,groupId:m.groups}}),ne=me.map(function(u){return u.id});ne.forEach(function(u){t.includes(u)||K.push({id:u,groupId:-1})}),q.Z.postAll("/sms/system/sysUser/saveArray",{array:K}).then(function(u){u.status=="success"&&(f.default.success("\u6388\u6743\u6210\u529F"),U=[],le(),setTimeout(function(){v(!1)},500))})}m.type=="sysuser"&&q.Z.postAll("/sms/system/sysUserLevel/correlationUser/".concat(ye),t).then(function(u){u.status=="success"&&(f.default.success("\u6388\u6743\u6210\u529F"),U=[],le(),setTimeout(function(){v(!1)},500))})},children:(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(Ie,{style:{marginBottom:8},placeholder:"Search",onChange:function(a){return c(a)}}),(0,E.jsx)(oe.Z,{showIcon:!0,checkable:(m==null?void 0:m.type)!="pay",defaultExpandAll:!0,onExpand:function(a){return V(a)},expandedKeys:xe,autoExpandParent:k,defaultCheckedKeys:U,onCheck:function(a,n){Me=n.checkedNodes},onSelect:function(a,n){ze={name:n.node.title,id:n.node.userId},m.type=="pay"&&n.node.userId&&(pe({name:n.node.titles,id:n.node.userId}),v(!1))},treeData:C(ee)})]})})]})}}}]);
