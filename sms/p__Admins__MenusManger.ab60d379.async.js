(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[9856],{62218:function(qe,ae,t){"use strict";t.r(ae),t.d(ae,{default:function(){return $e}});var _e=t(57663),te=t(71577),et=t(34792),Q=t(48086),x=t(39428),L=t(3182),tt=t(62350),oe=t(24565),nt=t(48736),re=t(27049),O=t(11849),m=t(2824),l=t(67294),ce=t(6700),le=t(51042),fe=t(71906),G=t(63863),ve=t(83840),ne=t(30202),at=t(49111),he=t(19650),Ze=t(37476),q=t(5966),me=t(64317),ge=t(90672),ye=t(43425),Se=t(47448),pe=t(63392),Ce=t(18613),xe=t(57206),je=t(88485),De=t(92570),Oe=t(89366),Fe=t(91816),be=t(50206),Te=t(49e3),Ee=t(46116),Ie=t(27053),Re=t(89317),Ae=t(75491),Me=t(26589),e=t(85893),Pe=function(f){var Z=(0,l.useRef)(),R=f.modalVisible,T=f.setModalVisible,I=f.callbackRef,d=f.renderData;setTimeout(function(){var o;if(Z==null||(o=Z.current)===null||o===void 0||o.resetFields(),d.type=="eidt"){var s;Z==null||(s=Z.current)===null||s===void 0||s.setFieldsValue((0,O.Z)({},d))}else if(d.type=="add"){var c;Z==null||(c=Z.current)===null||c===void 0||c.setFieldsValue({parentId:-1})}else if(d.type=="addChild"){var C;Z==null||(C=Z.current)===null||C===void 0||C.setFieldsValue({parentId:d.name})}},100);var P={labelCol:{span:4},wrapperCol:{span:14}},A=function(s){return new Promise(function(c,C){d.type=="add"?s.parentId=-1:d.type=="addChild"?s.parentId=d.id:(s.id=d.id,delete s.parentId),G.Z.post("/sms/system/sysMenu",s).then(function(y){y.status=="success"&&(c(!0),Q.default.success("\u63D0\u4EA4\u6210\u529F"),T(),I())}).catch(function(y){c(!0)})})};return(0,e.jsxs)(Ze.Y,(0,O.Z)((0,O.Z)({title:d.type=="add"?"\u65B0\u5EFA\u83DC\u5355":"\u4FEE\u6539\u83DC\u5355\u4FE1\u606F",autoFocusFirstInput:!0},P),{},{layout:"LAYOUT_TYPE_HORIZONTAL",modalProps:{onCancel:function(){return T()}},formRef:Z,onFinish:function(){var o=(0,L.Z)((0,x.Z)().mark(function s(c){return(0,x.Z)().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,A(c);case 2:case"end":return y.stop()}},s)}));return function(s){return o.apply(this,arguments)}}(),visible:R,labelCol:{span:5,offset:1},children:[(0,e.jsx)(q.Z,{width:"xl",name:"name",label:"\u83DC\u5355\u540D\u79F0",rules:[{required:!0,message:"\u8BF7\u6B63\u786E\u586B\u5199\uFF0C\u4E0D\u80FD\u5305\u542B\u7A7A\u683C",pattern:new RegExp(/^\S*$/)}]}),(0,e.jsx)(q.Z,{width:"xl",name:"code",label:"\u83DC\u5355\u4EE3\u7801",rules:[{required:!0,message:"\u8BF7\u6B63\u786E\u586B\u5199\uFF0C\u4E0D\u80FD\u5305\u542B\u7A7A\u683C",pattern:new RegExp(/^\S*$/)}]}),(0,e.jsx)(q.Z,{width:"xl",name:"path",label:"\u83DC\u5355\u8DEF\u5F84",rules:[{required:!0,message:"\u8BF7\u6B63\u786E\u586B\u5199\uFF0C\u4E0D\u80FD\u5305\u542B\u7A7A\u683C",pattern:new RegExp(/^\S*$/)}]}),(0,e.jsx)(me.Z,{name:"icon",label:"\u83DC\u5355\u56FE\u6807",width:"xl",placeholder:"\u8BF7\u9009\u62E9\u56FE\u6807",request:(0,L.Z)((0,x.Z)().mark(function o(){return(0,x.Z)().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",[{label:"\u8BBE\u7F6E",value:"SettingOutlined",icon:(0,e.jsx)(ye.Z,{})},{label:"\u56FE\u8868",value:"AreaChartOutlined",icon:(0,e.jsx)(Se.Z,{})},{label:"\u4EEA\u8868\u76D8",value:"DashboardOutlined",icon:(0,e.jsx)(pe.Z,{})},{label:"\u7B11\u8138",value:"SmileOutlined",icon:(0,e.jsx)(Ce.Z,{})},{label:"\u5FC3\u5F62",value:"HeartOutlined",icon:(0,e.jsx)(xe.Z,{})},{label:"\u7687\u51A0",value:"CrownOutlined",icon:(0,e.jsx)(je.Z,{})},{label:"\u8868\u683C",value:"TableOutlined",icon:(0,e.jsx)(De.Z,{})},{label:"\u7528\u6237",value:"UserOutlined",icon:(0,e.jsx)(Oe.Z,{})},{label:"\u6587\u4EF6\u5939",value:"FolderOpenOutlined",icon:(0,e.jsx)(Fe.Z,{})},{label:"\u56E2\u961F",value:"TeamOutlined",icon:(0,e.jsx)(be.Z,{})},{label:"\u96C6\u7FA4",value:"ClusterOutlined",icon:(0,e.jsx)(Te.Z,{})},{label:"\u9605\u8BFB",value:"ReadOutlined",icon:(0,e.jsx)(Ee.Z,{})},{label:"\u89E3\u51B3\u65B9\u6848",value:"SolutionOutlined",icon:(0,e.jsx)(Ie.Z,{})},{label:"\u901A\u77E5",value:"BellOutlined",icon:(0,e.jsx)(Re.Z,{})},{label:"\u6D88\u606F",value:"MessageOutlined",icon:(0,e.jsx)(Ae.Z,{})},{label:"\u8D26\u672C",value:"AccountBookOutlined",icon:(0,e.jsx)(Me.Z,{})}]);case 1:case"end":return c.stop()}},o)})),fieldProps:{optionItemRender:function(s){return(0,e.jsxs)(he.Z,{children:[s.icon," ",s.label]})}}}),(0,e.jsx)(q.Z,{width:"lg",name:"parentId",label:"\u7236\u7C7B",disabled:!0}),(0,e.jsx)(ge.Z,{width:"md",name:"description",label:"\u63CF\u8FF0"})]}))},rt=t(32157),se=t(5816),X=t(86582),lt=t(47673),Ve=t(4107),ke=Ve.Z.Search,Be=[],Ke=function(f){var Z=f.setParentIdTree,R=f.setParentIdFalg,T=f.callbackRef,I=f.type,d=(0,l.useState)([]),P=(0,m.Z)(d,2),A=P[0],o=P[1],s=(0,l.useState)([]),c=(0,m.Z)(s,2),C=c[0],y=c[1],N=(0,l.useState)(""),U=(0,m.Z)(N,2),M=U[0],_=U[1],k=(0,l.useState)(!0),$=(0,m.Z)(k,2),J=$[0],V=$[1];(0,l.useEffect)(function(){u()},[]);var w=function v(a){return a.filter(function(n){return n.isDel>=0}).map(function(n){return n.children&&n.children.length?(0,O.Z)((0,O.Z)({},n),{},{children:v(n.children)}):n})},H=function v(a){return a.map(function(n){return(0,O.Z)((0,O.Z)({key:String(n.id),title:n.name},n),{},{children:n.children?v(n.children):void 0})})},u=function(){var v=(0,L.Z)((0,x.Z)().mark(function a(){var n,g;return(0,x.Z)().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return E.next=2,G.Z.get("/sms/system/sysMenu/tree");case 2:n=E.sent,g=w(n.data),o(g);case 5:case"end":return E.stop()}},a)}));return function(){return v.apply(this,arguments)}}(),S=function(a){y(a),V(!1)},p=function(a){var n=a.target.value;_(n),V(!0)},F=function v(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],n=[];return a.forEach(function(g){var B,E=(B=g.title)===null||B===void 0?void 0:B.indexOf(M);if(g.children&&M.length>0){var z;(z=n).push.apply(z,(0,X.Z)(v(g.children)))}E>-1&&M.length>0&&n.push({title:g.title,id:g.id,key:g.key}),M.length==0&&(n=[],n.push(g))}),n};return(0,e.jsxs)(ne.ZP,{title:"\u83DC\u5355\u5217\u8868",colSpan:"25%",style:{width:I=="modal"?"100%":"25%"},children:[(0,e.jsx)(ke,{style:{marginBottom:30},placeholder:"Search",onChange:function(a){return p(a)}}),A.length>0&&(0,e.jsx)(se.Z,{defaultExpandAll:!0,onExpand:function(a){return S(a)},autoExpandParent:J,defaultCheckedKeys:Be,onSelect:function(a,n){Z({id:n.node.id,name:n.node.title}),R&&R(!1),T&&T()},treeData:M?F(H(A)):H(A)})]})},st=t(71194),Le=t(50146),Ne=t(91220),Ue=function(f){var Z=f.MenuVisible,R=f.setMenuVisible,T=f.MenuContent,I=f.callbackRef,d=f.menuRenderData;console.log(d,"renderData");var P=(0,l.useState)([]),A=(0,m.Z)(P,2),o=A[0],s=A[1],c=(0,l.useState)([]),C=(0,m.Z)(c,2),y=C[0],N=C[1],U=(0,l.useState)([]),M=(0,m.Z)(U,2),_=M[0],k=M[1],$=function u(S){return!S||!Array.isArray(S)?[]:S.map(function(p){return{key:p.id,title:p.name,children:p.children?u(p.children):[]}})};(0,l.useEffect)(function(){if(T&&T.content){var u=$(T.content);s(u)}},[T]),(0,l.useEffect)(function(){if(d&&d.menuList&&d.menuList.length>0){var u=d.menuList.map(function(S){return S.id});N(u),k(u)}else N([]),k([])},[d]);var J=function(S){var p=[],F=function v(a){!a||(a.key&&p.push(a.key),a.children&&a.children.length>0&&a.children.forEach(function(n){return v(n)}))};return F(S),p},V=function u(S,p){var F=(0,Ne.Z)(p),v;try{for(F.s();!(v=F.n()).done;){var a=v.value;if(a.key===S)return a;if(a.children&&a.children.length>0){var n=u(S,a.children);if(n)return n}}}catch(g){F.e(g)}finally{F.f()}return null},w=function(S,p){var F=p.node,v=p.checked,a=F.key,n=(0,X.Z)(y);if(v){var g=V(a,o);if(g){var B=J(g);n=(0,X.Z)(new Set([].concat((0,X.Z)(n),(0,X.Z)(B))))}}else{var E=V(a,o);if(E){var z=J(E);n=n.filter(function(ee){return!z.includes(ee)})}}N(n),k(n)},H=function(){G.Z.post2("/sms/system/sysRoleMenu/updateFromTree",{id:d.id},{array:_}).then(function(S){S.status=="success"&&(Q.default.success("\u6388\u6743\u6210\u529F"),k([]),I(),setTimeout(function(){R(!1),s([])},500))})};return(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(Le.Z,{title:"\u83DC\u5355\u6388\u6743",open:Z,onCancel:function(){R(!1),s([])},onOk:function(){H()},width:800,destroyOnClose:!0,children:(0,e.jsx)("div",{className:"menu-tree-container",children:o.length>0?(0,e.jsx)(se.Z,{showIcon:!0,checkable:!0,defaultExpandAll:!0,treeData:o,checkedKeys:y,onCheck:w,checkStrictly:!0}):(0,e.jsx)("div",{children:"\u6682\u65E0\u83DC\u5355\u6570\u636E"})})})})},$e=function(){var f=(0,l.useRef)(),Z=(0,l.useState)(!1),R=(0,m.Z)(Z,2),T=R[0],I=R[1],d=(0,l.useState)({}),P=(0,m.Z)(d,2),A=P[0],o=P[1],s=(0,l.useState)(),c=(0,m.Z)(s,2),C=c[0],y=c[1],N=(0,l.useState)(),U=(0,m.Z)(N,2),M=U[0],_=U[1],k=(0,l.useState)(!1),$=(0,m.Z)(k,2),J=$[0],V=$[1],w=(0,l.useState)([]),H=(0,m.Z)(w,2),u=H[0],S=H[1],p=(0,l.useState)("tab1"),F=(0,m.Z)(p,2),v=F[0],a=F[1],n=(0,l.useState)("1"),g=(0,m.Z)(n,2),B=g[0],E=g[1],z=(0,l.useState)([]),ee=(0,m.Z)(z,2),He=ee[0],ut=ee[1],Ye=(0,l.useState)(),ue=(0,m.Z)(Ye,2),Ge=ue[0],it=ue[1],Je=(0,l.useState)(!1),ie=(0,m.Z)(Je,2),de=ie[0],ze=ie[1],We=[{title:"\u6392\u5E8F",dataIndex:"sort",width:60,className:"drag-visible",search:!1},{title:"\u83DC\u5355\u540D\u79F0",dataIndex:"name",render:function(r,i){return(0,e.jsx)("a",{onClick:function(){u.push({id:i.id,name:i.name}),y({id:i.id,name:i.name}),K()},children:i.name})}},{title:"\u83DC\u5355\u7F16\u7801",dataIndex:"code"},{title:"\u63CF\u8FF0",dataIndex:"description"},{title:"\u64CD\u4F5C",valueType:"option",key:"option",fixed:"right",render:function(r,i,j,D){return(0,e.jsxs)("span",{children:[(0,e.jsx)("a",{onClick:function(){o((0,O.Z)({type:"eidt"},i)),I(!0)},children:"\u7F16\u8F91"}),(0,e.jsx)(re.Z,{type:"vertical"}),(0,e.jsx)("a",{onClick:function(){o((0,O.Z)({type:"addChild"},i)),I(!0)},children:"\u6DFB\u52A0\u4E0B\u5C5E\u83DC\u5355"}),(0,e.jsx)(re.Z,{type:"vertical"}),(0,e.jsx)(oe.Z,{title:"\u662F\u5426\u786E\u5B9A\u5220\u9664\uFF1F",onConfirm:function(){we(i.id)},okText:"\u5220\u9664",cancelText:"\u53D6\u6D88",children:(0,e.jsx)("a",{href:"#",children:"\u5220\u9664"})})]})}}],Qe=function(r,i,j){console.log("\u62D6\u62FD\u524D\u7D22\u5F15:",r),console.log("\u62D6\u62FD\u540E\u7D22\u5F15:",i),console.log("\u6392\u5E8F\u540E\u7684\u6570\u636E\u6E90:",j)};(0,l.useEffect)(function(){Xe()},[]);var Xe=function(){var h=(0,L.Z)((0,x.Z)().mark(function r(){var i;return(0,x.Z)().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:if(i=JSON.parse(localStorage.getItem("Department")),i){D.next=6;break}return D.next=4,G.Z.get("/sms/share/getDepartmentAndUser");case 4:i=D.sent.data,localStorage.setItem("Department",JSON.stringify(i));case 6:case"end":return D.stop()}},r)}));return function(){return h.apply(this,arguments)}}(),K=function(){setTimeout(function(){var r;f==null||(r=f.current)===null||r===void 0||r.reload()},100)},we=function(){var h=(0,L.Z)((0,x.Z)().mark(function r(i){var j;return(0,x.Z)().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return console.log(i,"iid"),b.next=3,G.Z.delete("/sms/system/sysRoleMenu",{id:i});case 3:j=b.sent,j.status=="success"?(Q.default.success("\u5220\u9664\u6210\u529F"),K()):Q.default.error(j.msg);case 5:case"end":return b.stop()}},r)}));return function(i){return h.apply(this,arguments)}}();return(0,e.jsxs)(fe.ZP,{onTabChange:function(r){E(r),K()},tabList:[{tab:"\u83DC\u5355\u7BA1\u7406",key:"1"}],children:[B==1?(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)(ne.ZP,{split:"vertical",style:{minHeight:800},children:[(0,e.jsx)(Ke,{setParentIdTree:function(r){y(r)},setParentIdFalg:function(){V(!1)},callbackRef:function(){K()}}),(0,e.jsx)(ne.ZP,{headerBordered:!0,children:(0,e.jsx)(ve.Z,{columns:We,actionRef:f,cardBordered:!0,rowKey:"id",request:(0,L.Z)((0,x.Z)().mark(function h(){var r,i,j,D,b,Y=arguments;return(0,x.Z)().wrap(function(W){for(;;)switch(W.prev=W.next){case 0:return r=Y.length>0&&Y[0]!==void 0?Y[0]:{},i=Y.length>1?Y[1]:void 0,j=Y.length>2?Y[2]:void 0,D={},J?D=r:C?D=(0,O.Z)({parentId:C.id},r):D=(0,O.Z)((0,O.Z)({},r),{},{parentId:"-1"}),W.next=7,G.Z.get("/sms/system/sysMenu",D);case 7:return b=W.sent,W.abrupt("return",{data:b.data.content,success:b.success,total:b.data.totalElements});case 9:case"end":return W.stop()}},h)})),onSubmit:function(){V(!0)},onReset:function(){V(!1),y(!1),K()},search:{labelWidth:"auto"},pagination:{pageSize:10},dragSortKey:"sort",toolBarRender:function(){return[(0,e.jsx)(te.Z,{type:"primary",style:{display:u.length>0?"":"none"},icon:(0,e.jsx)(ce.Z,{}),onClick:(0,L.Z)((0,x.Z)().mark(function r(){return(0,x.Z)().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:u.splice(u.length-1),console.log("dataArr",u),y(u[u.length-1]),K();case 4:case"end":return j.stop()}},r)})),children:"\u8FD4\u56DE\u4E0A\u5C42"},"button"),(0,e.jsx)(te.Z,{style:{display:C?"block":"none"},icon:(0,e.jsx)(le.Z,{}),type:"primary",onClick:function(){if(!C){Q.default.error("\u8BF7\u5148\u9009\u7740\u90E8\u95E8\u5728\u6DFB\u52A0\u4E0B\u5C5E\u90E8\u95E8");return}o((0,O.Z)({type:"addChild"},C)),I(!0)},children:"\u6DFB\u52A0\u4E0B\u5C5E\u83DC\u5355"},"button"),(0,e.jsx)(te.Z,{icon:(0,e.jsx)(le.Z,{}),type:"primary",onClick:function(){o({type:"add"}),I(!0)},children:"\u65B0\u5EFA\u9876\u7EA7\u83DC\u5355"},"button")]},dateFormatter:"string",onDragSortEnd:Qe})})]})}):(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(Groups,{})}),(0,e.jsx)(Pe,{modalVisible:T,setModalVisible:function(){return I(!1)},callbackRef:function(){return K()},renderData:A}),de&&(0,e.jsx)(Ue,{CardVisible:de,CardContent:Ge,callbackRef:function(){return K()},setCardVisible:function(){return ze(!1)},departNameList:He,parentIdTree:M})]})}}}]);
