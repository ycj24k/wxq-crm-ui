(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[2059],{54618:function(X,T,s){"use strict";s.d(T,{Z:function(){return j}});var O=s(28991),A=s(67294),R={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M908 640H804V488c0-4.4-3.6-8-8-8H548v-96h108c8.8 0 16-7.2 16-16V80c0-8.8-7.2-16-16-16H368c-8.8 0-16 7.2-16 16v288c0 8.8 7.2 16 16 16h108v96H228c-4.4 0-8 3.6-8 8v152H116c-8.8 0-16 7.2-16 16v288c0 8.8 7.2 16 16 16h288c8.8 0 16-7.2 16-16V656c0-8.8-7.2-16-16-16H292v-88h440v88H620c-8.8 0-16 7.2-16 16v288c0 8.8 7.2 16 16 16h288c8.8 0 16-7.2 16-16V656c0-8.8-7.2-16-16-16zm-564 76v168H176V716h168zm84-408V140h168v168H428zm420 576H680V716h168v168z"}}]},name:"apartment",theme:"outlined"},h=R,V=s(27029),P=function(l,W){return A.createElement(V.Z,(0,O.Z)((0,O.Z)({},l),{},{ref:W,icon:h}))},x=A.forwardRef(P),j=x},14037:function(X,T,s){"use strict";var O=s(71194),A=s(50146),R=s(34792),h=s(48086),V=s(32157),P=s(5816),x=s(88983),j=s(55742),N=s(86582),l=s(2824),W=s(47673),k=s(4107),F=s(54618),S=s(89366),p=s(63863),_=s(67294),i=s(85893),b=k.Z.Search;T.Z=function(d){var H=d.CardVisible,E=d.setCardVisible,z=d.setDepartment,u=d.CardContent,K=d.departments,M=d.parentIdTree,U=d.checkable,g=U===void 0?!1:U,f=d.callbackRef,m=d.setchargePerson,Z=d.setUserID,I=d.getUserList,C=d.departNameList,Y=C===void 0?!1:C,ce,$=[],v=[],D=[],le=(0,_.useState)([]),w=(0,l.Z)(le,2),oe=w[0],G=w[1],de=(0,_.useState)(""),q=(0,l.Z)(de,2),L=q[0],fe=q[1],he=(0,_.useState)(!0),ee=(0,l.Z)(he,2),te=ee[0],ne=ee[1],ve=(0,_.useState)(!1),ae=(0,l.Z)(ve,2),J=ae[0],pe=ae[1],Ee=function r(n){var e=[];return n.forEach(function(t,c){if(t.enable||J||t.departmentName){var o=[];t.children&&(o=r(t.children));var y="",B,a;t.departmentName?(y=t.departmentName,B=(0,i.jsx)(F.Z,{}),a=!1):(y=t.name,B=(0,i.jsx)(S.Z,{}),a=!1),o.length>0?e.push({title:y,key:c,userId:t.userId,children:o,icon:B,disabled:a,id:t.id}):e.push({title:y,key:c,userId:t.userId,icon:B,disabled:a,id:t.id})}}),e},Q=[];u.content.forEach(function(r){r.departmentName?r.departmentName.indexOf("\u79BB\u804C")==-1&&Q.push(r):Q.push(r)}),u&&(D=Ee(Q));var ye=function r(n,e){n.forEach(function(t,c){t.key=e+"-"+c,t.children&&r(t.children,t.key)})},se=function r(n,e){n.forEach(function(t,c){["role","user","achievement","Groups","projectDepartment","sysuser"].includes(u.type)?t.userId==e&&(v.push(t.key),$.push(t)):t.id==e&&v.push(t.key),t.children&&r(t.children,e)})};D.length>0&&(ye(D,0),K&&K.forEach(function(r){se(D,r.id)}),Y&&Y.split(",").forEach(function(r){se(D,r)}));var _e=function r(n,e){for(var t=[],c=0;c<e.length;c++){var o=e[c];o.children&&(o.children.some(function(y){return y.title.indexOf(n)!=-1})?t.push(o.key):r(n,o.children)&&t.push.apply(t,(0,N.Z)(r(n,o.children))))}return t},re=function(n){G(n),ne(!1)},ue=function(n){var e=n.target.value;G(_e(e,D)),fe(e),ne(!0)},me=function(n){var e=n.target.value;pe(e)},ie=function r(n){return n.map(function(e){var t=e.title.indexOf(L),c=e.title.substring(0,t),o=e.title.slice(t+L.length),y=t>-1?(0,i.jsxs)("span",{children:[c,(0,i.jsx)("span",{className:"site-tree-search-value",children:L}),o]}):(0,i.jsx)("span",{children:e.title});return e.children?{title:y,key:e.key,disabled:e.disabled,icon:e.icon,children:r(e.children),userId:e.userId}:{title:y,key:e.key,icon:e.icon,userId:e.userId,titles:e.title,disabled:e.disabled}})};return(0,_.useEffect)(function(){if(!L){let n=function(e){e.forEach(function(t){t.children&&(r.push(t.key),n(t.children))})};var r=[];n(D),G(r)}},[L]),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(j.ZP.Group,{onChange:me,value:J,defaultValue:J,children:[(0,i.jsx)(j.ZP,{value:!1,children:"\u4E0D\u67E5\u770B\u79BB\u804C"}),(0,i.jsx)(j.ZP,{value:!0,children:"\u67E5\u770B\u79BB\u804C"})]}),(u==null?void 0:u.type)=="performance"?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(b,{style:{marginBottom:8},placeholder:"Search",onChange:function(n){return ue(n)}}),(0,i.jsx)(P.Z,{showIcon:!0,checkable:g,defaultExpandAll:!0,onExpand:function(n){return re(n)},autoExpandParent:te,defaultCheckedKeys:v,onCheck:function(n,e){var t=e.checkedNodes,c=[];t.forEach(function(o){o.userId&&c.push(o.userId)}),Z(c)},onSelect:function(n,e){e.node.userId&&Z(e.node.userId)},treeData:ie(D)})]}):(0,i.jsx)(A.Z,{title:"\u9009\u62E9\u4EBA\u5458",visible:H,destroyOnClose:!0,onCancel:function(){v=[],E(!1)},onOk:function(){var n,e=[],t=[];if((n=$)===null||n===void 0||n.forEach(function(a){a.userId&&(e.push(a),t.push(a.userId))}),u.type=="projectDepartment"){p.Z.post("/sms/system/sysDepartment",{id:M,projects:t.join(",")}).then(function(a){a.status=="success"&&(h.default.success("\u6388\u6743\u6210\u529F"),v=[],f(),setTimeout(function(){E(!1)},500))});return}if(u.type=="project"&&p.Z.post2("/sms/business/bizUserJob/updateFromTree",{id:M},{array:t}).then(function(a){a.status=="success"&&(h.default.success("\u6388\u6743\u6210\u529F"),v=[],f(),setTimeout(function(){E(!1)},500))}),u.type=="user"&&p.Z.post2("/sms/system/sysUserUser/updateFromTree",{id:M},{array:t}).then(function(a){a.status=="success"&&(h.default.success("\u6388\u6743\u6210\u529F"),v=[],f(),setTimeout(function(){E(!1)},500))}),u.type=="order")if(e.length>1){h.default.error("\u53EA\u80FD\u9009\u62E9\u4E00\u4F4D");return}else e.length==0?h.default.error("\u8BF7\u9009\u62E9\u6536\u8D39\u4EBA\uFF0C\u6536\u8D39\u4EBA\u4E0D\u80FD\u4E3A\u90E8\u95E8"):(z({name:e[0].titles,id:e[0].userId}),v=[],E(!1));if(u.type=="role"&&p.Z.post2("/sms/system/sysUserRole/updateFromTree",{id:M},{array:t}).then(function(a){a.status=="success"&&(h.default.success("\u6388\u6743\u6210\u529F"),v=[],f(),setTimeout(function(){E(!1)},500))}),u.type=="achievement"){var c=t.map(function(a){return{id:a,newOrderType:u.typeNum}}),o=K.map(function(a){return a.id});o.forEach(function(a){t.includes(a)||c.push({id:a,newOrderType:0})}),p.Z.postAll("/sms/system/sysUser/saveArray",{array:c}).then(function(a){a.status=="success"&&(h.default.success("\u6388\u6743\u6210\u529F"),v=[],I(),setTimeout(function(){E(!1)},500))})}if(u.type=="Groups"){var y=t.map(function(a){return{id:a,groupId:u.groups}}),B=K.map(function(a){return a.id});B.forEach(function(a){t.includes(a)||y.push({id:a,groupId:-1})}),p.Z.postAll("/sms/system/sysUser/saveArray",{array:y}).then(function(a){a.status=="success"&&(h.default.success("\u6388\u6743\u6210\u529F"),v=[],f(),setTimeout(function(){E(!1)},500))})}u.type=="sysuser"&&p.Z.postAll("/sms/system/sysUserLevel/correlationUser/".concat(M),t).then(function(a){a.status=="success"&&(h.default.success("\u6388\u6743\u6210\u529F"),v=[],f(),setTimeout(function(){E(!1)},500))})},children:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(b,{style:{marginBottom:8},placeholder:"Search",onChange:function(n){return ue(n)}}),(0,i.jsx)(P.Z,{showIcon:!0,checkable:(u==null?void 0:u.type)!="pay",defaultExpandAll:!0,onExpand:function(n){return re(n)},expandedKeys:oe,autoExpandParent:te,defaultCheckedKeys:v,onCheck:function(n,e){$=e.checkedNodes},onSelect:function(n,e){ce={name:e.node.title,id:e.node.userId},u.type=="pay"&&e.node.userId&&(m({name:e.node.titles,id:e.node.userId}),E(!1))},treeData:ie(D)})]})})]})}},12850:function(X,T,s){"use strict";s.r(T),s.d(T,{default:function(){return k}});var O=s(30202),A=s(71906),R=s(21010),h=s(39428),V=s(3182),P=s(2824),x=s(67294),j=s(63863),N=s(14037),l=s(85893),W=function(F){var S=(0,x.useState)({content:[]}),p=(0,P.Z)(S,2),_=p[0],i=p[1],b=(0,x.useState)([]),d=(0,P.Z)(b,2),H=d[0],E=d[1],z=(0,R.tT)("@@initialState"),u=z.initialState;(0,x.useMemo)(function(){console.log(u)},[H]),(0,x.useEffect)(function(){K()},[]);var K=function(){var U=(0,V.Z)((0,h.Z)().mark(function g(){var f,m;return(0,h.Z)().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:if(f=JSON.parse(localStorage.getItem("Department")),f){I.next=6;break}return I.next=4,j.Z.get("/sms/share/getDepartmentAndUser");case 4:f=I.sent.data,localStorage.setItem("Department",JSON.stringify(f));case 6:m=[],f.map(function(C){C.departmentName=="\u6C47\u5FB7\u6559\u80B2"&&(m=C.children)}),m.forEach(function(C){C.children&&M(C.children,C)});case 9:case"end":return I.stop()}},g)}));return function(){return U.apply(this,arguments)}}(),M=function U(g,f){g.forEach(function(m){var Z;if(m.userId==(u==null||(Z=u.currentUser)===null||Z===void 0?void 0:Z.userid)){i({content:[f],type:"performance"});return}else m.children&&U(m.children,f)})};return(0,l.jsx)(N.Z,{CardVisible:!0,checkable:!0,CardContent:_,setUserID:function(g){E(g)}})},k=function(F){var S,p=(0,R.tT)("@@initialState"),_=p.initialState;return(0,l.jsx)(A.ZP,{children:(0,l.jsxs)(O.ZP,{split:"vertical",children:[(0,l.jsx)(O.ZP,{colSpan:"25%",children:(0,l.jsx)(W,{})}),(0,l.jsx)(O.ZP,{children:(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{children:_==null||(S=_.currentUser)===null||S===void 0?void 0:S.name}),(0,l.jsx)("span",{})]})})]})})}}}]);
